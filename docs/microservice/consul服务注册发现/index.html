<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="å®˜ç½‘åœ°å€ï¼šhttps://www.consul.io
ç®€ä»‹# Consul æ˜¯ä¸€ä¸ªæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æœåŠ¡å‘ç°å’Œé…ç½®å…±äº«çš„æœåŠ¡è½¯ä»¶ï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘, åŸºäº Mozilla Public License 2.0 çš„åè®®è¿›è¡Œå¼€æºã€‚ Consul æ”¯æŒ å¥åº·æ£€æŸ¥ï¼Œå¹¶å…è®¸ HTTP ã€GRPC å’Œ DNS åè®®è°ƒç”¨ API å­˜å‚¨é”®å€¼å¯¹ã€‚ ä¸€è‡´æ€§åè®®é‡‡ç”¨ Raft ç®—æ³•,ç”¨æ¥ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚ä½¿ç”¨ GOSSIP åè®®ç®¡ç†æˆå‘˜å’Œå¹¿æ’­æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒ ACL è®¿é—®æ§åˆ¶ã€‚
Consul åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œä½†ä½œä¸ºæ•´ä½“æ¥çœ‹çš„è¯ä¸»è¦åŠŸèƒ½æ˜¯ï¼šä¸ºåŸºç¡€è®¾æ–½æä¾›æœåŠ¡å‘ç°å’ŒæœåŠ¡é…ç½®çš„å·¥å…·ï¼Œä¸»è¦æä¾›ä»¥ä¸‹å…³é”®ç‰¹æ€§ï¼š
æœåŠ¡å‘ç°ï¼šConsul çš„å®¢æˆ·ç«¯ç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œå…¶ä»–çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ Consul æ¥ä¸­æ‰¾åˆ°è¿™ä¸ªæ³¨å†Œçš„æœåŠ¡ï¼ˆä½¿ç”¨ DNS æˆ– HTTPï¼‰ å¥åº·æ£€æŸ¥ï¼šConsul å®¢æˆ·ç«¯å¯ä»¥æä¾›ä»»æ„æ•°é‡çš„å¥åº·æ£€æŸ¥ï¼Œè¦ä¹ˆä¸ç»™å®šçš„æœåŠ¡ç›¸å…³è”ï¼ˆâ€œç½‘ç»œæœåŠ¡å™¨æ˜¯å¦è¿”å› 200 OKâ€ï¼‰ï¼Œè¦ä¹ˆä¸æœ¬åœ°èŠ‚ç‚¹ï¼ˆâ€œå†…å­˜åˆ©ç”¨ç‡æ˜¯å¦ä½äº 90%â€ï¼‰ç›¸å…³è”ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªä¿¡æ¯æ¥ç›‘æ§é›†ç¾¤å¥åº·çŠ¶å†µï¼Œå¹¶ä¸”æœåŠ¡å‘ç°ç»„ä»¶å¯ä»¥ä½¿ç”¨å®ƒæ¥é¿å…å°†è¯·æ±‚è·¯ç”±åˆ°ä¸å¥åº·çš„ä¸»æœºä¸Š KV å­˜å‚¨ï¼šåº”ç”¨ç¨‹åºå¯ä»¥å°† Consul çš„åˆ†å±‚é”®/å€¼å­˜å‚¨ç”¨äºå¤šç§ç›®çš„ï¼ŒåŒ…æ‹¬åŠ¨æ€é…ç½®ã€åŠŸèƒ½æ ‡è®°ã€åè°ƒã€é¢†å¯¼é€‰ä¸¾ç­‰ã€‚ç®€å•çš„ HTTP API ä½¿å…¶æ˜“äºä½¿ç”¨ å®‰å…¨æœåŠ¡é€šä¿¡ï¼šConsul å¯ä»¥ä¸ºæœåŠ¡ç”Ÿæˆå’Œåˆ†å‘ TLS è¯ä¹¦ï¼Œä»¥å»ºç«‹ç›¸äº’çš„ TLS è¿æ¥ã€‚ æ„å›¾ å¯ç”¨äºå®šä¹‰å…è®¸å“ªäº›æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥é€šè¿‡å®æ—¶æ›´æ”¹æ„å›¾è½»æ¾ç®¡ç†æœåŠ¡åˆ†æ®µï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å’Œé™æ€é˜²ç«å¢™è§„åˆ™ å¤šæ•°æ®ä¸­å¿ƒï¼šConsul æ”¯æŒå¼€ç®±å³ç”¨çš„å¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚è¿™æ„å‘³ç€ Consul çš„ç”¨æˆ·ä¸å¿…æ‹…å¿ƒæ„å»ºé¢å¤–çš„æŠ½è±¡å±‚ä»¥æ‰©å±•åˆ°å¤šä¸ªåŒºåŸŸ Consul Agent# æ¯ä¸ªä¸º Consul æä¾›æœåŠ¡çš„èŠ‚ç‚¹éƒ½ä¼šè¿è¡Œä¸€ä¸ª Consul Agentï¼Œå¯åŠ¨ Consul å¿…é¡»è¿è¡Œ Agentï¼ˆå¯ä»¥é€‰æ‹©è¿è¡Œä¸º Server æˆ– Client æ¨¡å¼ã€‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒè‡³å°‘è¦æœ‰ä¸€å° Serverï¼Œä¸€ä¸ª Clientæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„è¿›ç¨‹ï¼Œç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œè¿è¡Œå¥åº·æ£€æŸ¥å’Œè½¬å‘å¯¹ Server çš„æŸ¥è¯¢ï¼‰ è¿™ä¸ª Agent åŠŸèƒ½ä¸»è¦åœ¨äºï¼š
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://wangpengliang815.github.io/docs/microservice/consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%8F%91%E7%8E%B0/"><meta property="og:site_name" content="CODE'NOTE"><meta property="og:title" content="CODE'NOTE"><meta property="og:description" content="å®˜ç½‘åœ°å€ï¼šhttps://www.consul.io
ç®€ä»‹# Consul æ˜¯ä¸€ä¸ªæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æœåŠ¡å‘ç°å’Œé…ç½®å…±äº«çš„æœåŠ¡è½¯ä»¶ï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘, åŸºäº Mozilla Public License 2.0 çš„åè®®è¿›è¡Œå¼€æºã€‚ Consul æ”¯æŒ å¥åº·æ£€æŸ¥ï¼Œå¹¶å…è®¸ HTTP ã€GRPC å’Œ DNS åè®®è°ƒç”¨ API å­˜å‚¨é”®å€¼å¯¹ã€‚ ä¸€è‡´æ€§åè®®é‡‡ç”¨ Raft ç®—æ³•,ç”¨æ¥ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚ä½¿ç”¨ GOSSIP åè®®ç®¡ç†æˆå‘˜å’Œå¹¿æ’­æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒ ACL è®¿é—®æ§åˆ¶ã€‚
Consul åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œä½†ä½œä¸ºæ•´ä½“æ¥çœ‹çš„è¯ä¸»è¦åŠŸèƒ½æ˜¯ï¼šä¸ºåŸºç¡€è®¾æ–½æä¾›æœåŠ¡å‘ç°å’ŒæœåŠ¡é…ç½®çš„å·¥å…·ï¼Œä¸»è¦æä¾›ä»¥ä¸‹å…³é”®ç‰¹æ€§ï¼š
æœåŠ¡å‘ç°ï¼šConsul çš„å®¢æˆ·ç«¯ç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œå…¶ä»–çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ Consul æ¥ä¸­æ‰¾åˆ°è¿™ä¸ªæ³¨å†Œçš„æœåŠ¡ï¼ˆä½¿ç”¨ DNS æˆ– HTTPï¼‰ å¥åº·æ£€æŸ¥ï¼šConsul å®¢æˆ·ç«¯å¯ä»¥æä¾›ä»»æ„æ•°é‡çš„å¥åº·æ£€æŸ¥ï¼Œè¦ä¹ˆä¸ç»™å®šçš„æœåŠ¡ç›¸å…³è”ï¼ˆâ€œç½‘ç»œæœåŠ¡å™¨æ˜¯å¦è¿”å› 200 OKâ€ï¼‰ï¼Œè¦ä¹ˆä¸æœ¬åœ°èŠ‚ç‚¹ï¼ˆâ€œå†…å­˜åˆ©ç”¨ç‡æ˜¯å¦ä½äº 90%â€ï¼‰ç›¸å…³è”ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªä¿¡æ¯æ¥ç›‘æ§é›†ç¾¤å¥åº·çŠ¶å†µï¼Œå¹¶ä¸”æœåŠ¡å‘ç°ç»„ä»¶å¯ä»¥ä½¿ç”¨å®ƒæ¥é¿å…å°†è¯·æ±‚è·¯ç”±åˆ°ä¸å¥åº·çš„ä¸»æœºä¸Š KV å­˜å‚¨ï¼šåº”ç”¨ç¨‹åºå¯ä»¥å°† Consul çš„åˆ†å±‚é”®/å€¼å­˜å‚¨ç”¨äºå¤šç§ç›®çš„ï¼ŒåŒ…æ‹¬åŠ¨æ€é…ç½®ã€åŠŸèƒ½æ ‡è®°ã€åè°ƒã€é¢†å¯¼é€‰ä¸¾ç­‰ã€‚ç®€å•çš„ HTTP API ä½¿å…¶æ˜“äºä½¿ç”¨ å®‰å…¨æœåŠ¡é€šä¿¡ï¼šConsul å¯ä»¥ä¸ºæœåŠ¡ç”Ÿæˆå’Œåˆ†å‘ TLS è¯ä¹¦ï¼Œä»¥å»ºç«‹ç›¸äº’çš„ TLS è¿æ¥ã€‚ æ„å›¾ å¯ç”¨äºå®šä¹‰å…è®¸å“ªäº›æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥é€šè¿‡å®æ—¶æ›´æ”¹æ„å›¾è½»æ¾ç®¡ç†æœåŠ¡åˆ†æ®µï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å’Œé™æ€é˜²ç«å¢™è§„åˆ™ å¤šæ•°æ®ä¸­å¿ƒï¼šConsul æ”¯æŒå¼€ç®±å³ç”¨çš„å¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚è¿™æ„å‘³ç€ Consul çš„ç”¨æˆ·ä¸å¿…æ‹…å¿ƒæ„å»ºé¢å¤–çš„æŠ½è±¡å±‚ä»¥æ‰©å±•åˆ°å¤šä¸ªåŒºåŸŸ Consul Agent# æ¯ä¸ªä¸º Consul æä¾›æœåŠ¡çš„èŠ‚ç‚¹éƒ½ä¼šè¿è¡Œä¸€ä¸ª Consul Agentï¼Œå¯åŠ¨ Consul å¿…é¡»è¿è¡Œ Agentï¼ˆå¯ä»¥é€‰æ‹©è¿è¡Œä¸º Server æˆ– Client æ¨¡å¼ã€‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒè‡³å°‘è¦æœ‰ä¸€å° Serverï¼Œä¸€ä¸ª Clientæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„è¿›ç¨‹ï¼Œç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œè¿è¡Œå¥åº·æ£€æŸ¥å’Œè½¬å‘å¯¹ Server çš„æŸ¥è¯¢ï¼‰ è¿™ä¸ª Agent åŠŸèƒ½ä¸»è¦åœ¨äºï¼š"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="CODE'NOTE"><meta itemprop=description content="å®˜ç½‘åœ°å€ï¼šhttps://www.consul.io
ç®€ä»‹# Consul æ˜¯ä¸€ä¸ªæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æœåŠ¡å‘ç°å’Œé…ç½®å…±äº«çš„æœåŠ¡è½¯ä»¶ï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘, åŸºäº Mozilla Public License 2.0 çš„åè®®è¿›è¡Œå¼€æºã€‚ Consul æ”¯æŒ å¥åº·æ£€æŸ¥ï¼Œå¹¶å…è®¸ HTTP ã€GRPC å’Œ DNS åè®®è°ƒç”¨ API å­˜å‚¨é”®å€¼å¯¹ã€‚ ä¸€è‡´æ€§åè®®é‡‡ç”¨ Raft ç®—æ³•,ç”¨æ¥ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚ä½¿ç”¨ GOSSIP åè®®ç®¡ç†æˆå‘˜å’Œå¹¿æ’­æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒ ACL è®¿é—®æ§åˆ¶ã€‚
Consul åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œä½†ä½œä¸ºæ•´ä½“æ¥çœ‹çš„è¯ä¸»è¦åŠŸèƒ½æ˜¯ï¼šä¸ºåŸºç¡€è®¾æ–½æä¾›æœåŠ¡å‘ç°å’ŒæœåŠ¡é…ç½®çš„å·¥å…·ï¼Œä¸»è¦æä¾›ä»¥ä¸‹å…³é”®ç‰¹æ€§ï¼š
æœåŠ¡å‘ç°ï¼šConsul çš„å®¢æˆ·ç«¯ç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œå…¶ä»–çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ Consul æ¥ä¸­æ‰¾åˆ°è¿™ä¸ªæ³¨å†Œçš„æœåŠ¡ï¼ˆä½¿ç”¨ DNS æˆ– HTTPï¼‰ å¥åº·æ£€æŸ¥ï¼šConsul å®¢æˆ·ç«¯å¯ä»¥æä¾›ä»»æ„æ•°é‡çš„å¥åº·æ£€æŸ¥ï¼Œè¦ä¹ˆä¸ç»™å®šçš„æœåŠ¡ç›¸å…³è”ï¼ˆâ€œç½‘ç»œæœåŠ¡å™¨æ˜¯å¦è¿”å› 200 OKâ€ï¼‰ï¼Œè¦ä¹ˆä¸æœ¬åœ°èŠ‚ç‚¹ï¼ˆâ€œå†…å­˜åˆ©ç”¨ç‡æ˜¯å¦ä½äº 90%â€ï¼‰ç›¸å…³è”ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªä¿¡æ¯æ¥ç›‘æ§é›†ç¾¤å¥åº·çŠ¶å†µï¼Œå¹¶ä¸”æœåŠ¡å‘ç°ç»„ä»¶å¯ä»¥ä½¿ç”¨å®ƒæ¥é¿å…å°†è¯·æ±‚è·¯ç”±åˆ°ä¸å¥åº·çš„ä¸»æœºä¸Š KV å­˜å‚¨ï¼šåº”ç”¨ç¨‹åºå¯ä»¥å°† Consul çš„åˆ†å±‚é”®/å€¼å­˜å‚¨ç”¨äºå¤šç§ç›®çš„ï¼ŒåŒ…æ‹¬åŠ¨æ€é…ç½®ã€åŠŸèƒ½æ ‡è®°ã€åè°ƒã€é¢†å¯¼é€‰ä¸¾ç­‰ã€‚ç®€å•çš„ HTTP API ä½¿å…¶æ˜“äºä½¿ç”¨ å®‰å…¨æœåŠ¡é€šä¿¡ï¼šConsul å¯ä»¥ä¸ºæœåŠ¡ç”Ÿæˆå’Œåˆ†å‘ TLS è¯ä¹¦ï¼Œä»¥å»ºç«‹ç›¸äº’çš„ TLS è¿æ¥ã€‚ æ„å›¾ å¯ç”¨äºå®šä¹‰å…è®¸å“ªäº›æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥é€šè¿‡å®æ—¶æ›´æ”¹æ„å›¾è½»æ¾ç®¡ç†æœåŠ¡åˆ†æ®µï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å’Œé™æ€é˜²ç«å¢™è§„åˆ™ å¤šæ•°æ®ä¸­å¿ƒï¼šConsul æ”¯æŒå¼€ç®±å³ç”¨çš„å¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚è¿™æ„å‘³ç€ Consul çš„ç”¨æˆ·ä¸å¿…æ‹…å¿ƒæ„å»ºé¢å¤–çš„æŠ½è±¡å±‚ä»¥æ‰©å±•åˆ°å¤šä¸ªåŒºåŸŸ Consul Agent# æ¯ä¸ªä¸º Consul æä¾›æœåŠ¡çš„èŠ‚ç‚¹éƒ½ä¼šè¿è¡Œä¸€ä¸ª Consul Agentï¼Œå¯åŠ¨ Consul å¿…é¡»è¿è¡Œ Agentï¼ˆå¯ä»¥é€‰æ‹©è¿è¡Œä¸º Server æˆ– Client æ¨¡å¼ã€‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒè‡³å°‘è¦æœ‰ä¸€å° Serverï¼Œä¸€ä¸ª Clientæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„è¿›ç¨‹ï¼Œç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œè¿è¡Œå¥åº·æ£€æŸ¥å’Œè½¬å‘å¯¹ Server çš„æŸ¥è¯¢ï¼‰ è¿™ä¸ª Agent åŠŸèƒ½ä¸»è¦åœ¨äºï¼š"><meta itemprop=wordCount content="995"><title>ConsulæœåŠ¡æ³¨å†Œå‘ç° | CODE'NOTE</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://wangpengliang815.github.io/docs/microservice/consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%8F%91%E7%8E%B0/><link rel=stylesheet href=/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG+T2l66Bw7pV8=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.16bbea805e586532aeca5e48249564b81bcbb5a9d44401ea4658ef5e6a5e812f.js integrity="sha256-FrvqgF5YZTKuyl5IJJVkuBvLtanURAHqRljvXmpegS8=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-docs"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>CODE'NOTE</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-f32afe48992fac3b3fc76dc3b27dd1d5 class=toggle>
<label for=section-f32afe48992fac3b3fc76dc3b27dd1d5 class=flex><a role=button>ğŸ“š .NET</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/dotnet/%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/>å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„å†…å­˜åˆ†é…</a></li><li><a href=/docs/dotnet/%E5%8F%8D%E5%B0%84%E6%8A%80%E6%9C%AF/>åå°„æŠ€æœ¯</a></li><li><a href=/docs/dotnet/%E5%9F%BA%E7%A1%80%E5%90%88%E9%9B%86/>åŸºç¡€åˆé›†</a></li><li><a href=/docs/dotnet/%E5%A4%9A%E7%BA%BF%E7%A8%8B/>å¤šçº¿ç¨‹</a></li><li><a href=/docs/dotnet/%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6/>å§”æ‰˜å’Œäº‹ä»¶</a></li><li><a href=/docs/dotnet/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/>å¹¶è¡Œç¼–ç¨‹</a></li><li><a href=/docs/dotnet/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/>å¼‚æ­¥ç¼–ç¨‹</a></li><li><a href=/docs/dotnet/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/>æ•°æ®ç»“æ„</a></li><li><a href=/docs/dotnet/%E6%B3%9B%E5%9E%8B%E6%8A%80%E6%9C%AF/>æ³›å‹æŠ€æœ¯</a></li><li><a href=/docs/dotnet/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/>çº¿ç¨‹åŒæ­¥</a></li><li><a href=/docs/dotnet/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/>é¢å‘å¯¹è±¡</a></li></ul></li><li><input type=checkbox id=section-17ee4616d3316ecf2ecdb7c27cfa2a63 class=toggle>
<label for=section-17ee4616d3316ecf2ecdb7c27cfa2a63 class=flex><a role=button>ğŸ­ PMI-ACP</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/acp/pmi-acp%E5%9F%BA%E7%A1%80%E4%BA%86%E8%A7%A3/>Pmi AcpåŸºç¡€äº†è§£</a></li><li><a href=/docs/acp/pmi-acpdown/>Pmi Acpdown</a></li><li><a href=/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B001/>Pmi Acpå¤‡è€ƒç¬”è®°01</a></li><li><a href=/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B002/>Pmi Acpå¤‡è€ƒç¬”è®°02</a></li><li><a href=/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B003/>Pmi Acpå¤‡è€ƒç¬”è®°03</a></li></ul></li><li><input type=checkbox id=section-fba10961f5d9c66eab238d766cb1a791 class=toggle>
<label for=section-fba10961f5d9c66eab238d766cb1a791 class=flex><a role=button>âŒ› è½¯ä»¶æµ‹è¯•</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/test/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/>å•å…ƒæµ‹è¯•</a></li><li><a href=/docs/test/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95k6/>å‹åŠ›æµ‹è¯•k6</a></li><li><a href=/docs/test/%E8%87%AA%E5%8A%A8%E5%8C%96ui%E6%B5%8B%E8%AF%95/>è‡ªåŠ¨åŒ– Uiæµ‹è¯•</a></li><li><a href=/docs/test/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/>é›†æˆæµ‹è¯•</a></li></ul></li><li><input type=checkbox id=section-92cef1621a3b87cdf19787a11c3e85e0 class=toggle>
<label for=section-92cef1621a3b87cdf19787a11c3e85e0 class=flex><a role=button>â›·ï¸ Prometheus</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/prometheus/1.1prometheus%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%AE%89%E8%A3%85/>1.1 Prometheusç®€ä»‹åŠå®‰è£…</a></li><li><a href=/docs/prometheus/1.2exporter%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/>1.2 Exporteræ•°æ®é‡‡é›†</a></li><li><a href=/docs/prometheus/1.3promql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/>1.3 Prom QlæŸ¥è¯¢è¯­è¨€</a></li><li><a href=/docs/prometheus/1.4alertmanager%E5%91%8A%E8%AD%A6%E5%A4%84%E7%90%86/>1.4 Alertmanagerå‘Šè­¦å¤„ç†</a></li><li><a href=/docs/prometheus/1.5grafana%E7%9B%91%E6%8E%A7%E5%8F%AF%E8%A7%86%E5%8C%96/>1.5 Grafanaç›‘æ§å¯è§†åŒ–</a></li></ul></li><li><input type=checkbox id=section-c4b81cc06a2cdd0259ab09c2dde93fb5 class=toggle>
<label for=section-c4b81cc06a2cdd0259ab09c2dde93fb5 class=flex><a role=button>ğŸ‡ RabbitMq</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/rabbitmq/1.1rabbitmq%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/>1.1 Rabbit Mqæ¦‚å¿µåŠå®‰è£…</a></li><li><a href=/docs/rabbitmq/1.2%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D/>1.2å·¥ä½œæ¨¡å¼ä»‹ç»</a></li><li><a href=/docs/rabbitmq/1.3%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%8F%8A%E6%8C%81%E4%B9%85%E5%8C%96/>1.3æ¶ˆæ¯ç¡®è®¤åŠæŒä¹…åŒ–</a></li><li><a href=/docs/rabbitmq/1.4%E4%B8%A4%E7%A7%8D%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%BC%8F%E5%92%8Cqos%E7%9A%84%E5%AE%9E%E7%8E%B0/>1.4ä¸¤ç§æ¶ˆè´¹æ¨¡å¼å’Œ Qosçš„å®ç°</a></li><li><a href=/docs/rabbitmq/1.5channel%E5%B8%B8%E8%A7%81%E6%96%B9%E6%B3%95/>1.5 Channelå¸¸è§æ–¹æ³•</a></li><li><a href=/docs/rabbitmq/1.6rabbitmq%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>1.6 Rabbit Mqå¸¸ç”¨å‘½ä»¤</a></li><li><a href=/docs/rabbitmq/1.7rabbitmq%E5%B8%B8%E8%A7%81%E7%AD%96%E7%95%A5/>1.7 Rabbit Mqå¸¸è§ç­–ç•¥</a></li><li><a href=/docs/rabbitmq/1.8rabbitmq%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/>1.8 Rabbit Mqå¸¸è§é—®é¢˜</a></li><li><a href=/docs/rabbitmq/1.9rabbitmq%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/>1.9 Rabbit Mqé›†ç¾¤æ–¹æ¡ˆ</a></li><li><a href=/docs/rabbitmq/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5rabbitmq/>å®¢æˆ·ç«¯è¿æ¥ Rabbit Mq</a></li></ul></li><li><input type=checkbox id=section-45de5b9a6214c965d493f727c3af2aae class=toggle>
<label for=section-45de5b9a6214c965d493f727c3af2aae class=flex><a role=button>ğŸ¹ Golang</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/go/01%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/>01å¼€å‘ç¯å¢ƒæ­å»º</a></li><li><a href=/docs/go/02%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/>02å˜é‡å’Œå¸¸é‡</a></li><li><a href=/docs/go/03%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/>03åŸºæœ¬æ•°æ®ç±»å‹</a></li><li><a href=/docs/go/04%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/>04æµç¨‹æ§åˆ¶å’Œè¿ç®—ç¬¦</a></li><li><a href=/docs/go/05%E6%95%B0%E7%BB%84/>05æ•°ç»„</a></li><li><a href=/docs/go/06%E5%88%87%E7%89%87/>06åˆ‡ç‰‡</a></li><li><a href=/docs/go/07map/>07map</a></li><li><a href=/docs/go/08%E5%87%BD%E6%95%B0/>08å‡½æ•°</a></li><li><a href=/docs/go/09%E6%8C%87%E9%92%88/>09æŒ‡é’ˆ</a></li><li><a href=/docs/go/10%E5%8F%8D%E5%B0%84/>10åå°„</a></li><li><a href=/docs/go/11%E7%BB%93%E6%9E%84%E4%BD%93/>11ç»“æ„ä½“</a></li><li><a href=/docs/go/12%E6%8E%A5%E5%8F%A3/>12æ¥å£</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/channel/>Channel</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/csp%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/>Cspå¹¶å‘æ¨¡å‹</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/goroutine/>Goroutine</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/gpm%E5%8E%9F%E7%90%86%E4%B8%8E%E8%B0%83%E5%BA%A6/>GpmåŸç†ä¸è°ƒåº¦</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C/>åŸå­æ“ä½œ</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E5%92%8C%E9%94%81/>å¹¶å‘å®‰å…¨å’Œé”</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/flag/>Flag</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/fmt/>Fmt</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/log/>Log</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/time/>Time</a></li></ul></li><li><input type=checkbox id=section-61dde4567035e1fd2b5d2aa51b82a7a0 class=toggle checked>
<label for=section-61dde4567035e1fd2b5d2aa51b82a7a0 class=flex><a role=button>ğŸ’« Microservice</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/microservice/1.1%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/>1.1å¾®æœåŠ¡å…¥é—¨ä¹‹é¡¹ç›®æ­å»º</a></li><li><a href=/docs/microservice/1.2%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/>1.2å¾®æœåŠ¡å…¥é—¨ä¹‹æœåŠ¡æ³¨å†Œä¸å‘ç°</a></li><li><a href=/docs/microservice/1.3%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E7%BD%91%E5%85%B3/>1.3å¾®æœåŠ¡å…¥é—¨ä¹‹ç½‘å…³</a></li><li><a href=/docs/microservice/1.4%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/>1.4å¾®æœåŠ¡å…¥é—¨ä¹‹äº‹ä»¶æ€»çº¿</a></li><li><a href=/docs/microservice/1.5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8Bdockercompose/>1.5å¾®æœåŠ¡å…¥é—¨ä¹‹ Docker Compose</a></li><li><a href=/docs/microservice/consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%8F%91%E7%8E%B0/ class=active>ConsulæœåŠ¡æ³¨å†Œå‘ç°</a></li></ul></li><li><input type=checkbox id=section-e6c26370c56585ceaa14c64b7d769452 class=toggle>
<label for=section-e6c26370c56585ceaa14c64b7d769452 class=flex><a role=button>ğŸ“¦ Redis</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/redis/1.10redis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/>1.10 Rediså¸¸è§é—®é¢˜</a></li><li><a href=/docs/redis/1.1nosql%E6%A6%82%E8%BF%B0/>1.1 No Sqlæ¦‚è¿°</a></li><li><a href=/docs/redis/1.2redis%E5%AE%89%E8%A3%85/>1.2 Rediså®‰è£…</a></li><li><a href=/docs/redis/1.3redis%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/>1.3 RedisåŸºæœ¬æ•°æ®ç±»å‹</a></li><li><a href=/docs/redis/1.4redis%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/>1.4 Redisç‰¹æ®Šæ•°æ®ç±»å‹</a></li><li><a href=/docs/redis/1.5redis%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C/>1.5 Redisäº‹åŠ¡æ“ä½œ</a></li><li><a href=/docs/redis/1.6redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/>1.6 Redisé…ç½®æ–‡ä»¶è¯¦è§£</a></li><li><a href=/docs/redis/1.7redis%E6%8C%81%E4%B9%85%E5%8C%96/>1.7 RedisæŒä¹…åŒ–</a></li><li><a href=/docs/redis/1.8redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/>1.8 Rediså‘å¸ƒè®¢é˜…</a></li><li><a href=/docs/redis/1.9redis%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/>1.9 Redisé›†ç¾¤æ–¹æ¡ˆ</a></li><li><a href=/docs/redis/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/>ä½¿ç”¨ Dockeræ­å»º Redisé›†ç¾¤</a></li><li><a href=/docs/redis/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5redis/>å®¢æˆ·ç«¯è¿æ¥ Redis</a></li></ul></li><li><input type=checkbox id=section-f781adde1ca4021db6751ec1e71e0572 class=toggle>
<label for=section-f781adde1ca4021db6751ec1e71e0572 class=flex><a role=button>ğŸ” ELK</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/elk/1.1elastaticsearch%E5%85%A5%E9%97%A8/>1.1 Elastatic Searchå…¥é—¨</a></li><li><a href=/docs/elk/1.2elastaticsearch%E9%85%8D%E7%BD%AE/>1.2 Elastatic Searché…ç½®</a></li><li><a href=/docs/elk/1.3%E4%BD%BF%E7%94%A8kibana%E6%93%8D%E4%BD%9Ces/>1.3ä½¿ç”¨ Kibanaæ“ä½œ Es</a></li></ul></li><li><input type=checkbox id=section-17df8bdb44c678e43d193647c6ae88f1 class=toggle>
<label for=section-17df8bdb44c678e43d193647c6ae88f1 class=flex><a role=button>ğŸš¢ Docker</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/docker/1.1docker%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/>1.1 Dockeræ¦‚å¿µåŠå®‰è£…</a></li><li><a href=/docs/docker/1.2docker%E9%95%9C%E5%83%8F/>1.2 Dockeré•œåƒ</a></li><li><a href=/docs/docker/1.3docker%E5%AE%B9%E5%99%A8/>1.3 Dockerå®¹å™¨</a></li><li><a href=/docs/docker/1.4docker%E4%BB%93%E5%BA%93/>1.4 Dockerä»“åº“</a></li><li><a href=/docs/docker/1.5docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/>1.5 Dockeræ•°æ®ç®¡ç†</a></li><li><a href=/docs/docker/1.6docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F/>1.6 Dockerå®¹å™¨ç½‘ç»œæ¨¡å¼</a></li><li><a href=/docs/docker/1.7docker%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/>1.7 Dockeré«˜çº§ç½‘ç»œé…ç½®</a></li><li><a href=/docs/docker/1.8dockerfile/>1.8 Dockerfile</a></li><li><a href=/docs/docker/1.9dockercompose/>1.9 Docker Compose</a></li><li><a href=/docs/docker/2.0dockermachine/>2.0 Docker Machine</a></li><li><a href=/docs/docker/2.1dockerswarm/>2.1 Docker Swarm</a></li><li><a href=/docs/docker/2.2docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>2.2 Dockerå¸¸ç”¨å‘½ä»¤</a></li><li><a href=/docs/docker/2.3portainer%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF/>2.3 Portainerå¯è§†åŒ–é¢æ¿</a></li></ul></li><li><input type=checkbox id=section-566aa18ccd5b6b6934a70aded3a8361a class=toggle>
<label for=section-566aa18ccd5b6b6934a70aded3a8361a class=flex><a role=button>ğŸ•¸ï¸ K8s</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/kubernetes/kubernetes%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/>KubernetesåŸºç¡€çŸ¥è¯†</a></li><li><a href=/docs/kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/>Kubernetesé›†ç¾¤å®‰è£…</a></li></ul></li><li><input type=checkbox id=section-04176b4c8c5f502db36c25b60db03d67 class=toggle>
<label for=section-04176b4c8c5f502db36c25b60db03d67 class=flex><a role=button>ğŸ–¥ï¸ Linux</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/linux/centos7%E5%8D%87%E7%BA%A7gcc%E7%89%88%E6%9C%AC/>Centos7å‡çº§gccç‰ˆæœ¬</a></li><li><a href=/docs/linux/centos%E5%AE%89%E8%A3%85hexo/>Centoså®‰è£… Hexo</a></li><li><a href=/docs/linux/centos%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/>Centosç½‘ç»œé…ç½®</a></li><li><a href=/docs/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>Linuxå¸¸ç”¨å‘½ä»¤</a></li><li><a href=/docs/linux/linux%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E/>Linuxç›®å½•è¯´æ˜</a></li><li><a href=/docs/linux/vmware%E5%AE%89%E8%A3%85centos/>Vmwareå®‰è£… Centos</a></li></ul></li><li><input type=checkbox id=section-9397a01455952fcbd887e2206a8a3054 class=toggle>
<label for=section-9397a01455952fcbd887e2206a8a3054 class=flex><a role=button>ğŸ›ï¸ Devops</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/devops/gitlab%E5%AE%89%E8%A3%85/>Gitlabå®‰è£…</a></li><li><a href=/docs/devops/jenkins%E5%AE%89%E8%A3%85/>Jenkinså®‰è£…</a></li><li><a href=/docs/devops/jenkins%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/>Jenkinså¸¸è§æ“ä½œ</a></li><li><a href=/docs/devops/nugetserver%E6%90%AD%E5%BB%BA/>Nuget Serveræ­å»º</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/icons/menu.svg class=book-icon alt=Menu></label><h3>ConsulæœåŠ¡æ³¨å†Œå‘ç°</h3><label for=toc-control></label></div></header><article class="markdown book-article"><p>å®˜ç½‘åœ°å€ï¼šhttps://www.consul.io</p><h1 id=ç®€ä»‹>ç®€ä»‹<a class=anchor href=#%e7%ae%80%e4%bb%8b>#</a></h1><p>Consul æ˜¯ä¸€ä¸ªæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåˆ†å¸ƒå¼é«˜å¯ç”¨çš„æœåŠ¡å‘ç°å’Œé…ç½®å…±äº«çš„æœåŠ¡è½¯ä»¶ï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘, åŸºäº Mozilla Public License 2.0 çš„åè®®è¿›è¡Œå¼€æºã€‚ Consul æ”¯æŒ å¥åº·æ£€æŸ¥ï¼Œå¹¶å…è®¸ HTTP ã€GRPC å’Œ DNS åè®®è°ƒç”¨ API å­˜å‚¨é”®å€¼å¯¹ã€‚ ä¸€è‡´æ€§åè®®é‡‡ç”¨ Raft ç®—æ³•,ç”¨æ¥ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚ä½¿ç”¨ GOSSIP åè®®ç®¡ç†æˆå‘˜å’Œå¹¿æ’­æ¶ˆæ¯ï¼Œå¹¶ä¸”æ”¯æŒ ACL è®¿é—®æ§åˆ¶ã€‚</p><p>Consul åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œä½†ä½œä¸ºæ•´ä½“æ¥çœ‹çš„è¯ä¸»è¦åŠŸèƒ½æ˜¯ï¼šä¸ºåŸºç¡€è®¾æ–½æä¾›æœåŠ¡å‘ç°å’ŒæœåŠ¡é…ç½®çš„å·¥å…·ï¼Œä¸»è¦æä¾›ä»¥ä¸‹å…³é”®ç‰¹æ€§ï¼š</p><ul><li><strong>æœåŠ¡å‘ç°</strong>ï¼šConsul çš„å®¢æˆ·ç«¯ç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œå…¶ä»–çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ Consul æ¥ä¸­æ‰¾åˆ°è¿™ä¸ªæ³¨å†Œçš„æœåŠ¡ï¼ˆä½¿ç”¨ DNS æˆ– HTTPï¼‰</li><li><strong>å¥åº·æ£€æŸ¥</strong>ï¼šConsul å®¢æˆ·ç«¯å¯ä»¥æä¾›ä»»æ„æ•°é‡çš„å¥åº·æ£€æŸ¥ï¼Œè¦ä¹ˆä¸ç»™å®šçš„æœåŠ¡ç›¸å…³è”ï¼ˆâ€œç½‘ç»œæœåŠ¡å™¨æ˜¯å¦è¿”å› 200 OKâ€ï¼‰ï¼Œè¦ä¹ˆä¸æœ¬åœ°èŠ‚ç‚¹ï¼ˆâ€œå†…å­˜åˆ©ç”¨ç‡æ˜¯å¦ä½äº 90%â€ï¼‰ç›¸å…³è”ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªä¿¡æ¯æ¥ç›‘æ§é›†ç¾¤å¥åº·çŠ¶å†µï¼Œå¹¶ä¸”æœåŠ¡å‘ç°ç»„ä»¶å¯ä»¥ä½¿ç”¨å®ƒæ¥é¿å…å°†è¯·æ±‚è·¯ç”±åˆ°ä¸å¥åº·çš„ä¸»æœºä¸Š</li><li><strong>KV å­˜å‚¨</strong>ï¼šåº”ç”¨ç¨‹åºå¯ä»¥å°† Consul çš„åˆ†å±‚é”®/å€¼å­˜å‚¨ç”¨äºå¤šç§ç›®çš„ï¼ŒåŒ…æ‹¬åŠ¨æ€é…ç½®ã€åŠŸèƒ½æ ‡è®°ã€åè°ƒã€é¢†å¯¼é€‰ä¸¾ç­‰ã€‚ç®€å•çš„ HTTP API ä½¿å…¶æ˜“äºä½¿ç”¨</li><li><strong>å®‰å…¨æœåŠ¡é€šä¿¡</strong>ï¼šConsul å¯ä»¥ä¸ºæœåŠ¡ç”Ÿæˆå’Œåˆ†å‘ TLS è¯ä¹¦ï¼Œä»¥å»ºç«‹ç›¸äº’çš„ TLS è¿æ¥ã€‚ <a href=https://www.consul.io/docs/connect/intentions>æ„å›¾</a> å¯ç”¨äºå®šä¹‰å…è®¸å“ªäº›æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥é€šè¿‡å®æ—¶æ›´æ”¹æ„å›¾è½»æ¾ç®¡ç†æœåŠ¡åˆ†æ®µï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å’Œé™æ€é˜²ç«å¢™è§„åˆ™</li><li><strong>å¤šæ•°æ®ä¸­å¿ƒ</strong>ï¼šConsul æ”¯æŒå¼€ç®±å³ç”¨çš„å¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚è¿™æ„å‘³ç€ Consul çš„ç”¨æˆ·ä¸å¿…æ‹…å¿ƒæ„å»ºé¢å¤–çš„æŠ½è±¡å±‚ä»¥æ‰©å±•åˆ°å¤šä¸ªåŒºåŸŸ</li></ul><h1 id=consul-agent>Consul Agent<a class=anchor href=#consul-agent>#</a></h1><p>æ¯ä¸ªä¸º Consul æä¾›æœåŠ¡çš„èŠ‚ç‚¹éƒ½ä¼šè¿è¡Œä¸€ä¸ª Consul Agentï¼Œå¯åŠ¨ Consul å¿…é¡»è¿è¡Œ Agentï¼ˆå¯ä»¥é€‰æ‹©è¿è¡Œä¸º <code>Server</code> æˆ– <code>Client</code> æ¨¡å¼ã€‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒè‡³å°‘è¦æœ‰ä¸€å° <code>Server</code>ï¼Œä¸€ä¸ª <code>Client</code>æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„è¿›ç¨‹ï¼Œç”¨äºæ³¨å†ŒæœåŠ¡ï¼Œè¿è¡Œå¥åº·æ£€æŸ¥å’Œè½¬å‘å¯¹ <code>Server</code> çš„æŸ¥è¯¢ï¼‰ è¿™ä¸ª Agent åŠŸèƒ½ä¸»è¦åœ¨äºï¼š</p><ol><li>è´Ÿè´£å¯¹èŠ‚ç‚¹ä¸Šçš„æœåŠ¡ä»¥åŠèŠ‚ç‚¹æœ¬èº«è¿›è¡Œå¥åº·æ£€æŸ¥</li><li>Agent ä¼šä¸ä¸€å°æˆ–å¤šå° Consul Server ä¿æŒé€šä¿¡ï¼ˆConsul Server ç”¨äºå­˜å‚¨å’Œå¤åˆ¶æ•°æ®ï¼‰</li><li>Server ä¼šè‡ªå·±é€‰ä¸¾ä¸€ä¸ª Leaderã€‚è™½ç„¶ Consul å¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œä½†å»ºè®®ä½¿ç”¨ 3 åˆ° 5 å°ä»¥è¾¾åˆ°é«˜å¯ç”¨ã€‚å»ºè®®ä¸ºæ¯ä¸ªæ•°æ®ä¸­å¿ƒå¯ç”¨ Consul Server é›†ç¾¤</li><li>Server ç»´æŠ¤ä¸€ä¸ªç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¿å­˜ç€æ‰€æœ‰ Agent æäº¤çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å“ªäº›æœåŠ¡å¯ç”¨ã€å“ªäº›èŠ‚ç‚¹è¿è¡Œå“ªäº›æœåŠ¡ã€è¿è¡ŒçŠ¶å†µä¿¡æ¯ç­‰ã€‚å¯ä»¥åœ¨<a href=https://www.consul.io/docs/internals/anti-entropy#catalog>æ­¤å¤„</a>æ‰¾åˆ° Agent å’Œç›®å½•çš„äº¤äº’æ–¹å¼</li></ol><p>å½“éœ€è¦æŸ¥æ‰¾ Consul ä¸­æ³¨å†Œçš„æœåŠ¡æˆ–è€…å„èŠ‚ç‚¹çš„åŸºç¡€è®¾æ–½ç»„ä»¶æ—¶å¯ä»¥æŸ¥è¯¢ä»»ä½• Consul Server æˆ–è€… ä»»ä½• Consul ä»£ç†ã€‚ä»£ç†è‡ªåŠ¨å°†æŸ¥è¯¢è½¬å‘åˆ° Serverã€‚</p><p>æ¯ä¸ªæ•°æ®ä¸­å¿ƒéƒ½è¿è¡Œä¸€ä¸ª Consul æœåŠ¡å™¨é›†ç¾¤ã€‚å½“è¿›è¡Œè·¨æ•°æ®ä¸­å¿ƒçš„æœåŠ¡å‘ç°æˆ–é…ç½®è¯·æ±‚æ—¶ï¼Œæœ¬åœ° Consul Server å°†è¯·æ±‚è½¬å‘åˆ°è¿œç¨‹æ•°æ®ä¸­å¿ƒå¹¶è¿”å›ç»“æœã€‚</p><h1 id=consul-å¯¹æ¯”>Consul å¯¹æ¯”<a class=anchor href=#consul-%e5%af%b9%e6%af%94>#</a></h1><p>é’ˆå¯¹æœåŠ¡æ³¨å†Œå‘ç°æœ‰å¾ˆå¤šä¸­é—´ä»¶éƒ½å¯ä»¥åšï¼Œæ¯”å¦‚ <code>zookeeper</code> ã€<code>Etcd</code> ã€<code>doozerd</code> ã€<code>eureka</code>ï¼ŒConsul ç›¸æ¯”äºè¿™äº›è½¯ä»¶ä¼˜åŠ¿åœ¨äºï¼š</p><ul><li>ä½¿ç”¨ Raft ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§ï¼šRaft æ¯”å¤æ‚çš„ Paxos ç®—æ³•æ›´ç›´æ¥ã€‚ï¼ˆ<code>zookeeper</code> é‡‡ç”¨çš„æ˜¯ <code>Paxos</code>, <code>etcd</code> ä½¿ç”¨çš„åˆ™æ˜¯ <code>Raft</code>ï¼‰</li><li>æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼šå†…å¤–ç½‘æœåŠ¡é‡‡ç”¨ä¸åŒç«¯å£è¿›è¡Œç›‘å¬ï¼Œå¤šæ•°æ®ä¸­å¿ƒé›†ç¾¤å¯ä»¥é¿å…å•æ•°æ®ä¸­å¿ƒçš„å•ç‚¹æ•…éšœã€‚ï¼ˆ<code>zookeeper</code> å’Œ <code>etcd</code> ä¸æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼‰</li><li>æ”¯æŒå¥åº·æ£€æŸ¥ï¼š <code>etcd</code> ä¸æ”¯æŒæ­¤åŠŸèƒ½</li><li>æ”¯æŒ <code>HTTP</code>/<code>DNS</code> /<code>GPRS</code> åè®®æ¥å£ï¼š <code>zookeeper</code> é›†æˆæ¯”è¾ƒå¤æ‚ï¼Œ<code>etcd</code> åªæ”¯æŒ <code>http åè®®</code></li><li>å®˜æ–¹æä¾› WEB ç®¡ç†ç•Œé¢ï¼Œ<code>etcd</code> æ— æ­¤åŠŸèƒ½</li></ul><p>ç»¼åˆæ¯”è¾ƒï¼ŒConsul ä½œä¸ºæœåŠ¡æ³¨å†Œå’Œé…ç½®ç®¡ç†çš„æ–°æ˜Ÿï¼Œè¿˜æ˜¯æ¯”è¾ƒå€¼å¾—å…³æ³¨å’Œç ”ç©¶çš„ã€‚å®˜ç½‘ï¼š<a href=https://www.consul.io/docs/intro/vs/chef-puppet>Consul Vs Other Software </a>ã€‚</p><h1 id=consul-æ¶æ„>Consul æ¶æ„<a class=anchor href=#consul-%e6%9e%b6%e6%9e%84>#</a></h1><p><img src=/images/2021-09-20-04-10-46.png alt></p><p>ä¸Šå›¾æ˜¯å®˜ç½‘ç»™å‡ºçš„ Consul æ¶æ„å›¾ï¼Œç®€å•äº†è§£ä¸€ä¸‹è¿™å¼ å›¾ã€‚é¦–å…ˆå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒï¼Œåˆ†åˆ«æ ‡æ³¨ä¸º &ldquo;DATACENTER1"å’Œ &ldquo;DATACENTER2&rdquo;ã€‚Consulå¯¹å¤šä¸ªæ•°æ®ä¸­å¿ƒæœ‰å¤©ç„¶éå¸¸å¥½çš„æ”¯æŒï¼Œå¹¶æ¨èè¿™ä¹ˆåšã€‚</p><p>æ¯ä¸ªæ•°æ®ä¸­å¿ƒå†…éƒ½æ··åˆç€ <code>Client</code> å’Œ <code>Server</code>ã€‚æ¨èæ˜¯3åˆ°5å° Serverã€‚è¿™æ˜¯åœ¨æƒè¡¡æ•…éšœåœºæ™¯ä¸‹å¯ç”¨æ€§å’Œæ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡ç»™å‡ºçš„å»ºè®®ï¼ˆéšç€æœºå™¨çš„å¢åŠ ï¼Œå…±è¯†çš„é€Ÿåº¦ä¼šé€æ¸å˜æ…¢ï¼‰ã€‚ä½†Client çš„æ•°é‡æ²¡æœ‰é™åˆ¶çš„å¯ä»¥è½»æ¾åœ°æ‰©å±•åˆ°æ•°åƒæˆ–æ•°ä¸‡ã€‚</p><p>æ‰€æœ‰åœ¨æ•°æ®ä¸­å¿ƒçš„ä»£ç†éƒ½ä¼šå‚ä¸ä¸€ä¸ª<a href=https://www.consul.io/docs/internals/gossip%e3%80%81><strong>Gossip</strong>åè®®</a>ã€‚è¿™ä»£è¡¨æœ‰ä¸€ä¸ª <code>Gossip</code> æ± ï¼Œå…¶ä¸­ä¿å­˜ç€è¿™ä¸ªæ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰ Agentã€‚è¿™ä¹ˆåšç›®çš„åœ¨äºï¼š</p><ol><li>å®¢æˆ·ç«¯ä¸éœ€è¦é…ç½® Serveråœ°å€ï¼Œå‘ç°å·¥ä½œæ˜¯è‡ªåŠ¨å®Œæˆçš„</li><li>æ£€æµ‹ä»£ç†æ•…éšœçš„å·¥ä½œä¸æ”¾åœ¨å•ä¸ªServerä¸Šè€Œæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä½¿å¾—æ•…éšœæ£€æµ‹çš„æ‰©å±•æ€§æ¯”åŸç”Ÿçš„å¿ƒè·³æ–¹æ¡ˆè¦å¼ºå¾—å¤šã€‚åŒæ—¶è¿˜ä¸ºèŠ‚ç‚¹æä¾›äº†æ•…éšœæ£€æµ‹ï¼Œå¦‚æœä»£ç†æ— æ³•åˆ°è¾¾ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å¯èƒ½å·²ç»å‘ç”Ÿäº†æ•…éšœ</li><li>å®ƒè¢«ç”¨ä½œæ¶ˆæ¯å±‚ï¼Œå½“å‘ç”Ÿé‡è¦äº‹ä»¶ï¼ˆå¦‚Leader é€‰ä¸¾ï¼‰æ—¶è¿›è¡Œé€šçŸ¥</li></ol><p>æ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„ Server éƒ½ä¼šå‚ä¸å…±åŒé€‰ä¸¾å‡ºä¸€ä¸ª Leaderï¼Œå¦‚æœä¸€ä¸ª Server è¢«é€‰ä¸­ä¸º Leader é‚£å®ƒä¼šæœ‰é¢å¤–çš„èŒè´£ï¼š<strong>Leaderè´Ÿè´£å¤„ç†æ‰€æœ‰æŸ¥è¯¢å’Œäº‹åŠ¡</strong>ã€‚äº‹åŠ¡ä¹Ÿä¼šå¤åˆ¶åˆ°æ‰€æœ‰å‚ä¸é€‰ä¸¾çš„ Serverã€‚ç”±äºè¿™ä¸ªè¦æ±‚ï¼Œå½“ <code>None-Leader Server</code> æ”¶åˆ°RPCè¯·æ±‚æ—¶ï¼Œä¼šå°†å…¶è½¬å‘ç»™é›†ç¾¤Leaderã€‚</p><blockquote class=book-hint><p>The server agents also operate as part of a WAN gossip pool. This pool is different from the LAN pool as it is optimized for the higher latency of the internet and is expected to contain only other Consul server agents. The purpose of this pool is to allow datacenters to discover each other in a low-touch manner. Bringing a new datacenter online is as easy as joining the existing WAN gossip pool. Because the servers are all operating in this pool, it also enables cross-datacenter requests. When a server receives a request for a different datacenter, it forwards it to a random server in the correct datacenter. That server may then forward to the local leader.</p><p>This results in a very low coupling between datacenters, but because of failure detection, connection caching and multiplexing, cross-datacenter requests are relatively fast and reliable.</p><p>In general, data is not replicated between different Consul datacenters. When a request is made for a resource in another datacenter, the local Consul servers forward an RPC request to the remote Consul servers for that resource and return the results. If the remote datacenter is not available, then those resources will also not be available, but that won&rsquo;t otherwise affect the local datacenter. There are some special situations where a limited subset of data can be replicated, such as with Consul&rsquo;s built-in <a href=https://learn.hashicorp.com/tutorials/consul/access-control-replication-multiple-datacenters>ACL replication</a> capability, or external tools like <a href=https://github.com/hashicorp/consul-replicate>consul-replicate</a>.</p><p>In some places, client agents may cache data from the servers to make it available locally for performance and reliability. Examples include Connect certificates and intentions which allow the client agent to make local decisions about inbound connection requests without a round trip to the servers. Some API endpoints also support optional result caching. This helps reliability because the local agent can continue to respond to some queries like service-discovery or Connect authorization from cache even if the connection to the servers is disrupted or the servers are temporarily unavailable.</p></blockquote><h1 id=consul-å®‰è£…>Consul å®‰è£…<a class=anchor href=#consul-%e5%ae%89%e8%a3%85>#</a></h1><p>å®‰è£… Consul æ²¡ä»€ä¹ˆéš¾åº¦ã€‚å…·ä½“å‚è€ƒå®˜ç½‘ï¼š<a href=https://www.consul.io/docs/install>Consul å®‰è£…</a> ï¼Œè¿™é‡Œåªè®°å½•å¦‚ä½•ä½¿ç”¨ Docker å®‰è£… Consulã€‚</p><p>å‡†å¤‡ Consul é•œåƒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull consul <span style=color:#75715e># é»˜è®¤æ‹‰å–latest</span>
</span></span><span style=display:flex><span>docker pull consul:1.6.1 <span style=color:#75715e># æ‹‰å–æŒ‡å®šç‰ˆæœ¬</span></span></span></code></pre></div><p>éªŒè¯å®‰è£…ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@centos-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># docker exec -it consul /bin/sh</span>
</span></span><span style=display:flex><span>/ <span style=color:#75715e># consul </span>
</span></span><span style=display:flex><span>Usage: consul <span style=color:#f92672>[</span>--version<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--help<span style=color:#f92672>]</span> &lt;command&gt; <span style=color:#f92672>[</span>&lt;args&gt;<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Available commands are:
</span></span><span style=display:flex><span>    acl            Interact with Consul<span style=color:#e6db74>&#39;s ACLs
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    agent          Runs a Consul agent
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    catalog        Interact with the catalog
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    config         Interact with Consul&#39;</span>s Centralized Configurations
</span></span><span style=display:flex><span>    connect        Interact with Consul Connect
</span></span><span style=display:flex><span>    debug          Records a debugging archive <span style=color:#66d9ef>for</span> operators
</span></span><span style=display:flex><span>    event          Fire a new event
</span></span><span style=display:flex><span>    exec           Executes a command on Consul nodes
</span></span><span style=display:flex><span>    force-leave    Forces a member of the cluster to enter the <span style=color:#e6db74>&#34;left&#34;</span> state
</span></span><span style=display:flex><span>    info           Provides debugging information <span style=color:#66d9ef>for</span> operators.
</span></span><span style=display:flex><span>    intention      Interact with Connect service intentions
</span></span><span style=display:flex><span>    join           Tell Consul agent to join cluster
</span></span><span style=display:flex><span>    keygen         Generates a new encryption key
</span></span><span style=display:flex><span>    keyring        Manages gossip layer encryption keys
</span></span><span style=display:flex><span>    kv             Interact with the key-value store
</span></span><span style=display:flex><span>    leave          Gracefully leaves the Consul cluster and shuts down
</span></span><span style=display:flex><span>    lock           Execute a command holding a lock
</span></span><span style=display:flex><span>    login          Login to Consul using an auth method
</span></span><span style=display:flex><span>    logout         Destroy a Consul token created with login
</span></span><span style=display:flex><span>    maint          Controls node or service maintenance mode
</span></span><span style=display:flex><span>    members        Lists the members of a Consul cluster
</span></span><span style=display:flex><span>    monitor        Stream logs from a Consul agent
</span></span><span style=display:flex><span>    operator       Provides cluster-level tools <span style=color:#66d9ef>for</span> Consul operators</span></span></code></pre></div><h1 id=consul-server>Consul Server<a class=anchor href=#consul-server>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@centos-01 coresrc<span style=color:#f92672>]</span><span style=color:#75715e># docker run -d --name=consul_server -p 8500:8500 consul agent -server -bootstrap -ui -node=1 -client=&#39;0.0.0.0&#39;</span>
</span></span><span style=display:flex><span>355be46f502ca9f9e1498022e4c86fabf96c9e72b161cf4c71deff9c2012338b</span></span></code></pre></div><ul><li><code>agent</code>ï¼šå¯åŠ¨ agent è¿›ç¨‹ï¼ˆå‰é¢æè¿‡å¯åŠ¨ Consul å¿…é¡»è¿è¡Œ agentï¼‰</li><li><code>-server</code>ï¼šä»¥ Server æ¨¡å¼å¯åŠ¨</li><li><code>bootstrap</code>ï¼šè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹æ˜¯ <code>Server-Leader</code> ï¼Œä¸Šé¢è¯´è¿‡æ­£å¸¸æƒ…å†µä¸‹ Leader æ˜¯é€šè¿‡ Raft ç®—æ³•é€‰ä¸¾å‡ºæ¥çš„ï¼Œä½†æ˜¯é›†ç¾¤ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶éœ€è¦ä¸€ä¸ªå¼•å¯¼ Leaderï¼Œåœ¨å¼•å¯¼ç¾¤é›†åï¼Œå°±ä¸è¦ä½¿ç”¨æ­¤æ ‡å¿—äº†</li><li><code>node</code>ï¼šèŠ‚ç‚¹åç§°ï¼ˆé›†ç¾¤ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œé»˜è®¤æ˜¯è¯¥èŠ‚ç‚¹çš„ä¸»æœºåï¼‰</li><li><code>-client</code>ï¼šConsul æœåŠ¡ç›‘å¬åœ°å€ï¼ˆè¿™ä¸ªåœ°å€æä¾› HTTPã€DNSã€RPC ç­‰æœåŠ¡ï¼Œé»˜è®¤æ˜¯ <code>127.0.0.1</code> ä¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦å¯¹å¤–æä¾›æœåŠ¡æ”¹æˆ <code>0.0.0.0</code>ï¼‰</li></ul><p>å…¶å®ƒå‚æ•°ï¼š</p><ul><li><code>-bootstrap-expect</code> ï¼šåœ¨ä¸€ä¸ªæ•°æ®ä¸­å¿ƒä¸­æœŸæœ›æä¾›çš„ Server èŠ‚ç‚¹æ•°é‡ï¼Œå½“è¯¥å€¼æä¾›çš„æ—¶å€™ï¼ŒConsulä¸€ç›´ç­‰åˆ°è¾¾åˆ°æŒ‡å®š Sever æ•°ç›®çš„æ—¶å€™æ‰ä¼šå¼•å¯¼æ•´ä¸ªé›†ç¾¤ï¼Œè¯¥æ ‡è®°ä¸èƒ½å’Œ <code>bootstrap</code> å…±ç”¨</li><li><code>-bind</code>ï¼šè¯¥åœ°å€ç”¨æ¥åœ¨é›†ç¾¤å†…éƒ¨çš„é€šè®¯ï¼Œé›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹åˆ°åœ°å€éƒ½å¿…é¡»æ˜¯å¯è¾¾çš„ï¼Œé»˜è®¤æ˜¯ <code>0.0.0.0</code></li><li><code>ui</code>ï¼šå¯åŠ¨ Web UI ç®¡ç†å™¨ï¼ˆé»˜è®¤å¼€æ”¾ç«¯å£ <code>8500</code>ï¼‰</li><li><code>-rejoin</code>ï¼šä½¿ Consul å¿½ç•¥å…ˆå‰çš„ç¦»å¼€ï¼Œåœ¨å†æ¬¡å¯åŠ¨åä»æ—§å°è¯•åŠ å…¥é›†ç¾¤ä¸­</li><li><code>-config-dir</code>ï¼šé…ç½®æ–‡ä»¶ç›®å½•ï¼Œé‡Œé¢æ‰€æœ‰ä»¥.jsonç»“å°¾çš„æ–‡ä»¶éƒ½ä¼šè¢«åŠ è½½</li></ul><p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@centos-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># docker exec -it consul  consul members</span>
</span></span><span style=display:flex><span>Node  Address          Status  Type    Build   Protocol  DC   Segment
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>     172.17.0.2:8301  alive   server  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;all&gt;</span></span></code></pre></div><h1 id=consul-server-é›†ç¾¤>Consul Server é›†ç¾¤<a class=anchor href=#consul-server-%e9%9b%86%e7%be%a4>#</a></h1><p>åŠ å…¥ä¸¤ä¸ª Server æ¨¡å¼çš„ Consul åˆ°é›†ç¾¤ä¸­ã€‚Server æ¨¡å¼åœ¨é›†ç¾¤ä¸­å»ºè®®æ˜¯ 3ä¸ªä»¥ä¸Šï¼Œè¿™æ ·æ›´å¥½çš„é¿å…å› ä¸º Server çš„å®•æœºå¯¼è‡´æ•´ä¸ªé›†ç¾¤æŒ‚æ‰çš„é£é™©ï¼Œåšåˆ°é«˜å¯ç”¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d  --name<span style=color:#f92672>=</span>consul_server2  consul  agent -server -bootstrap  -node<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> -client<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span> -join<span style=color:#f92672>=</span>172.17.0.2
</span></span><span style=display:flex><span>docker run -d  --name<span style=color:#f92672>=</span>consul_server3  consul  agent -server -bootstrap  -node<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> -client<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span> -join<span style=color:#f92672>=</span>172.17.0.2</span></span></code></pre></div><p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@centos-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># docker exec -it consul_server  consul members</span>
</span></span><span style=display:flex><span>Node  Address          Status  Type    Build   Protocol  DC   Segment
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>     172.17.0.2:8301  alive   server  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;all&gt;
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>     172.17.0.3:8301  alive   server  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;all&gt;
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>     172.17.0.4:8301  alive   server  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;all&gt;</span></span></code></pre></div><h1 id=consul-client-åŠ å…¥é›†ç¾¤>Consul Client åŠ å…¥é›†ç¾¤<a class=anchor href=#consul-client-%e5%8a%a0%e5%85%a5%e9%9b%86%e7%be%a4>#</a></h1><p>Client åœ¨ Consul é›†ç¾¤ä¸­èµ·åˆ°äº†ä»£ç† Server çš„ä½œç”¨ï¼ŒClient æ¨¡å¼ä¸æŒä¹…åŒ–æ•°æ®ã€‚ä¸€èˆ¬æƒ…å†µæ¯å°åº”ç”¨æœåŠ¡å™¨éƒ½ä¼šå®‰è£…ä¸€ä¸ª Client ï¼Œè¿™æ ·å¯ä»¥å‡è½»è·¨æœåŠ¡å™¨è®¿é—®å¸¦æ¥æ€§èƒ½æŸè€—ã€‚ä¹Ÿå¯ä»¥å‡è½» Server çš„è¯·æ±‚å‹åŠ›ã€‚</p><p>åŠ å…¥ä¸¤ä¸ª Client æ¨¡å¼çš„ Consulï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name<span style=color:#f92672>=</span>consul_client1 consul agent -client -node<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> -join<span style=color:#f92672>=</span>172.17.0.2 -client<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>
</span></span><span style=display:flex><span>docker run -d --name<span style=color:#f92672>=</span>consul_client2 consul agent -client -node<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> -join<span style=color:#f92672>=</span>172.17.0.2 -client<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span></span></span></code></pre></div><p>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@centos-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># docker exec -it consul_server  consul members</span>
</span></span><span style=display:flex><span>Node          Address          Status  Type    Build   Protocol  DC   Segment
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>             172.17.0.2:8301  alive   server  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;all&gt;
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>             172.17.0.3:8301  alive   server  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;all&gt;
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>             172.17.0.4:8301  alive   server  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;all&gt;
</span></span><span style=display:flex><span>53c94791711e  172.17.0.5:8301  alive   client  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;default&gt;
</span></span><span style=display:flex><span>fa871a7045ec  172.17.0.6:8301  alive   client  1.10.2  <span style=color:#ae81ff>2</span>         dc1  &lt;default&gt;</span></span></code></pre></div><h1 id=consul-å¯¹å¤–æ¥å£>Consul å¯¹å¤–æ¥å£<a class=anchor href=#consul-%e5%af%b9%e5%a4%96%e6%8e%a5%e5%8f%a3>#</a></h1><ul><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8500%2Fv1%2Fstatus%2Fleader">http://localhost:8500/v1/status/leader</a>: æ˜¾ç¤ºå½“å‰é›†ç¾¤çš„Leader</li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8500%2Fv1%2Fagent%2Fmembers">http://localhost:8500/v1/agent/members</a>ï¼š æŸ¥çœ‹é›†ç¾¤æˆå‘˜çš„è¯¦ç»†ä¿¡æ¯</li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8500%2Fv1%2Fstatus%2Fpeers">http://localhost:8500/v1/status/peers</a>ï¼šæ˜¾ç¤ºé›†ç¾¤ä¸­çš„Serveræˆå‘˜</li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8500%2Fv1%2Fcatalog%2Fservices">http://localhost:8500/v1/catalog/services</a>ï¼š æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡</li><li><a href="https://links.jianshu.com/go?to=http%3A%2F%2Flocalhost%3A8500%2Fv1%2Fcatalog%2Fnodes">http://localhost:8500/v1/catalog/nodes</a>ï¼šæ˜¾ç¤ºé›†ç¾¤èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯</li></ul><h1 id=å‚è€ƒ>å‚è€ƒï¼š<a class=anchor href=#%e5%8f%82%e8%80%83>#</a></h1><ul><li><a href=https://www.consul.io/docs/install>https://www.consul.io/docs/install</a></li><li><a href=https://www.bookstack.cn/read/consul-guide/06_setup_cluster.md>https://www.bookstack.cn/read/consul-guide/06_setup_cluster.md</a></li><li><a href=https://cloud.tencent.com/developer/article/1416526>https://cloud.tencent.com/developer/article/1416526</a></li><li><a href=https://www.jianshu.com/p/b12037fa3249>https://www.jianshu.com/p/b12037fa3249</a></li><li><a href=https://blog.csdn.net/liuzhuchen/article/details/81913562>https://blog.csdn.net/liuzhuchen/article/details/81913562</a></li><li><a href=http://www.liangxiansen.cn/2017/04/06/consul/#%E4%BD%BF%E7%94%A8consul>http://www.liangxiansen.cn/2017/04/06/consul/#%E4%BD%BF%E7%94%A8consul</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/docs/microservice/1.5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8Bdockercompose/ class="flex align-center"><img src=/icons/backward.svg class=book-icon alt=Backward>
<span>1.5å¾®æœåŠ¡å…¥é—¨ä¹‹ Docker Compose</span>
</a></span><span><a href=/docs/redis/1.10redis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/ class="flex align-center"><span>1.10 Rediså¸¸è§é—®é¢˜</span>
<img src=/icons/forward.svg class=book-icon alt=Forward></a></span></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>