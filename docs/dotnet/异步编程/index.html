<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='å¯¹äºå¤šçº¿ç¨‹ï¼Œç»å¸¸ä½¿ç”¨çš„æ˜¯ Threadã€‚åœ¨äº†è§£ Task ä¹‹å‰ï¼Œå¦‚æœè¦ä½¿ç”¨å¤šæ ¸çš„åŠŸèƒ½å¯èƒ½å°±ä¼šè‡ªå·±æ¥å¼€çº¿ç¨‹ï¼Œç„¶è€Œè¿™ç§çº¿ç¨‹æ¨¡å‹åœ¨ .net 4.0 ä¹‹åè¢«ä¸€ç§ç§°ä¸º åŸºäºâ€œä»»åŠ¡çš„ç¼–ç¨‹æ¨¡å‹â€ æ‰€å†²å‡»ï¼Œè¿™å°±æ˜¯ Taskã€‚
Task ä¼šæ¯” Thread å…·æœ‰æ›´å°çš„æ€§èƒ½å¼€é”€ï¼ŒTask æ˜¯æ¶æ„åœ¨ Thread ä¹‹ä¸Šçš„å°±æ˜¯è¯´ Task æœ€ç»ˆè¿˜æ˜¯ä¼šæŠ›ç»™çº¿ç¨‹å»åšï¼Œå¹¶ä¸”ä»»åŠ¡è·Ÿçº¿ç¨‹ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ¯”å¦‚å¼€ 10 ä¸ªä»»åŠ¡å¹¶ä¸æ˜¯è¯´ä¼šå¼€ 10 ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸€ç‚¹ä»»åŠ¡æœ‰ç‚¹ç±»ä¼¼çº¿ç¨‹æ± ï¼Œä½†æ˜¯ä»»åŠ¡ç›¸æ¯”çº¿ç¨‹æ± æœ‰å¾ˆå°çš„å¼€é”€å’Œç²¾ç¡®çš„æ§åˆ¶ã€‚Task ç±»çš„è¡¨ç¤ºå•ä¸ªæ“ä½œä¸è¿”å›ä¸€ä¸ªå€¼ï¼Œé€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼ŒTask å¯¹è±¡æ˜¯ "åŸºäºä»»åŠ¡çš„å¼‚æ­¥æ¨¡å¼â€œ é¦–æ¬¡å¼•å…¥ .NET Framework 4 ä¸­ã€‚
å› ä¸ºç”±æ‰§è¡Œå·¥ä½œ Task å¯¹è±¡é€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œåœ¨çº¿ç¨‹æ± çº¿ç¨‹ä¸Šè€Œä¸æ˜¯ä»¥åŒæ­¥æ–¹å¼åœ¨ä¸»åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨Status å±æ€§ï¼Œä»¥åŠ IsCanceled,IsCompleted, å’Œ IsFaultedå±æ€§ï¼Œä»¥ç¡®å®šä»»åŠ¡çš„çŠ¶æ€ã€‚
ç›¸å…³æ¦‚å¿µç†è§£# åŒæ­¥ï¼ˆSynchronousï¼‰ å¼‚æ­¥ (Asynchronous) é˜»å¡ (Blocking) éé˜»å¡(Nonblocking) åŒæ­¥/å¼‚æ­¥æŒ‡çš„æ˜¯åœ¨å®¢æˆ·ç«¯
åŒæ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºäº†ä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œåœ¨å›åº”ä¹‹å‰åªèƒ½ç­‰å¾… å¼‚æ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œè¿˜å¯ä»¥ç»§ç»­æå…¶ä»–è¯·æ±‚
é˜»å¡/éé˜»å¡æŒ‡çš„æ˜¯æœåŠ¡å™¨ç«¯
é˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œåœ¨è¿”å›ç»“æœä»¥å‰ä¸èƒ½æ¥å—å…¶ä»–è¯·æ±‚ éé˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œå°½ç®¡æ²¡æœ‰è¿”å›ç»“æœï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­æ¥å—å…¶ä»–è¯·æ±‚
åŒæ­¥ä¸å¼‚æ­¥# åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ (synchronous communication/ asynchronous communication)
æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”±è°ƒç”¨è€…ä¸»åŠ¨ç­‰å¾…è¿™ä¸ªè°ƒç”¨çš„ç»“æœã€‚
è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ,è€Œæ˜¯åœ¨è°ƒç”¨å‘å‡ºåï¼Œè¢«è°ƒç”¨è€…é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚(å…¸å‹çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ¯”å¦‚Node.js)
åŒæ­¥é€šä¿¡æœºåˆ¶
ä½ æ‰“ç”µè¯é—®ä¹¦åº—è€æ¿æœ‰æ²¡æœ‰ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œå¦‚æœæ˜¯åŒæ­¥é€šä¿¡æœºåˆ¶ï¼Œä¹¦åº—è€æ¿ä¼šè¯´ï¼Œä½ ç¨ç­‰ï¼Œâ€œæˆ‘æŸ¥ä¸€ä¸‹â€ï¼Œç„¶åå¼€å§‹æŸ¥å•ŠæŸ¥ï¼Œç­‰æŸ¥å¥½äº†ï¼ˆå¯èƒ½æ˜¯5ç§’ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å¤©ï¼‰å‘Šè¯‰ä½ ç»“æœï¼ˆè¿”å›ç»“æœï¼‰
å¼‚æ­¥é€šä¿¡æœºåˆ¶
ä¹¦åº—è€æ¿ç›´æ¥å‘Šè¯‰ä½ æˆ‘æŸ¥ä¸€ä¸‹å•Šï¼ŒæŸ¥å¥½äº†æ‰“ç”µè¯ç»™ä½ ï¼Œç„¶åç›´æ¥æŒ‚ç”µè¯äº†ï¼ˆä¸è¿”å›ç»“æœï¼‰ã€‚ç„¶åæŸ¥å¥½äº†ï¼Œä»–ä¼šä¸»åŠ¨æ‰“ç”µè¯ç»™ä½ ã€‚åœ¨è¿™é‡Œè€æ¿é€šè¿‡"å›ç”µ"è¿™ç§æ–¹å¼æ¥å›è°ƒ
é˜»å¡ä¸éé˜»å¡# é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€ï¼Œé˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹
Example
'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://wangpengliang815.github.io/docs/dotnet/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"><meta property="og:site_name" content="CODE'NOTE"><meta property="og:title" content="CODE'NOTE"><meta property="og:description" content='å¯¹äºå¤šçº¿ç¨‹ï¼Œç»å¸¸ä½¿ç”¨çš„æ˜¯ Threadã€‚åœ¨äº†è§£ Task ä¹‹å‰ï¼Œå¦‚æœè¦ä½¿ç”¨å¤šæ ¸çš„åŠŸèƒ½å¯èƒ½å°±ä¼šè‡ªå·±æ¥å¼€çº¿ç¨‹ï¼Œç„¶è€Œè¿™ç§çº¿ç¨‹æ¨¡å‹åœ¨ .net 4.0 ä¹‹åè¢«ä¸€ç§ç§°ä¸º åŸºäºâ€œä»»åŠ¡çš„ç¼–ç¨‹æ¨¡å‹â€ æ‰€å†²å‡»ï¼Œè¿™å°±æ˜¯ Taskã€‚
Task ä¼šæ¯” Thread å…·æœ‰æ›´å°çš„æ€§èƒ½å¼€é”€ï¼ŒTask æ˜¯æ¶æ„åœ¨ Thread ä¹‹ä¸Šçš„å°±æ˜¯è¯´ Task æœ€ç»ˆè¿˜æ˜¯ä¼šæŠ›ç»™çº¿ç¨‹å»åšï¼Œå¹¶ä¸”ä»»åŠ¡è·Ÿçº¿ç¨‹ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ¯”å¦‚å¼€ 10 ä¸ªä»»åŠ¡å¹¶ä¸æ˜¯è¯´ä¼šå¼€ 10 ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸€ç‚¹ä»»åŠ¡æœ‰ç‚¹ç±»ä¼¼çº¿ç¨‹æ± ï¼Œä½†æ˜¯ä»»åŠ¡ç›¸æ¯”çº¿ç¨‹æ± æœ‰å¾ˆå°çš„å¼€é”€å’Œç²¾ç¡®çš„æ§åˆ¶ã€‚Task ç±»çš„è¡¨ç¤ºå•ä¸ªæ“ä½œä¸è¿”å›ä¸€ä¸ªå€¼ï¼Œé€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼ŒTask å¯¹è±¡æ˜¯ "åŸºäºä»»åŠ¡çš„å¼‚æ­¥æ¨¡å¼â€œ é¦–æ¬¡å¼•å…¥ .NET Framework 4 ä¸­ã€‚
å› ä¸ºç”±æ‰§è¡Œå·¥ä½œ Task å¯¹è±¡é€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œåœ¨çº¿ç¨‹æ± çº¿ç¨‹ä¸Šè€Œä¸æ˜¯ä»¥åŒæ­¥æ–¹å¼åœ¨ä¸»åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨Status å±æ€§ï¼Œä»¥åŠ IsCanceled,IsCompleted, å’Œ IsFaultedå±æ€§ï¼Œä»¥ç¡®å®šä»»åŠ¡çš„çŠ¶æ€ã€‚
ç›¸å…³æ¦‚å¿µç†è§£# åŒæ­¥ï¼ˆSynchronousï¼‰ å¼‚æ­¥ (Asynchronous) é˜»å¡ (Blocking) éé˜»å¡(Nonblocking) åŒæ­¥/å¼‚æ­¥æŒ‡çš„æ˜¯åœ¨å®¢æˆ·ç«¯
åŒæ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºäº†ä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œåœ¨å›åº”ä¹‹å‰åªèƒ½ç­‰å¾… å¼‚æ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œè¿˜å¯ä»¥ç»§ç»­æå…¶ä»–è¯·æ±‚
é˜»å¡/éé˜»å¡æŒ‡çš„æ˜¯æœåŠ¡å™¨ç«¯
é˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œåœ¨è¿”å›ç»“æœä»¥å‰ä¸èƒ½æ¥å—å…¶ä»–è¯·æ±‚ éé˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œå°½ç®¡æ²¡æœ‰è¿”å›ç»“æœï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­æ¥å—å…¶ä»–è¯·æ±‚
åŒæ­¥ä¸å¼‚æ­¥# åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ (synchronous communication/ asynchronous communication)
æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”±è°ƒç”¨è€…ä¸»åŠ¨ç­‰å¾…è¿™ä¸ªè°ƒç”¨çš„ç»“æœã€‚
è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ,è€Œæ˜¯åœ¨è°ƒç”¨å‘å‡ºåï¼Œè¢«è°ƒç”¨è€…é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚(å…¸å‹çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ¯”å¦‚Node.js)
åŒæ­¥é€šä¿¡æœºåˆ¶
ä½ æ‰“ç”µè¯é—®ä¹¦åº—è€æ¿æœ‰æ²¡æœ‰ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œå¦‚æœæ˜¯åŒæ­¥é€šä¿¡æœºåˆ¶ï¼Œä¹¦åº—è€æ¿ä¼šè¯´ï¼Œä½ ç¨ç­‰ï¼Œâ€œæˆ‘æŸ¥ä¸€ä¸‹â€ï¼Œç„¶åå¼€å§‹æŸ¥å•ŠæŸ¥ï¼Œç­‰æŸ¥å¥½äº†ï¼ˆå¯èƒ½æ˜¯5ç§’ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å¤©ï¼‰å‘Šè¯‰ä½ ç»“æœï¼ˆè¿”å›ç»“æœï¼‰
å¼‚æ­¥é€šä¿¡æœºåˆ¶
ä¹¦åº—è€æ¿ç›´æ¥å‘Šè¯‰ä½ æˆ‘æŸ¥ä¸€ä¸‹å•Šï¼ŒæŸ¥å¥½äº†æ‰“ç”µè¯ç»™ä½ ï¼Œç„¶åç›´æ¥æŒ‚ç”µè¯äº†ï¼ˆä¸è¿”å›ç»“æœï¼‰ã€‚ç„¶åæŸ¥å¥½äº†ï¼Œä»–ä¼šä¸»åŠ¨æ‰“ç”µè¯ç»™ä½ ã€‚åœ¨è¿™é‡Œè€æ¿é€šè¿‡"å›ç”µ"è¿™ç§æ–¹å¼æ¥å›è°ƒ
é˜»å¡ä¸éé˜»å¡# é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€ï¼Œé˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹
Example'><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="CODE'NOTE"><meta itemprop=description content='å¯¹äºå¤šçº¿ç¨‹ï¼Œç»å¸¸ä½¿ç”¨çš„æ˜¯ Threadã€‚åœ¨äº†è§£ Task ä¹‹å‰ï¼Œå¦‚æœè¦ä½¿ç”¨å¤šæ ¸çš„åŠŸèƒ½å¯èƒ½å°±ä¼šè‡ªå·±æ¥å¼€çº¿ç¨‹ï¼Œç„¶è€Œè¿™ç§çº¿ç¨‹æ¨¡å‹åœ¨ .net 4.0 ä¹‹åè¢«ä¸€ç§ç§°ä¸º åŸºäºâ€œä»»åŠ¡çš„ç¼–ç¨‹æ¨¡å‹â€ æ‰€å†²å‡»ï¼Œè¿™å°±æ˜¯ Taskã€‚
Task ä¼šæ¯” Thread å…·æœ‰æ›´å°çš„æ€§èƒ½å¼€é”€ï¼ŒTask æ˜¯æ¶æ„åœ¨ Thread ä¹‹ä¸Šçš„å°±æ˜¯è¯´ Task æœ€ç»ˆè¿˜æ˜¯ä¼šæŠ›ç»™çº¿ç¨‹å»åšï¼Œå¹¶ä¸”ä»»åŠ¡è·Ÿçº¿ç¨‹ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ¯”å¦‚å¼€ 10 ä¸ªä»»åŠ¡å¹¶ä¸æ˜¯è¯´ä¼šå¼€ 10 ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸€ç‚¹ä»»åŠ¡æœ‰ç‚¹ç±»ä¼¼çº¿ç¨‹æ± ï¼Œä½†æ˜¯ä»»åŠ¡ç›¸æ¯”çº¿ç¨‹æ± æœ‰å¾ˆå°çš„å¼€é”€å’Œç²¾ç¡®çš„æ§åˆ¶ã€‚Task ç±»çš„è¡¨ç¤ºå•ä¸ªæ“ä½œä¸è¿”å›ä¸€ä¸ªå€¼ï¼Œé€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼ŒTask å¯¹è±¡æ˜¯ "åŸºäºä»»åŠ¡çš„å¼‚æ­¥æ¨¡å¼â€œ é¦–æ¬¡å¼•å…¥ .NET Framework 4 ä¸­ã€‚
å› ä¸ºç”±æ‰§è¡Œå·¥ä½œ Task å¯¹è±¡é€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œåœ¨çº¿ç¨‹æ± çº¿ç¨‹ä¸Šè€Œä¸æ˜¯ä»¥åŒæ­¥æ–¹å¼åœ¨ä¸»åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨Status å±æ€§ï¼Œä»¥åŠ IsCanceled,IsCompleted, å’Œ IsFaultedå±æ€§ï¼Œä»¥ç¡®å®šä»»åŠ¡çš„çŠ¶æ€ã€‚
ç›¸å…³æ¦‚å¿µç†è§£# åŒæ­¥ï¼ˆSynchronousï¼‰ å¼‚æ­¥ (Asynchronous) é˜»å¡ (Blocking) éé˜»å¡(Nonblocking) åŒæ­¥/å¼‚æ­¥æŒ‡çš„æ˜¯åœ¨å®¢æˆ·ç«¯
åŒæ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºäº†ä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œåœ¨å›åº”ä¹‹å‰åªèƒ½ç­‰å¾… å¼‚æ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œè¿˜å¯ä»¥ç»§ç»­æå…¶ä»–è¯·æ±‚
é˜»å¡/éé˜»å¡æŒ‡çš„æ˜¯æœåŠ¡å™¨ç«¯
é˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œåœ¨è¿”å›ç»“æœä»¥å‰ä¸èƒ½æ¥å—å…¶ä»–è¯·æ±‚ éé˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œå°½ç®¡æ²¡æœ‰è¿”å›ç»“æœï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­æ¥å—å…¶ä»–è¯·æ±‚
åŒæ­¥ä¸å¼‚æ­¥# åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ (synchronous communication/ asynchronous communication)
æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”±è°ƒç”¨è€…ä¸»åŠ¨ç­‰å¾…è¿™ä¸ªè°ƒç”¨çš„ç»“æœã€‚
è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ,è€Œæ˜¯åœ¨è°ƒç”¨å‘å‡ºåï¼Œè¢«è°ƒç”¨è€…é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚(å…¸å‹çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ¯”å¦‚Node.js)
åŒæ­¥é€šä¿¡æœºåˆ¶
ä½ æ‰“ç”µè¯é—®ä¹¦åº—è€æ¿æœ‰æ²¡æœ‰ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œå¦‚æœæ˜¯åŒæ­¥é€šä¿¡æœºåˆ¶ï¼Œä¹¦åº—è€æ¿ä¼šè¯´ï¼Œä½ ç¨ç­‰ï¼Œâ€œæˆ‘æŸ¥ä¸€ä¸‹â€ï¼Œç„¶åå¼€å§‹æŸ¥å•ŠæŸ¥ï¼Œç­‰æŸ¥å¥½äº†ï¼ˆå¯èƒ½æ˜¯5ç§’ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å¤©ï¼‰å‘Šè¯‰ä½ ç»“æœï¼ˆè¿”å›ç»“æœï¼‰
å¼‚æ­¥é€šä¿¡æœºåˆ¶
ä¹¦åº—è€æ¿ç›´æ¥å‘Šè¯‰ä½ æˆ‘æŸ¥ä¸€ä¸‹å•Šï¼ŒæŸ¥å¥½äº†æ‰“ç”µè¯ç»™ä½ ï¼Œç„¶åç›´æ¥æŒ‚ç”µè¯äº†ï¼ˆä¸è¿”å›ç»“æœï¼‰ã€‚ç„¶åæŸ¥å¥½äº†ï¼Œä»–ä¼šä¸»åŠ¨æ‰“ç”µè¯ç»™ä½ ã€‚åœ¨è¿™é‡Œè€æ¿é€šè¿‡"å›ç”µ"è¿™ç§æ–¹å¼æ¥å›è°ƒ
é˜»å¡ä¸éé˜»å¡# é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€ï¼Œé˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹
Example'><meta itemprop=wordCount content="948"><title>å¼‚æ­¥ç¼–ç¨‹ | CODE'NOTE</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://wangpengliang815.github.io/docs/dotnet/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/><link rel=stylesheet href=/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG+T2l66Bw7pV8=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.16bbea805e586532aeca5e48249564b81bcbb5a9d44401ea4658ef5e6a5e812f.js integrity="sha256-FrvqgF5YZTKuyl5IJJVkuBvLtanURAHqRljvXmpegS8=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-docs"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>CODE'NOTE</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-f32afe48992fac3b3fc76dc3b27dd1d5 class=toggle checked>
<label for=section-f32afe48992fac3b3fc76dc3b27dd1d5 class=flex><a role=button>ğŸ“š .NET</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/dotnet/%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/>å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„å†…å­˜åˆ†é…</a></li><li><a href=/docs/dotnet/%E5%8F%8D%E5%B0%84%E6%8A%80%E6%9C%AF/>åå°„æŠ€æœ¯</a></li><li><a href=/docs/dotnet/%E5%9F%BA%E7%A1%80%E5%90%88%E9%9B%86/>åŸºç¡€åˆé›†</a></li><li><a href=/docs/dotnet/%E5%A4%9A%E7%BA%BF%E7%A8%8B/>å¤šçº¿ç¨‹</a></li><li><a href=/docs/dotnet/%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6/>å§”æ‰˜å’Œäº‹ä»¶</a></li><li><a href=/docs/dotnet/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/>å¹¶è¡Œç¼–ç¨‹</a></li><li><a href=/docs/dotnet/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/ class=active>å¼‚æ­¥ç¼–ç¨‹</a></li><li><a href=/docs/dotnet/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/>æ•°æ®ç»“æ„</a></li><li><a href=/docs/dotnet/%E6%B3%9B%E5%9E%8B%E6%8A%80%E6%9C%AF/>æ³›å‹æŠ€æœ¯</a></li><li><a href=/docs/dotnet/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/>çº¿ç¨‹åŒæ­¥</a></li><li><a href=/docs/dotnet/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/>é¢å‘å¯¹è±¡</a></li></ul></li><li><input type=checkbox id=section-17ee4616d3316ecf2ecdb7c27cfa2a63 class=toggle>
<label for=section-17ee4616d3316ecf2ecdb7c27cfa2a63 class=flex><a role=button>ğŸ­ PMI-ACP</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/acp/pmi-acp%E5%9F%BA%E7%A1%80%E4%BA%86%E8%A7%A3/>Pmi AcpåŸºç¡€äº†è§£</a></li><li><a href=/docs/acp/pmi-acpdown/>Pmi Acpdown</a></li><li><a href=/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B001/>Pmi Acpå¤‡è€ƒç¬”è®°01</a></li><li><a href=/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B002/>Pmi Acpå¤‡è€ƒç¬”è®°02</a></li><li><a href=/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B003/>Pmi Acpå¤‡è€ƒç¬”è®°03</a></li></ul></li><li><input type=checkbox id=section-fba10961f5d9c66eab238d766cb1a791 class=toggle>
<label for=section-fba10961f5d9c66eab238d766cb1a791 class=flex><a role=button>âŒ› è½¯ä»¶æµ‹è¯•</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/test/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/>å•å…ƒæµ‹è¯•</a></li><li><a href=/docs/test/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95k6/>å‹åŠ›æµ‹è¯•k6</a></li><li><a href=/docs/test/%E8%87%AA%E5%8A%A8%E5%8C%96ui%E6%B5%8B%E8%AF%95/>è‡ªåŠ¨åŒ– Uiæµ‹è¯•</a></li><li><a href=/docs/test/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/>é›†æˆæµ‹è¯•</a></li></ul></li><li><input type=checkbox id=section-92cef1621a3b87cdf19787a11c3e85e0 class=toggle>
<label for=section-92cef1621a3b87cdf19787a11c3e85e0 class=flex><a role=button>â›·ï¸ Prometheus</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/prometheus/1.1prometheus%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%AE%89%E8%A3%85/>1.1 Prometheusç®€ä»‹åŠå®‰è£…</a></li><li><a href=/docs/prometheus/1.2exporter%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/>1.2 Exporteræ•°æ®é‡‡é›†</a></li><li><a href=/docs/prometheus/1.3promql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/>1.3 Prom QlæŸ¥è¯¢è¯­è¨€</a></li><li><a href=/docs/prometheus/1.4alertmanager%E5%91%8A%E8%AD%A6%E5%A4%84%E7%90%86/>1.4 Alertmanagerå‘Šè­¦å¤„ç†</a></li><li><a href=/docs/prometheus/1.5grafana%E7%9B%91%E6%8E%A7%E5%8F%AF%E8%A7%86%E5%8C%96/>1.5 Grafanaç›‘æ§å¯è§†åŒ–</a></li></ul></li><li><input type=checkbox id=section-c4b81cc06a2cdd0259ab09c2dde93fb5 class=toggle>
<label for=section-c4b81cc06a2cdd0259ab09c2dde93fb5 class=flex><a role=button>ğŸ‡ RabbitMq</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/rabbitmq/1.1rabbitmq%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/>1.1 Rabbit Mqæ¦‚å¿µåŠå®‰è£…</a></li><li><a href=/docs/rabbitmq/1.2%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D/>1.2å·¥ä½œæ¨¡å¼ä»‹ç»</a></li><li><a href=/docs/rabbitmq/1.3%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%8F%8A%E6%8C%81%E4%B9%85%E5%8C%96/>1.3æ¶ˆæ¯ç¡®è®¤åŠæŒä¹…åŒ–</a></li><li><a href=/docs/rabbitmq/1.4%E4%B8%A4%E7%A7%8D%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%BC%8F%E5%92%8Cqos%E7%9A%84%E5%AE%9E%E7%8E%B0/>1.4ä¸¤ç§æ¶ˆè´¹æ¨¡å¼å’Œ Qosçš„å®ç°</a></li><li><a href=/docs/rabbitmq/1.5channel%E5%B8%B8%E8%A7%81%E6%96%B9%E6%B3%95/>1.5 Channelå¸¸è§æ–¹æ³•</a></li><li><a href=/docs/rabbitmq/1.6rabbitmq%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>1.6 Rabbit Mqå¸¸ç”¨å‘½ä»¤</a></li><li><a href=/docs/rabbitmq/1.7rabbitmq%E5%B8%B8%E8%A7%81%E7%AD%96%E7%95%A5/>1.7 Rabbit Mqå¸¸è§ç­–ç•¥</a></li><li><a href=/docs/rabbitmq/1.8rabbitmq%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/>1.8 Rabbit Mqå¸¸è§é—®é¢˜</a></li><li><a href=/docs/rabbitmq/1.9rabbitmq%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/>1.9 Rabbit Mqé›†ç¾¤æ–¹æ¡ˆ</a></li><li><a href=/docs/rabbitmq/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5rabbitmq/>å®¢æˆ·ç«¯è¿æ¥ Rabbit Mq</a></li></ul></li><li><input type=checkbox id=section-45de5b9a6214c965d493f727c3af2aae class=toggle>
<label for=section-45de5b9a6214c965d493f727c3af2aae class=flex><a role=button>ğŸ¹ Golang</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/go/01%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/>01å¼€å‘ç¯å¢ƒæ­å»º</a></li><li><a href=/docs/go/02%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/>02å˜é‡å’Œå¸¸é‡</a></li><li><a href=/docs/go/03%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/>03åŸºæœ¬æ•°æ®ç±»å‹</a></li><li><a href=/docs/go/04%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/>04æµç¨‹æ§åˆ¶å’Œè¿ç®—ç¬¦</a></li><li><a href=/docs/go/05%E6%95%B0%E7%BB%84/>05æ•°ç»„</a></li><li><a href=/docs/go/06%E5%88%87%E7%89%87/>06åˆ‡ç‰‡</a></li><li><a href=/docs/go/07map/>07map</a></li><li><a href=/docs/go/08%E5%87%BD%E6%95%B0/>08å‡½æ•°</a></li><li><a href=/docs/go/09%E6%8C%87%E9%92%88/>09æŒ‡é’ˆ</a></li><li><a href=/docs/go/10%E5%8F%8D%E5%B0%84/>10åå°„</a></li><li><a href=/docs/go/11%E7%BB%93%E6%9E%84%E4%BD%93/>11ç»“æ„ä½“</a></li><li><a href=/docs/go/12%E6%8E%A5%E5%8F%A3/>12æ¥å£</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/channel/>Channel</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/csp%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/>Cspå¹¶å‘æ¨¡å‹</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/goroutine/>Goroutine</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/gpm%E5%8E%9F%E7%90%86%E4%B8%8E%E8%B0%83%E5%BA%A6/>GpmåŸç†ä¸è°ƒåº¦</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C/>åŸå­æ“ä½œ</a></li><li><a href=/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E5%92%8C%E9%94%81/>å¹¶å‘å®‰å…¨å’Œé”</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/flag/>Flag</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/fmt/>Fmt</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/log/>Log</a></li><li><a href=/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/time/>Time</a></li></ul></li><li><input type=checkbox id=section-61dde4567035e1fd2b5d2aa51b82a7a0 class=toggle>
<label for=section-61dde4567035e1fd2b5d2aa51b82a7a0 class=flex><a role=button>ğŸ’« Microservice</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/microservice/1.1%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/>1.1å¾®æœåŠ¡å…¥é—¨ä¹‹é¡¹ç›®æ­å»º</a></li><li><a href=/docs/microservice/1.2%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/>1.2å¾®æœåŠ¡å…¥é—¨ä¹‹æœåŠ¡æ³¨å†Œä¸å‘ç°</a></li><li><a href=/docs/microservice/1.3%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E7%BD%91%E5%85%B3/>1.3å¾®æœåŠ¡å…¥é—¨ä¹‹ç½‘å…³</a></li><li><a href=/docs/microservice/1.4%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/>1.4å¾®æœåŠ¡å…¥é—¨ä¹‹äº‹ä»¶æ€»çº¿</a></li><li><a href=/docs/microservice/1.5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8Bdockercompose/>1.5å¾®æœåŠ¡å…¥é—¨ä¹‹ Docker Compose</a></li><li><a href=/docs/microservice/consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%8F%91%E7%8E%B0/>ConsulæœåŠ¡æ³¨å†Œå‘ç°</a></li></ul></li><li><input type=checkbox id=section-e6c26370c56585ceaa14c64b7d769452 class=toggle>
<label for=section-e6c26370c56585ceaa14c64b7d769452 class=flex><a role=button>ğŸ“¦ Redis</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/redis/1.10redis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/>1.10 Rediså¸¸è§é—®é¢˜</a></li><li><a href=/docs/redis/1.1nosql%E6%A6%82%E8%BF%B0/>1.1 No Sqlæ¦‚è¿°</a></li><li><a href=/docs/redis/1.2redis%E5%AE%89%E8%A3%85/>1.2 Rediså®‰è£…</a></li><li><a href=/docs/redis/1.3redis%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/>1.3 RedisåŸºæœ¬æ•°æ®ç±»å‹</a></li><li><a href=/docs/redis/1.4redis%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/>1.4 Redisç‰¹æ®Šæ•°æ®ç±»å‹</a></li><li><a href=/docs/redis/1.5redis%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C/>1.5 Redisäº‹åŠ¡æ“ä½œ</a></li><li><a href=/docs/redis/1.6redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/>1.6 Redisé…ç½®æ–‡ä»¶è¯¦è§£</a></li><li><a href=/docs/redis/1.7redis%E6%8C%81%E4%B9%85%E5%8C%96/>1.7 RedisæŒä¹…åŒ–</a></li><li><a href=/docs/redis/1.8redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/>1.8 Rediså‘å¸ƒè®¢é˜…</a></li><li><a href=/docs/redis/1.9redis%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/>1.9 Redisé›†ç¾¤æ–¹æ¡ˆ</a></li><li><a href=/docs/redis/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/>ä½¿ç”¨ Dockeræ­å»º Redisé›†ç¾¤</a></li><li><a href=/docs/redis/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5redis/>å®¢æˆ·ç«¯è¿æ¥ Redis</a></li></ul></li><li><input type=checkbox id=section-f781adde1ca4021db6751ec1e71e0572 class=toggle>
<label for=section-f781adde1ca4021db6751ec1e71e0572 class=flex><a role=button>ğŸ” ELK</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/elk/1.1elastaticsearch%E5%85%A5%E9%97%A8/>1.1 Elastatic Searchå…¥é—¨</a></li><li><a href=/docs/elk/1.2elastaticsearch%E9%85%8D%E7%BD%AE/>1.2 Elastatic Searché…ç½®</a></li><li><a href=/docs/elk/1.3%E4%BD%BF%E7%94%A8kibana%E6%93%8D%E4%BD%9Ces/>1.3ä½¿ç”¨ Kibanaæ“ä½œ Es</a></li></ul></li><li><input type=checkbox id=section-17df8bdb44c678e43d193647c6ae88f1 class=toggle>
<label for=section-17df8bdb44c678e43d193647c6ae88f1 class=flex><a role=button>ğŸš¢ Docker</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/docker/1.1docker%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/>1.1 Dockeræ¦‚å¿µåŠå®‰è£…</a></li><li><a href=/docs/docker/1.2docker%E9%95%9C%E5%83%8F/>1.2 Dockeré•œåƒ</a></li><li><a href=/docs/docker/1.3docker%E5%AE%B9%E5%99%A8/>1.3 Dockerå®¹å™¨</a></li><li><a href=/docs/docker/1.4docker%E4%BB%93%E5%BA%93/>1.4 Dockerä»“åº“</a></li><li><a href=/docs/docker/1.5docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/>1.5 Dockeræ•°æ®ç®¡ç†</a></li><li><a href=/docs/docker/1.6docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F/>1.6 Dockerå®¹å™¨ç½‘ç»œæ¨¡å¼</a></li><li><a href=/docs/docker/1.7docker%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/>1.7 Dockeré«˜çº§ç½‘ç»œé…ç½®</a></li><li><a href=/docs/docker/1.8dockerfile/>1.8 Dockerfile</a></li><li><a href=/docs/docker/1.9dockercompose/>1.9 Docker Compose</a></li><li><a href=/docs/docker/2.0dockermachine/>2.0 Docker Machine</a></li><li><a href=/docs/docker/2.1dockerswarm/>2.1 Docker Swarm</a></li><li><a href=/docs/docker/2.2docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>2.2 Dockerå¸¸ç”¨å‘½ä»¤</a></li><li><a href=/docs/docker/2.3portainer%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF/>2.3 Portainerå¯è§†åŒ–é¢æ¿</a></li></ul></li><li><input type=checkbox id=section-566aa18ccd5b6b6934a70aded3a8361a class=toggle>
<label for=section-566aa18ccd5b6b6934a70aded3a8361a class=flex><a role=button>ğŸ•¸ï¸ K8s</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/kubernetes/kubernetes%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/>KubernetesåŸºç¡€çŸ¥è¯†</a></li><li><a href=/docs/kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/>Kubernetesé›†ç¾¤å®‰è£…</a></li></ul></li><li><input type=checkbox id=section-04176b4c8c5f502db36c25b60db03d67 class=toggle>
<label for=section-04176b4c8c5f502db36c25b60db03d67 class=flex><a role=button>ğŸ–¥ï¸ Linux</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/linux/centos7%E5%8D%87%E7%BA%A7gcc%E7%89%88%E6%9C%AC/>Centos7å‡çº§gccç‰ˆæœ¬</a></li><li><a href=/docs/linux/centos%E5%AE%89%E8%A3%85hexo/>Centoså®‰è£… Hexo</a></li><li><a href=/docs/linux/centos%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/>Centosç½‘ç»œé…ç½®</a></li><li><a href=/docs/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/>Linuxå¸¸ç”¨å‘½ä»¤</a></li><li><a href=/docs/linux/linux%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E/>Linuxç›®å½•è¯´æ˜</a></li><li><a href=/docs/linux/vmware%E5%AE%89%E8%A3%85centos/>Vmwareå®‰è£… Centos</a></li></ul></li><li><input type=checkbox id=section-9397a01455952fcbd887e2206a8a3054 class=toggle>
<label for=section-9397a01455952fcbd887e2206a8a3054 class=flex><a role=button>ğŸ›ï¸ Devops</a>
<img src=/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/docs/devops/gitlab%E5%AE%89%E8%A3%85/>Gitlabå®‰è£…</a></li><li><a href=/docs/devops/jenkins%E5%AE%89%E8%A3%85/>Jenkinså®‰è£…</a></li><li><a href=/docs/devops/jenkins%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/>Jenkinså¸¸è§æ“ä½œ</a></li><li><a href=/docs/devops/nugetserver%E6%90%AD%E5%BB%BA/>Nuget Serveræ­å»º</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/icons/menu.svg class=book-icon alt=Menu></label><h3>å¼‚æ­¥ç¼–ç¨‹</h3><label for=toc-control><img src=/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#å•çº¿ç¨‹åŒæ­¥æ¨¡å‹>å•çº¿ç¨‹åŒæ­¥æ¨¡å‹</a></li><li><a href=#å¤šçº¿ç¨‹æ¨¡å‹>å¤šçº¿ç¨‹æ¨¡å‹</a></li><li><a href=#å¼‚æ­¥æ¨¡å‹>å¼‚æ­¥æ¨¡å‹</a></li></ul><ul><li><a href=#åˆ›å»ºä»»åŠ¡>åˆ›å»ºä»»åŠ¡</a><ul><li><a href=#new-taskfactory>new TaskFactory()</a></li><li><a href=#taskfactory>Task.Factory</a></li><li><a href=#new-task>new Task()</a></li><li><a href=#taskrun>Task.Run</a></li></ul></li><li><a href=#åŒæ­¥ä»»åŠ¡>åŒæ­¥ä»»åŠ¡</a></li><li><a href=#ä½¿ç”¨å•ç‹¬çº¿ç¨‹çš„ä»»åŠ¡>ä½¿ç”¨å•ç‹¬çº¿ç¨‹çš„ä»»åŠ¡</a></li><li><a href=#taskç”Ÿå‘½å‘¨æœŸ>Taskç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#taskä»»åŠ¡æ§åˆ¶>Taskä»»åŠ¡æ§åˆ¶</a></li><li><a href=#taskè¿”å›ç±»å‹>Taskè¿”å›ç±»å‹</a><ul><li><a href=#void>void</a></li><li><a href=#task>Task</a></li><li><a href=#taskt><code>Task&lt;T></code></a></li></ul></li><li><a href=#è¿ç»­ä»»åŠ¡>è¿ç»­ä»»åŠ¡</a></li><li><a href=#åµŒå¥—task>åµŒå¥—Task</a><ul><li><a href=#å…³è”åµŒå¥—>å…³è”åµŒå¥—</a></li><li><a href=#éå…³è”åµŒå¥—>éå…³è”åµŒå¥—</a></li></ul></li><li><a href=#taskå–æ¶ˆ>Taskå–æ¶ˆ</a><ul><li><a href=#å•ä¸ªä»»åŠ¡>å•ä¸ªä»»åŠ¡</a></li><li><a href=#å¤šä¸ªä»»åŠ¡>å¤šä¸ªä»»åŠ¡</a></li><li><a href=#å®šæ—¶å–æ¶ˆ>å®šæ—¶å–æ¶ˆ</a></li></ul></li><li><a href=#å–æ¶ˆæ—¶å›è°ƒ>å–æ¶ˆæ—¶å›è°ƒ</a></li></ul><ul><li><a href=#asyncawaitå¹¶ä¸èƒ½æå‡æ€§èƒ½>async/awaitå¹¶ä¸èƒ½æå‡æ€§èƒ½?</a></li><li><a href=#asyncawaitæ­»é”é—®é¢˜>async/awaitæ­»é”é—®é¢˜</a><ul><li><a href=#å¯èƒ½å‘ç”Ÿæ­»é”çš„ç¨‹åºç±»å‹>å¯èƒ½å‘ç”Ÿæ­»é”çš„ç¨‹åºç±»å‹</a></li><li><a href=#ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿæ­»é”>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿæ­»é”?</a></li><li><a href=#æ­»é”çš„åŸå› >æ­»é”çš„åŸå› ?</a></li><li><a href=#there-is-no-thread>There Is No Thread</a></li><li><a href=#ä¸ä¼šé€ æˆæ­»é”çš„å……åˆ†æ¡ä»¶>ä¸ä¼šé€ æˆæ­»é”çš„å……åˆ†æ¡ä»¶</a></li></ul></li><li><a href=#å¦‚ä½•é¿å…æ­»é”>å¦‚ä½•é¿å…æ­»é”</a></li><li><a href=#æ›´å¤šæ­»é”ç›¸å…³>æ›´å¤šæ­»é”ç›¸å…³</a></li></ul></nav></aside></header><article class="markdown book-article"><p>å¯¹äºå¤šçº¿ç¨‹ï¼Œç»å¸¸ä½¿ç”¨çš„æ˜¯ <code>Thread</code>ã€‚åœ¨äº†è§£ <code>Task</code> ä¹‹å‰ï¼Œå¦‚æœè¦ä½¿ç”¨å¤šæ ¸çš„åŠŸèƒ½å¯èƒ½å°±ä¼šè‡ªå·±æ¥å¼€çº¿ç¨‹ï¼Œç„¶è€Œè¿™ç§çº¿ç¨‹æ¨¡å‹åœ¨ <code>.net 4.0</code> ä¹‹åè¢«ä¸€ç§ç§°ä¸º <code>åŸºäºâ€œä»»åŠ¡çš„ç¼–ç¨‹æ¨¡å‹â€</code> æ‰€å†²å‡»ï¼Œè¿™å°±æ˜¯ <code>Task</code>ã€‚</p><p><code>Task </code>ä¼šæ¯” <code>Thread</code> å…·æœ‰æ›´å°çš„æ€§èƒ½å¼€é”€ï¼Œ<code>Task </code>æ˜¯æ¶æ„åœ¨ <code>Thread</code> ä¹‹ä¸Šçš„å°±æ˜¯è¯´ <code>Task</code> æœ€ç»ˆè¿˜æ˜¯ä¼šæŠ›ç»™çº¿ç¨‹å»åšï¼Œå¹¶ä¸”ä»»åŠ¡è·Ÿçº¿ç¨‹ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ¯”å¦‚å¼€ 10 ä¸ªä»»åŠ¡å¹¶ä¸æ˜¯è¯´ä¼šå¼€ 10 ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸€ç‚¹ä»»åŠ¡æœ‰ç‚¹ç±»ä¼¼çº¿ç¨‹æ± ï¼Œä½†æ˜¯ä»»åŠ¡ç›¸æ¯”çº¿ç¨‹æ± æœ‰å¾ˆå°çš„å¼€é”€å’Œç²¾ç¡®çš„æ§åˆ¶ã€‚<code>Task</code> ç±»çš„è¡¨ç¤ºå•ä¸ªæ“ä½œä¸è¿”å›ä¸€ä¸ªå€¼ï¼Œé€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼Œ<code>Task</code> å¯¹è±¡æ˜¯ <code>"åŸºäºä»»åŠ¡çš„å¼‚æ­¥æ¨¡å¼â€œ</code> é¦–æ¬¡å¼•å…¥ <code>.NET Framework 4</code> ä¸­ã€‚</p><p>å› ä¸ºç”±æ‰§è¡Œå·¥ä½œ <code>Task</code> å¯¹è±¡é€šå¸¸ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œåœ¨çº¿ç¨‹æ± çº¿ç¨‹ä¸Šè€Œä¸æ˜¯ä»¥åŒæ­¥æ–¹å¼åœ¨ä¸»åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨<code>Status </code>å±æ€§ï¼Œä»¥åŠ <code>IsCanceled</code>,<code>IsCompleted</code>, å’Œ <code>IsFaulted</code>å±æ€§ï¼Œä»¥ç¡®å®šä»»åŠ¡çš„çŠ¶æ€ã€‚</p><h1 id=ç›¸å…³æ¦‚å¿µç†è§£>ç›¸å…³æ¦‚å¿µç†è§£<a class=anchor href=#%e7%9b%b8%e5%85%b3%e6%a6%82%e5%bf%b5%e7%90%86%e8%a7%a3>#</a></h1><ul><li>åŒæ­¥ï¼ˆSynchronousï¼‰</li><li>å¼‚æ­¥ (Asynchronous)</li><li>é˜»å¡ (Blocking)</li><li>éé˜»å¡(Nonblocking)</li></ul><p>åŒæ­¥/å¼‚æ­¥æŒ‡çš„æ˜¯åœ¨å®¢æˆ·ç«¯</p><blockquote class=book-hint><p>åŒæ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºäº†ä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œåœ¨å›åº”ä¹‹å‰åªèƒ½ç­‰å¾…
å¼‚æ­¥æ„å‘³ç€ï¼šå®¢æˆ·ç«¯æå‡ºä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œè¿˜å¯ä»¥ç»§ç»­æå…¶ä»–è¯·æ±‚</p></blockquote><p>é˜»å¡/éé˜»å¡æŒ‡çš„æ˜¯æœåŠ¡å™¨ç«¯</p><blockquote class=book-hint><p>é˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œåœ¨è¿”å›ç»“æœä»¥å‰ä¸èƒ½æ¥å—å…¶ä»–è¯·æ±‚
éé˜»å¡æ„å‘³ç€ï¼šæœåŠ¡å™¨æ¥å—ä¸€ä¸ªè¯·æ±‚åï¼Œå°½ç®¡æ²¡æœ‰è¿”å›ç»“æœï¼Œè¿˜æ˜¯å¯ä»¥ç»§ç»­æ¥å—å…¶ä»–è¯·æ±‚</p></blockquote><h1 id=åŒæ­¥ä¸å¼‚æ­¥>åŒæ­¥ä¸å¼‚æ­¥<a class=anchor href=#%e5%90%8c%e6%ad%a5%e4%b8%8e%e5%bc%82%e6%ad%a5>#</a></h1><p>åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶ (synchronous communication/ asynchronous communication)</p><p>æ‰€è°“åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ª<strong>è°ƒç”¨</strong>æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥<strong>è°ƒç”¨</strong>å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ç”±<strong>è°ƒç”¨è€…</strong>ä¸»åŠ¨ç­‰å¾…è¿™ä¸ª<strong>è°ƒç”¨</strong>çš„ç»“æœã€‚</p><p>è€Œå¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œ<strong>è°ƒç”¨</strong>åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ,è€Œæ˜¯åœ¨<strong>è°ƒç”¨</strong>å‘å‡ºåï¼Œ<strong>è¢«è°ƒç”¨è€…</strong>é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚(å…¸å‹çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹æ¯”å¦‚Node.js)</p><p><strong>åŒæ­¥é€šä¿¡æœºåˆ¶</strong></p><blockquote class=book-hint><p>ä½ æ‰“ç”µè¯é—®ä¹¦åº—è€æ¿æœ‰æ²¡æœ‰ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œå¦‚æœæ˜¯åŒæ­¥é€šä¿¡æœºåˆ¶ï¼Œä¹¦åº—è€æ¿ä¼šè¯´ï¼Œä½ ç¨ç­‰ï¼Œ&ldquo;æˆ‘æŸ¥ä¸€ä¸‹&rdquo;ï¼Œç„¶åå¼€å§‹æŸ¥å•ŠæŸ¥ï¼Œç­‰æŸ¥å¥½äº†ï¼ˆå¯èƒ½æ˜¯5ç§’ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å¤©ï¼‰å‘Šè¯‰ä½ ç»“æœï¼ˆè¿”å›ç»“æœï¼‰</p></blockquote><p><strong>å¼‚æ­¥é€šä¿¡æœºåˆ¶</strong></p><blockquote class=book-hint><p>ä¹¦åº—è€æ¿ç›´æ¥å‘Šè¯‰ä½ æˆ‘æŸ¥ä¸€ä¸‹å•Šï¼ŒæŸ¥å¥½äº†æ‰“ç”µè¯ç»™ä½ ï¼Œç„¶åç›´æ¥æŒ‚ç”µè¯äº†ï¼ˆä¸è¿”å›ç»“æœï¼‰ã€‚ç„¶åæŸ¥å¥½äº†ï¼Œä»–ä¼šä¸»åŠ¨æ‰“ç”µè¯ç»™ä½ ã€‚åœ¨è¿™é‡Œè€æ¿é€šè¿‡"å›ç”µ"è¿™ç§æ–¹å¼æ¥å›è°ƒ</p></blockquote><h1 id=é˜»å¡ä¸éé˜»å¡>é˜»å¡ä¸éé˜»å¡<a class=anchor href=#%e9%98%bb%e5%a1%9e%e4%b8%8e%e9%9d%9e%e9%98%bb%e5%a1%9e>#</a></h1><p>é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€ï¼Œé˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹</p><p>Example</p><blockquote class=book-hint><p>ä½ æ‰“ç”µè¯é—®ä¹¦åº—è€æ¿æœ‰æ²¡æœ‰ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿã€‹è¿™æœ¬ä¹¦ï¼Œå¦‚æœæ˜¯é˜»å¡å¼è°ƒç”¨ï¼Œä½ ä¼šä¸€ç›´æŠŠè‡ªå·±â€œæŒ‚èµ·â€ï¼Œç›´åˆ°å¾—åˆ°è¿™æœ¬ä¹¦æœ‰æ²¡æœ‰çš„ç»“æœï¼Œå¦‚æœæ˜¯éé˜»å¡å¼è°ƒç”¨ï¼Œä½ ä¸ç®¡è€æ¿æœ‰æ²¡æœ‰å‘Šè¯‰ä½ ï¼Œä½ è‡ªå·±å…ˆä¸€è¾¹å»ç©äº†ï¼Œ å½“ç„¶ä½ ä¹Ÿè¦å¶å°”è¿‡å‡ åˆ†é’Ÿcheckä¸€ä¸‹è€æ¿æœ‰æ²¡æœ‰è¿”å›ç»“æœï¼Œåœ¨è¿™é‡Œé˜»å¡ä¸éé˜»å¡ä¸æ˜¯å¦åŒæ­¥å¼‚æ­¥æ— å…³ã€‚è·Ÿè€æ¿é€šè¿‡ä»€ä¹ˆæ–¹å¼å›ç­”ä½ ç»“æœæ— å…³</p></blockquote><h1 id=æ¨¡å‹å›¾ä¾‹>æ¨¡å‹å›¾ä¾‹<a class=anchor href=#%e6%a8%a1%e5%9e%8b%e5%9b%be%e4%be%8b>#</a></h1><h2 id=å•çº¿ç¨‹åŒæ­¥æ¨¡å‹>å•çº¿ç¨‹åŒæ­¥æ¨¡å‹<a class=anchor href=#%e5%8d%95%e7%ba%bf%e7%a8%8b%e5%90%8c%e6%ad%a5%e6%a8%a1%e5%9e%8b>#</a></h2><p><img src=/images/2021-09-02-22-35-08.png alt></p><h2 id=å¤šçº¿ç¨‹æ¨¡å‹>å¤šçº¿ç¨‹æ¨¡å‹<a class=anchor href=#%e5%a4%9a%e7%ba%bf%e7%a8%8b%e6%a8%a1%e5%9e%8b>#</a></h2><p><img src=/images/2021-09-02-22-35-45.png alt></p><h2 id=å¼‚æ­¥æ¨¡å‹>å¼‚æ­¥æ¨¡å‹<a class=anchor href=#%e5%bc%82%e6%ad%a5%e6%a8%a1%e5%9e%8b>#</a></h2><p><img src=/images/2021-09-02-22-36-14.png alt></p><h1 id=åŸºç¡€>åŸºç¡€<a class=anchor href=#%e5%9f%ba%e7%a1%80>#</a></h1><h2 id=åˆ›å»ºä»»åŠ¡>åˆ›å»ºä»»åŠ¡<a class=anchor href=#%e5%88%9b%e5%bb%ba%e4%bb%bb%e5%8a%a1>#</a></h2><h3 id=new-taskfactory>new TaskFactory()<a class=anchor href=#new-taskfactory>#</a></h3><p>ä½¿ç”¨å®ä¾‹åŒ–çš„TaskFactoryç±»</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span> <span style=color:#66d9ef>var</span> t1 = <span style=color:#66d9ef>new</span> TaskFactory().StartNew(() =&gt; Console.WriteLine(<span style=color:#e6db74>&#34;new TaskFactory().StartNew&#34;</span>));</span></span></code></pre></div><h3 id=taskfactory>Task.Factory<a class=anchor href=#taskfactory>#</a></h3><p>ä½¿ç”¨Taské™æ€å±æ€§Factory</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>var</span> t2 = Task.Factory.StartNew(() =&gt; Console.WriteLine(<span style=color:#e6db74>&#34;Task.Factory&#34;</span>));</span></span></code></pre></div><h3 id=new-task>new Task()<a class=anchor href=#new-task>#</a></h3><p>ä½¿ç”¨<code>Task</code>çš„æ„é€ å‡½æ•°, å®ä¾‹åŒ–<code>Task</code>å¯¹è±¡æ—¶ï¼Œä»»åŠ¡ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æŒ‡å®š<code>Created</code>çŠ¶æ€ï¼Œé€šè¿‡<code>Task.Start()</code>æ–¹æ³•å¯åŠ¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>var</span> t3 = <span style=color:#66d9ef>new</span> Task(() =&gt; Console.WriteLine(<span style=color:#e6db74>&#34;Task Constructor&#34;</span>));
</span></span><span style=display:flex><span>	t3.Start();</span></span></code></pre></div><h3 id=taskrun>Task.Run<a class=anchor href=#taskrun>#</a></h3><p>.Net4.5 æ–°å¢åŠŸèƒ½ä½¿ç”¨<code>Task</code>ç±»çš„<code>Run</code>æ–¹æ³•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>var t4 <span style=color:#f92672>=</span> Task.Run<span style=color:#f92672>(()</span> <span style=color:#f92672>=</span>&gt; Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Task.Run&#34;</span><span style=color:#f92672>))</span>;</span></span></code></pre></div><p>æ³¨æ„ï¼šä½¿ç”¨<code>Task.Run/Task.Factory.StartNew/new TaskFactory().StartNew()</code>æ–¹æ³•è¿è¡Œçš„ä»»åŠ¡ä¼šç«‹å³å¼€å§‹å·¥ä½œï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨è¿™äº›ä»»åŠ¡çš„<code>Start</code>æ–¹æ³•</p><h2 id=åŒæ­¥ä»»åŠ¡>åŒæ­¥ä»»åŠ¡<a class=anchor href=#%e5%90%8c%e6%ad%a5%e4%bb%bb%e5%8a%a1>#</a></h2><p>ä»»åŠ¡ä¸ä¸€å®šè¦ä½¿ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çº¿ç¨‹ï¼Œä»»åŠ¡ä¹Ÿå¯ä»¥åŒæ­¥è¿›è¡Œï¼Œä»¥ç›¸åŒçš„çº¿ç¨‹ä½œä¸ºä¸»è°ƒçº¿ç¨‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main(<span style=color:#66d9ef>string</span>[] args)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> t1 = <span style=color:#66d9ef>new</span> Task(() =&gt; TaskMethod(<span style=color:#e6db74>&#34;t1&#34;</span>));
</span></span><span style=display:flex><span>            t1.Start();
</span></span><span style=display:flex><span>            Console.WriteLine(<span style=color:#e6db74>&#34;ä¸»çº¿ç¨‹è°ƒç”¨ç»“æŸ&#34;</span>);
</span></span><span style=display:flex><span>            Console.ReadKey();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> TaskMethod(<span style=color:#66d9ef>string</span> taskName)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            Console.WriteLine(<span style=color:#e6db74>&#34;Task {0} è¿è¡Œåœ¨çº¿ç¨‹idä¸º{1}çš„çº¿ç¨‹ä¸Šã€‚æ˜¯å¦æ˜¯çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Ÿ:{2}&#34;</span>,
</span></span><span style=display:flex><span>taskName, Thread.CurrentThread.ManagedThreadId, Thread.CurrentThread.IsThreadPoolThread);
</span></span><span style=display:flex><span>        }</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>var</span> t1 = <span style=color:#66d9ef>new</span> Task(() =&gt; TaskMethod(<span style=color:#e6db74>&#34;t1&#34;</span>));
</span></span><span style=display:flex><span>    t1.RunSynchronously();
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>&#34;ä¸»çº¿ç¨‹è°ƒç”¨ç»“æŸ&#34;</span>);
</span></span><span style=display:flex><span>    Console.ReadKey();</span></span></code></pre></div><h2 id=ä½¿ç”¨å•ç‹¬çº¿ç¨‹çš„ä»»åŠ¡>ä½¿ç”¨å•ç‹¬çº¿ç¨‹çš„ä»»åŠ¡<a class=anchor href=#%e4%bd%bf%e7%94%a8%e5%8d%95%e7%8b%ac%e7%ba%bf%e7%a8%8b%e7%9a%84%e4%bb%bb%e5%8a%a1>#</a></h2><p>å¦‚æœä»»åŠ¡çš„ä»£ç éœ€è¦é•¿æ—¶é—´è¿è¡Œï¼Œåº”è¯¥ä½¿ç”¨<code>TaskCreationOptions.LongRuning</code>å‘Šè¯‰ä»»åŠ¡è°ƒåº¦å™¨åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚æ­¤æ—¶çº¿ç¨‹å¯ä»¥ä¸å—çº¿ç¨‹æ± ç®¡ç†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span> <span style=color:#66d9ef>var</span> t1 = <span style=color:#66d9ef>new</span> Task(TaskMethod, TaskCreationOptions.LongRunning);
</span></span><span style=display:flex><span> t1.Start();</span></span></code></pre></div><h2 id=taskç”Ÿå‘½å‘¨æœŸ>Taskç”Ÿå‘½å‘¨æœŸ<a class=anchor href=#task%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f>#</a></h2><table><thead><tr><th style=text-align:left>çŠ¶æ€</th><th style=text-align:left>æè¿°</th></tr></thead><tbody><tr><td style=text-align:left>Created</td><td style=text-align:left>è¯¥ä»»åŠ¡å·²åˆå§‹åŒ–ï¼Œä½†å°šæœªè¢«è®¡åˆ’</td></tr><tr><td style=text-align:left>WaitingForActivation</td><td style=text-align:left>è¯¥ä»»åŠ¡æ­£åœ¨ç­‰å¾… .NET Framework åŸºç¡€ç»“æ„åœ¨å†…éƒ¨å°†å…¶æ¿€æ´»å¹¶è¿›è¡Œè®¡åˆ’</td></tr><tr><td style=text-align:left>WaitingToRun</td><td style=text-align:left>è¯¥ä»»åŠ¡å·²è¢«è®¡åˆ’æ‰§è¡Œï¼Œä½†å°šæœªå¼€å§‹æ‰§è¡Œ</td></tr><tr><td style=text-align:left>Running</td><td style=text-align:left>è¯¥ä»»åŠ¡æ­£åœ¨è¿è¡Œï¼Œä½†å°šæœªå®Œæˆ</td></tr><tr><td style=text-align:left>WaitingForChildrenToComplete</td><td style=text-align:left>è¯¥ä»»åŠ¡å·²å®Œæˆæ‰§è¡Œï¼Œæ­£åœ¨éšå¼ç­‰å¾…é™„åŠ çš„å­ä»»åŠ¡å®Œæˆ</td></tr><tr><td style=text-align:left>RanToCompletion</td><td style=text-align:left>å·²æˆåŠŸå®Œæˆæ‰§è¡Œçš„ä»»åŠ¡</td></tr><tr><td style=text-align:left>Canceled</td><td style=text-align:left>è¯¥ä»»åŠ¡å·²é€šè¿‡å¯¹å…¶è‡ªèº«çš„ CancellationToken å¼•å‘ OperationCanceledException å¯¹å–æ¶ˆè¿›è¡Œäº†ç¡®è®¤ï¼Œæ­¤æ—¶è¯¥æ ‡è®°å¤„äºå·²å‘é€ä¿¡å·çŠ¶æ€ï¼›æˆ–è€…åœ¨è¯¥ä»»åŠ¡å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œå·²å‘è¯¥ä»»åŠ¡çš„ CancellationToken å‘å‡ºäº†ä¿¡å·</td></tr><tr><td style=text-align:left>Faulted</td><td style=text-align:left>ç”±äºæœªå¤„ç†å¼‚å¸¸çš„åŸå› è€Œå®Œæˆçš„ä»»åŠ¡</td></tr></tbody></table><h2 id=taskä»»åŠ¡æ§åˆ¶>Taskä»»åŠ¡æ§åˆ¶<a class=anchor href=#task%e4%bb%bb%e5%8a%a1%e6%8e%a7%e5%88%b6>#</a></h2><table><thead><tr><th style=text-align:left>æ–¹æ³•</th><th style=text-align:left>æè¿°</th></tr></thead><tbody><tr><td style=text-align:left>Task.Wait</td><td style=text-align:left>task1.Wait();å°±æ˜¯ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œtask çš„çŠ¶æ€å˜ä¸º Completed</td></tr><tr><td style=text-align:left>Task.WaitAll</td><td style=text-align:left>å¾…æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆ</td></tr><tr><td style=text-align:left>Task.WaitAny</td><td style=text-align:left>ç­‰å¾…ä»»ä½•ä¸€ä¸ªä»»åŠ¡å®Œæˆå°±ç»§ç»­å‘ä¸‹æ‰§è¡Œ</td></tr><tr><td style=text-align:left>Task.ContinueWith</td><td style=text-align:left>ç¬¬ä¸€ä¸ª Task å®Œæˆåè‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ª Taskï¼Œå®ç° Task çš„å»¶ç»­ CancellationTokenSource</td></tr><tr><td style=text-align:left>CancellationTokenSource</td><td style=text-align:left>é€šè¿‡ cancellation çš„ tokens æ¥å–æ¶ˆä¸€ä¸ª Task</td></tr></tbody></table><h2 id=taskè¿”å›ç±»å‹>Taskè¿”å›ç±»å‹<a class=anchor href=#task%e8%bf%94%e5%9b%9e%e7%b1%bb%e5%9e%8b>#</a></h2><h3 id=void>void<a class=anchor href=#void>#</a></h3><p>ä¸å…³å¿ƒç»“æœï¼Œè¿”å› void ç±»å‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>TestMethod<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>public void Task_Result_Void<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;ä¸å…³å¿ƒç»“æœ,è¿”å›Void,--Start,çº¿ç¨‹Id:{Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    Print<span style=color:#f92672>()</span>;
</span></span><span style=display:flex><span>    Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;ä¸å…³å¿ƒç»“æœ,è¿”å›Void,--End,çº¿ç¨‹Id:{Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    Assert.IsTrue<span style=color:#f92672>(</span>true<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    static async void Print<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        await Task.Run<span style=color:#f92672>(()</span> <span style=color:#f92672>=</span>&gt;
</span></span><span style=display:flex><span>       <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>           Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;Hello, çº¿ç¨‹Id:{ Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>       <span style=color:#f92672>})</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><h3 id=task>Task<a class=anchor href=#task>#</a></h3><p>å…³å¿ƒæ˜¯å¦å®Œæˆï¼Œè¿”å› Task ç±»å‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>public void Task_Result_Task<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;çœ‹ç”µè§†ä¸­...,çº¿ç¨‹Id:{Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;çªç„¶åœç”µï¼Œçœ‹ä¸‹æ˜¯ä¸æ˜¯è·³é—¸äº†&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    var task <span style=color:#f92672>=</span> OpenMainsSwitch<span style=color:#f92672>()</span>;
</span></span><span style=display:flex><span>    Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;æ²¡ç”µäº†å…ˆç©ä¼šå„¿æ‰‹æœºå§ï¼Œçº¿ç¨‹Idä¸ºï¼š{Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    Thread.Sleep<span style=color:#f92672>(</span>100<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    // ç­‰ç€ç”µæºå¼€å…³è¢«æ‰“å¼€
</span></span><span style=display:flex><span>    task.Wait<span style=color:#f92672>()</span>;
</span></span><span style=display:flex><span>    Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;åˆæœ‰ç”µäº†,ç»§ç»­çœ‹ç”µè§†...,çº¿ç¨‹Id:{Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    Assert.IsTrue<span style=color:#f92672>(</span>true<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    static async Task OpenMainsSwitch<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;å‡†å¤‡æ‰“å¼€ç”µæºå¼€å…³ï¼Œçº¿ç¨‹Idï¼š{ Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>        await Task.Run<span style=color:#f92672>(()</span> <span style=color:#f92672>=</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;æ‰“å¼€ç”µæºå¼€å…³, çº¿ç¨‹Id:{ Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>            Thread.Sleep<span style=color:#f92672>(</span>2000<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>})</span>;
</span></span><span style=display:flex><span>        Console.WriteLine<span style=color:#f92672>(</span><span style=color:#e6db74>$&#34;ç”µæºå¼€å…³æ‰“å¼€äº†ï¼Œçº¿ç¨‹Idï¼š{ Thread.CurrentThread.ManagedThreadId}&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span></span></span></code></pre></div><h3 id=taskt><code>Task&lt;T></code><a class=anchor href=#taskt>#</a></h3><p>è°ƒç”¨æ–¹æ³•è¦ä»è°ƒç”¨ä¸­è·å–ä¸€ä¸ª<code>T</code>ç±»å‹çš„å€¼ï¼Œå¼‚æ­¥æ–¹æ³•çš„è¿”å›ç±»å‹å°±å¿…é¡»æ˜¯<code>Task&lt;T></code>ã€‚è°ƒç”¨æ–¹æ³•ä»<code>Task</code>çš„<code>Result</code>å±æ€§è·å–çš„å°±æ˜¯<code>T</code>ç±»å‹çš„å€¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Task_Result_TaskTAsync()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>string</span> message = <span style=color:#e6db74>$&#34;Today is {DateTime.Today:D}\n&#34;</span> + <span style=color:#e6db74>&#34;Today&#39;s hours of leisure: &#34;</span> + <span style=color:#e6db74>$&#34;{await GetLeisureHoursAsync()}&#34;</span>;
</span></span><span style=display:flex><span>    Console.WriteLine(message);
</span></span><span style=display:flex><span>    Assert.IsTrue(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task&lt;<span style=color:#66d9ef>int</span>&gt; GetLeisureHoursAsync()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        DayOfWeek today = <span style=color:#66d9ef>await</span> Task.FromResult(DateTime.Now.DayOfWeek);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> leisureHours =
</span></span><span style=display:flex><span>            today <span style=color:#66d9ef>is</span> DayOfWeek.Saturday || today <span style=color:#66d9ef>is</span> DayOfWeek.Sunday
</span></span><span style=display:flex><span>            ? <span style=color:#ae81ff>16</span> : <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> leisureHours;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=è¿ç»­ä»»åŠ¡>è¿ç»­ä»»åŠ¡<a class=anchor href=#%e8%bf%9e%e7%bb%ad%e4%bb%bb%e5%8a%a1>#</a></h2><p>åœ¨æŒ‡å®šä»»åŠ¡å®Œæˆåè°ƒç”¨å¦ä¸€ä¸ªæŒ‡å®šä»»åŠ¡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Task_ContinueWith_Example()
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span>     Task&lt;<span style=color:#66d9ef>string</span>&gt; t1 = <span style=color:#66d9ef>new</span> Task&lt;<span style=color:#66d9ef>string</span>&gt;(
</span></span><span style=display:flex><span>         () =&gt; TaskMethod1(<span style=color:#e6db74>&#34;t1&#34;</span>));
</span></span><span style=display:flex><span>     Console.WriteLine(<span style=color:#e6db74>&#34;Task1-åˆ›å»º,çŠ¶æ€ä¸º:{0}&#34;</span>, t1.Status);
</span></span><span style=display:flex><span>     t1.Start();
</span></span><span style=display:flex><span>     Console.WriteLine(<span style=color:#e6db74>&#34;Task1-å¯åŠ¨,çŠ¶æ€ä¸º:{0}&#34;</span>, t1.Status);
</span></span><span style=display:flex><span>     Console.WriteLine(t1.Result);
</span></span><span style=display:flex><span>     Console.WriteLine(<span style=color:#e6db74>&#34;Task1-å®Œæˆ,çŠ¶æ€ä¸º:{0}&#34;</span>, t1.Status);
</span></span><span style=display:flex><span>     Task t2 = t1.ContinueWith(TaskMethod2);
</span></span><span style=display:flex><span>     Console.WriteLine(<span style=color:#e6db74>&#34;Task2,çŠ¶æ€ä¸º:{0}&#34;</span>, t2.Status);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>string</span> TaskMethod1(<span style=color:#66d9ef>string</span> taskName)
</span></span><span style=display:flex><span>     {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>var</span> result = <span style=color:#66d9ef>string</span>.Format(<span style=color:#e6db74>$&#34;Task:{taskName} è¿è¡Œåœ¨çº¿ç¨‹id:{ Thread.CurrentThread.ManagedThreadId}çš„çº¿ç¨‹ä¸Š,&#34;</span> +
</span></span><span style=display:flex><span>             <span style=color:#e6db74>$&#34;æ˜¯å¦æ˜¯çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Ÿ:{Thread.CurrentThread.IsThreadPoolThread}&#34;</span>);
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> TaskMethod2(Task t)
</span></span><span style=display:flex><span>     {
</span></span><span style=display:flex><span>         Console.WriteLine(<span style=color:#e6db74>$&#34;TaskID:{ t.Id} è¿è¡Œåœ¨çº¿ç¨‹id:{Thread.CurrentThread.ManagedThreadId}çš„çº¿ç¨‹ä¸Šã€‚æ˜¯å¦æ˜¯çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Ÿ:{Thread.CurrentThread.IsThreadPoolThread}&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     Assert.IsTrue(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span> }</span></span></code></pre></div><p>ä½¿ç”¨<code>TaskContinuationOptions</code>æšä¸¾çš„å€¼å¯ä»¥æŒ‡å®šè¿ç»­ä»»åŠ¡åªæœ‰åœ¨èµ·å§‹ä»»åŠ¡æˆåŠŸæˆ–å¤±è´¥ç»“æŸæ—¶å¯åŠ¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>Task t2 = t1.ContinueWith(TaskMethod2, TaskContinuationOptions.NotOnCanceled);</span></span></code></pre></div><h2 id=åµŒå¥—task>åµŒå¥—Task<a class=anchor href=#%e5%b5%8c%e5%a5%97task>#</a></h2><h3 id=å…³è”åµŒå¥—>å…³è”åµŒå¥—<a class=anchor href=#%e5%85%b3%e8%81%94%e5%b5%8c%e5%a5%97>#</a></h3><p>åœ¨åˆ›å»º<code>cTask</code>æ—¶ï¼ŒåŠ å…¥äº†å‚æ•°<code>TaskCreationOptions.AttachedToParent</code>ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œ<code>cTask</code>å’Œ<code>pTask</code>å°±ä¼šå»ºç«‹å…³è”ï¼Œ<code>cTask</code>å°±ä¼šæˆä¸º<code>pTask</code>çš„ä¸€éƒ¨åˆ†</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#a6e22e>[TestMethod]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Task_Relevance_Example()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> pTask = Task.Factory.StartNew(() =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>var</span> cTask= Task.Factory.StartNew(() =&gt;
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>             Console.WriteLine(<span style=color:#e6db74>&#34;Childen task finished!&#34;</span>);
</span></span><span style=display:flex><span>         }, TaskCreationOptions.AttachedToParent);
</span></span><span style=display:flex><span>        Console.WriteLine(<span style=color:#e6db74>&#34;Parent task finished!&#34;</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    pTask.Wait();
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>&#34;Flag&#34;</span>);
</span></span><span style=display:flex><span>    Assert.IsTrue(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=éå…³è”åµŒå¥—>éå…³è”åµŒå¥—<a class=anchor href=#%e9%9d%9e%e5%85%b3%e8%81%94%e5%b5%8c%e5%a5%97>#</a></h3><p>å¤–å±‚çš„<code>pTask</code>è¿è¡Œå®Œåï¼Œå¹¶ä¸ä¼šç­‰å¾…å†…å±‚çš„<code>cTask</code>ï¼Œç›´æ¥å‘ä¸‹èµ°å…ˆè¾“å‡ºäº†<code>Flag</code>ã€‚è¿™ç§åµŒå¥—æœ‰æ—¶å€™ç›¸å½“äºåˆ›å»ºä¸¤ä¸ªTaskï¼Œä½†æ˜¯åµŒå¥—åœ¨ä¸€èµ·çš„è¯ï¼Œåœ¨Taskæ¯”è¾ƒå¤šæ—¶ä¼šæ–¹ä¾¿æŸ¥æ‰¾å’Œç®¡ç†ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åœ¨ä¸€ä¸ªTaskä¸­é€”åŠ å…¥å¤šä¸ªTaskï¼Œè®©è¿›åº¦å¹¶è¡Œå‰è¿›</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#a6e22e>[TestMethod]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Task_NoRelevance_Example()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> pTask = Task.Factory.StartNew(() =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Task.Factory.StartNew(() =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            Console.WriteLine(<span style=color:#e6db74>&#34;Childen task finished!&#34;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>        Console.WriteLine(<span style=color:#e6db74>&#34;Parent task finished!&#34;</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    pTask.Wait();
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>&#34;Flag&#34;</span>);
</span></span><span style=display:flex><span>    Assert.IsTrue(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>åœ¨<code>Task</code>å†…éƒ¨åˆ›å»º<code>Task</code>ï¼Œå¦‚æœçˆ¶ä»»åŠ¡åœ¨å­ä»»åŠ¡ä¹‹å‰ç»“æŸï¼Œçˆ¶ä»»åŠ¡çŠ¶æ€å°±æ˜¾ç¤ºä¸º<code>WaitingForChilderenToComplete</code>ã€‚æ‰€æœ‰çš„å­ä»»åŠ¡ä¹Ÿç»“æŸæ—¶ï¼Œçˆ¶ä»»åŠ¡çš„çŠ¶æ€å°±æ”¹ä¸º<code>RanToCompletion</code>ï¼Œå¦‚æœä½¿ç”¨<code>TaskContinuationOptions</code>æšä¸¾å€¼åˆ›å»ºå­ä»»åŠ¡æ—¶ä¼šæœ‰ä¸åŒç»“æœï¼Œå–æ¶ˆçˆ¶ä»»åŠ¡ä¹Ÿä¼šå–æ¶ˆå­ä»»åŠ¡</p><h2 id=taskå–æ¶ˆ>Taskå–æ¶ˆ<a class=anchor href=#task%e5%8f%96%e6%b6%88>#</a></h2><h3 id=å•ä¸ªä»»åŠ¡>å•ä¸ªä»»åŠ¡<a class=anchor href=#%e5%8d%95%e4%b8%aa%e4%bb%bb%e5%8a%a1>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#a6e22e>[TestMethod]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Task_CancellationToken_SingleTask_Example()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    CancellationTokenSource cts = <span style=color:#66d9ef>new</span> CancellationTokenSource();
</span></span><span style=display:flex><span>    Task t1 = Task.Run(() =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; <span style=color:#ae81ff>30</span>; i++)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (cts.Token.IsCancellationRequested)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                cts.Token.ThrowIfCancellationRequested();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                Thread.Sleep(<span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>                Console.WriteLine(<span style=color:#e6db74>&#34;ä»»åŠ¡t1,å…±æ‰§è¡Œ30æ¬¡,å½“å‰ç¬¬{0}æ¬¡&#34;</span>, i + <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, cts.Token);
</span></span><span style=display:flex><span>    Thread.Sleep(<span style=color:#ae81ff>2000</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¼ è¾¾å–æ¶ˆè¯·æ±‚</span>
</span></span><span style=display:flex><span>    cts.Cancel();
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>$&#34;å·²åœæ­¢,Status{t1.Status}&#34;</span>);
</span></span><span style=display:flex><span>    Assert.IsTrue(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=å¤šä¸ªä»»åŠ¡>å¤šä¸ªä»»åŠ¡<a class=anchor href=#%e5%a4%9a%e4%b8%aa%e4%bb%bb%e5%8a%a1>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#a6e22e>[TestMethod]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Task_CancellationToken_MultiTask_Example()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    CancellationTokenSource cts1 = <span style=color:#66d9ef>new</span> CancellationTokenSource();
</span></span><span style=display:flex><span>    CancellationTokenSource cts2 = <span style=color:#66d9ef>new</span> CancellationTokenSource();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä»»ä½•Taskå¤„äºå–æ¶ˆçŠ¶æ€æ—¶å…¶ä½™ä¹Ÿå°†å–æ¶ˆ</span>
</span></span><span style=display:flex><span>    CancellationTokenSource ctsCombine =
</span></span><span style=display:flex><span>         CancellationTokenSource.CreateLinkedTokenSource(cts1.Token, cts2.Token);
</span></span><span style=display:flex><span>    Task t1 = Task.Run(() =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; <span style=color:#ae81ff>30</span>; i++)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (!ctsCombine.IsCancellationRequested)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                Thread.Sleep(<span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>                Console.WriteLine(<span style=color:#e6db74>&#34;ä»»åŠ¡t1,å…±æ‰§è¡Œ30æ¬¡,å½“å‰ç¬¬{0}æ¬¡&#34;</span>, i + <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, ctsCombine.Token);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Task t2 = Task.Run(() =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; <span style=color:#ae81ff>30</span>; i++)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (!ctsCombine.IsCancellationRequested)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                Thread.Sleep(<span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>                Console.WriteLine(<span style=color:#e6db74>&#34;ä»»åŠ¡t2,å…±æ‰§è¡Œ30æ¬¡,å½“å‰ç¬¬{0}æ¬¡&#34;</span>, i + <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, ctsCombine.Token);
</span></span><span style=display:flex><span>    Thread.Sleep(<span style=color:#ae81ff>2000</span>);
</span></span><span style=display:flex><span>    cts1.Cancel();
</span></span><span style=display:flex><span>    Console.WriteLine(<span style=color:#e6db74>$&#34;t1:Status_{t1.Status},t2:Status_{t2.Status}&#34;</span>);
</span></span><span style=display:flex><span>    Assert.IsTrue(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=å®šæ—¶å–æ¶ˆ>å®šæ—¶å–æ¶ˆ<a class=anchor href=#%e5%ae%9a%e6%97%b6%e5%8f%96%e6%b6%88>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main(<span style=color:#66d9ef>string</span>[] args)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    CancellationTokenSource cts = <span style=color:#66d9ef>new</span> CancellationTokenSource();
</span></span><span style=display:flex><span>    cts.CancelAfter(<span style=color:#ae81ff>8000</span>);
</span></span><span style=display:flex><span>    Task t1 = Task.Run(() =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; <span style=color:#ae81ff>30</span>; i++)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (cts.Token.IsCancellationRequested)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                cts.Token.ThrowIfCancellationRequested();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                Thread.Sleep(<span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>                Console.WriteLine(<span style=color:#e6db74>&#34;ä»»åŠ¡t1,å…±æ‰§è¡Œ30æ¬¡,å½“å‰ç¬¬{0}æ¬¡&#34;</span>, i);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, cts.Token);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        t1.Wait();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>catch</span> (AggregateException e)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> item <span style=color:#66d9ef>in</span> e.InnerExceptions)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            Console.WriteLine(item);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    Console.ReadKey();
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>å·¥ä½œåŸç†</strong>
ç¨‹åºè¿è¡Œä¸»çº¿ç¨‹åˆ›å»º->åˆ›å»º<code>CancellationTokenSource</code>å¯¹è±¡->è®¾ç½®<code>task</code>åœ¨æŒ‡å®šæ¯«ç§’æ•°åå–æ¶ˆ(è¿™é‡Œæ˜¯ 8000)->åˆ›å»º<code>task</code>å¹¶ä¼ å…¥<code>CancellationTokenSource</code>å¯¹è±¡ç”Ÿæˆçš„<code>token</code>ï¼Œå¾ªç¯æ‰“å° 1~30ï¼Œå–æ¶ˆæ ‡è®°ä¸º<code>true</code>åˆ™æŠ›å‡ºå¼‚å¸¸ä¸­æ­¢ä»»åŠ¡ï¼Œ<code>false</code>åˆ™æ­£å¸¸è¾“å‡ºã€‚åœ¨è¾“å‡ºå‰ç­‰å¾… 500 æ¯«ç§’(é¿å… 8000 æ¯«ç§’è¿˜æ²¡åˆ°ä»»åŠ¡å°±å·²ç»æ‰§è¡Œå®Œæˆ)->ä½¿ç”¨<code>try/catch</code>åŒ…è£¹<code>t1.Wait()</code>ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆè¯­å¥ï¼Œå¹¶æ•è·å¤„ç†å¼‚å¸¸ã€‚è¿™é‡Œä»»åŠ¡åœ¨æ‰§è¡Œå®Œ 15 æ¬¡çš„æ—¶å€™è¢«å–æ¶ˆ</p><h2 id=å–æ¶ˆæ—¶å›è°ƒ>å–æ¶ˆæ—¶å›è°ƒ<a class=anchor href=#%e5%8f%96%e6%b6%88%e6%97%b6%e5%9b%9e%e8%b0%83>#</a></h2><p><code>CancellationTokenSource.Token.Register()</code>ï¼Œä½¿ç”¨<code>Register</code>ï¼Œå‘å–æ¶ˆæ ‡è®°ç™»è®°ä¸€ä¸ªå›è°ƒæ–¹æ³•ã€‚åº”ç”¨ç¨‹åºè°ƒç”¨<code>CancellationTokenSource</code> å¯¹è±¡çš„ <code>Cancel</code> æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªå›è°ƒå°±ä¼šè¿è¡Œã€‚ä½†æ˜¯ä¸èƒ½ä¿è¯è¿™ä¸ªæ–¹æ³•åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ,å¯èƒ½åœ¨ä»»åŠ¡æ‰§è¡Œå®Œè‡ªå·±çš„å–æ¶ˆå¤„ç†ä¹‹å‰æˆ–ä¹‹å,ä¹Ÿå¯èƒ½åœ¨é‚£ä¸ªè¿‡ç¨‹ä¹‹ä¸­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#a6e22e> [TestMethod]</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Task_CancellationToken_Register_Example()
</span></span><span style=display:flex><span> {
</span></span><span style=display:flex><span>     CancellationTokenSource cts = <span style=color:#66d9ef>new</span> CancellationTokenSource();
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>var</span> token = cts.Token;
</span></span><span style=display:flex><span>     cts.CancelAfter(<span style=color:#ae81ff>8000</span>);
</span></span><span style=display:flex><span>     token.Register(Callback);
</span></span><span style=display:flex><span>     Task t1 = Task.Run(() =&gt;
</span></span><span style=display:flex><span>     {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i = <span style=color:#ae81ff>0</span>; i &lt; <span style=color:#ae81ff>30</span>; i++)
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>if</span> (token.IsCancellationRequested)
</span></span><span style=display:flex><span>             {
</span></span><span style=display:flex><span>                 token.ThrowIfCancellationRequested();
</span></span><span style=display:flex><span>             }
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>             {
</span></span><span style=display:flex><span>                 Thread.Sleep(<span style=color:#ae81ff>500</span>);
</span></span><span style=display:flex><span>                 Console.WriteLine(<span style=color:#e6db74>&#34;ä»»åŠ¡t1,å…±æ‰§è¡Œ30æ¬¡,å½“å‰ç¬¬{0}æ¬¡&#34;</span>, i);
</span></span><span style=display:flex><span>             }
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>     }, token);
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>     {
</span></span><span style=display:flex><span>         t1.Wait();
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>catch</span> (AggregateException e)
</span></span><span style=display:flex><span>     {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> item <span style=color:#66d9ef>in</span> e.InnerExceptions)
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>             Console.WriteLine(item);
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Callback()
</span></span><span style=display:flex><span>     {
</span></span><span style=display:flex><span>         Console.WriteLine(<span style=color:#e6db74>&#34;Registerç™»è®°çš„ä»»åŠ¡å–æ¶ˆå›è°ƒå‡½æ•°&#34;</span>);
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     Assert.IsTrue(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span> }</span></span></code></pre></div><h1 id=é—®é¢˜è®°å½•>é—®é¢˜è®°å½•<a class=anchor href=#%e9%97%ae%e9%a2%98%e8%ae%b0%e5%bd%95>#</a></h1><h2 id=asyncawaitå¹¶ä¸èƒ½æå‡æ€§èƒ½>async/awaitå¹¶ä¸èƒ½æå‡æ€§èƒ½?<a class=anchor href=#asyncawait%e5%b9%b6%e4%b8%8d%e8%83%bd%e6%8f%90%e5%8d%87%e6%80%a7%e8%83%bd>#</a></h2><p>é—®é¢˜æè¿°ï¼šæ‰€è°“çš„å¼‚æ­¥æ“ä½œå°±æ˜¯Açº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œæ‰§è¡Œåˆ°ä¸€åŠå†æŠŠä»»åŠ¡äº¤ç»™Bçº¿ç¨‹ï¼Œç„¶åAçº¿ç¨‹å¼€å§‹ç­‰å¾…Bçš„æ‰§è¡Œå®Œæˆäº†ï¼Œè¿™ä¸è¿˜æ˜¯åŒæ­¥çš„å—?</p><blockquote class=book-hint><p>å¼‚æ­¥ç¼–ç¨‹ä¸èƒ½æé«˜æ€§èƒ½ã€‚å¼‚æ­¥ç¼–ç¨‹åªæ˜¯æä¾›ä¸€ç§ç®€å•çš„ç¼–ç¨‹æ¨¡å‹æ¥æé«˜ç³»ç»Ÿçš„å“åº”èƒ½åŠ›ï¼Œæ¯”å¦‚ï¼Œå¦‚æœåœ¨UIçº¿ç¨‹ä¸Šæ‰§è¡Œé•¿æ—¶é—´IOæ“ä½œï¼Œåœ¨æ“ä½œå®Œæˆä¹‹å‰ç•Œé¢å°±å¤„åœ¨æ— æ³•æ“ä½œçš„çŠ¶æ€ã€‚
å¯ä»¥æé«˜æ€§èƒ½çš„æ˜¯å¹¶è¡ŒæŠ€æœ¯ï¼Œæ¯”å¦‚ä»»åŠ¡å¹¶è¡Œåº“ï¼ˆTPLï¼ŒTask Parallel Libraryï¼‰ã€å¹¶è¡ŒLINQï¼ˆPLINQï¼‰ç­‰ï¼Œè¿™äº›æŠ€æœ¯å¯ä»¥å……åˆ†åˆ©ç”¨CPUæ¥æé«˜è®¡ç®—æ€§èƒ½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè€—æ—¶çš„IOæ“ä½œä½¿ç”¨å¼‚æ­¥ç®€åŒ–ä»£ç ï¼Œè€—æ—¶çš„è®¡ç®—æ“ä½œä½¿ç”¨å¹¶è¡Œæ¥æé«˜æ€§èƒ½</p></blockquote><blockquote class=book-hint><p>æ¯”å¦‚æœåŠ¡ç«¯æœ€å¤§å¤„ç†è¯·æ±‚æ˜¯100ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆåŒæ­¥æ¨¡å¼ä¸‹ï¼Œ150ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œå°±æœ‰50ä¸ªè¯·æ±‚éœ€è¦ç­‰å¾…æ‰§è¡Œã€‚async/await æ¨¡å¼ä¸‹ï¼Œæ­£åœ¨æ‰§è¡Œçš„100ä¸ªçº¿ç¨‹ å¯ä»¥ç©ºé—²å‡ºæ¥ å¤„ç†åæ¥çš„50ä¸ªè¯·æ±‚ï¼Œå‰é¢100ä¸ªè¯·æ±‚å¼‚æ­¥å®Œæˆåï¼Œå†é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°å½“å‰çš„100ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å®Œåç»­çš„æµç¨‹ã€‚å·¥ä½œçº¿ç¨‹æ˜¯åœ¨ä¸åœçš„åˆ‡æ¢è¿‡ç¨‹ä¸­æå‡äº†å¹¶å‘æ•ˆç‡ã€‚è€Œåœ¨å•ä¸ªè¯·æ±‚ä¸­ï¼Œasync/awaitæ˜¯æœ‰çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥åœ¨å¤„ç†ä¸€ä¸ªæœ¬æ¥å°±å¾ˆå¿«é€Ÿçš„é€»è¾‘,ä¾‹å¦‚è¯»ä¸€ä¸ªRedisç¼“å­˜ï¼Œé‚£ä¹ˆæ€§èƒ½ä¼šæœ‰æ¯”è¾ƒæ˜¾è‘—çš„ä¸‹é™</p></blockquote><p>æ€»ç»“ï¼šå¼‚æ­¥ç¼–ç¨‹åªæ˜¯æé«˜äº†çº¿ç¨‹çš„åˆ©ç”¨ç‡ï¼Œé’ˆå¯¹ä¸€ä¸ªæœ¬æ¥å°±å¾ˆâ€œå¿«â€çš„æ“ä½œï¼Œå¯èƒ½å¼‚æ­¥è¿˜ä¸å¦‚åŒæ­¥ã€‚å› ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ä¹Ÿä¼šå¸¦æ¥æ€§èƒ½æŸè€—</p><h2 id=asyncawaitæ­»é”é—®é¢˜>async/awaitæ­»é”é—®é¢˜<a class=anchor href=#asyncawait%e6%ad%bb%e9%94%81%e9%97%ae%e9%a2%98>#</a></h2><h3 id=å¯èƒ½å‘ç”Ÿæ­»é”çš„ç¨‹åºç±»å‹>å¯èƒ½å‘ç”Ÿæ­»é”çš„ç¨‹åºç±»å‹<a class=anchor href=#%e5%8f%af%e8%83%bd%e5%8f%91%e7%94%9f%e6%ad%bb%e9%94%81%e7%9a%84%e7%a8%8b%e5%ba%8f%e7%b1%bb%e5%9e%8b>#</a></h3><ul><li><code>WPF/WinForm</code>ç¨‹åº</li><li>asp.net(ä¸åŒ…æ‹¬asp.net core)ç¨‹åº</li></ul><h3 id=ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿæ­»é”>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿæ­»é”?<a class=anchor href=#%e4%bb%80%e4%b9%88%e6%83%85%e5%86%b5%e4%b8%8b%e4%bc%9a%e4%ba%a7%e7%94%9f%e6%ad%bb%e9%94%81>#</a></h3><p>è°ƒç”¨ <code>Task.Wait()</code> æˆ–è€… <code>Task.Result</code> ç«‹åˆ»äº§ç”Ÿæ­»é”çš„å……åˆ†æ¡ä»¶</p><ul><li>è°ƒç”¨ <code>Wait()</code>æˆ–<code>Result</code>çš„ä»£ç ä½äº<code>UI</code>çº¿ç¨‹</li><li><code>Task</code>çš„å®é™…æ‰§è¡Œåœ¨å…¶ä»–çº¿ç¨‹ï¼Œä¸”éœ€è¦è¿”å›<code>UI</code>çº¿ç¨‹</li></ul><h3 id=æ­»é”çš„åŸå› >æ­»é”çš„åŸå› ?<a class=anchor href=#%e6%ad%bb%e9%94%81%e7%9a%84%e5%8e%9f%e5%9b%a0>#</a></h3><blockquote class=book-hint><p><code>UWP</code>ã€<code>WPF</code>ã€<code>Windows Forms</code>ç¨‹åºçš„ UI çº¿ç¨‹éƒ½æ˜¯å•çº¿ç¨‹çš„ã€‚ä¸ºäº†è®©ä½¿ç”¨äº†<code>async/await</code>çš„ä»£ç åƒä½¿ç”¨åŒæ­¥ä»£ç ä¸€æ ·ç®€å•ï¼ŒWPF ç¨‹åºçš„<code>Application</code>ç±»åœ¨æ„é€ çš„æ—¶å€™ä¼šå°†<code>ä¸»UIçº¿ç¨‹</code> Taskçš„åŒæ­¥ä¸Šä¸‹æ–‡è®¾ç½®ä¸º<code>DispatcherSynchronizationContext</code>çš„å®ä¾‹ï¼Œå½“<code>Task</code>çš„ä»»åŠ¡ç»“æŸæ—¶ï¼Œä¼šä»<code>AsyncMethodStateMachine</code>ä¸­è°ƒç”¨<code>Awaiter</code>çš„<code>OnComplete()</code>æ–¹æ³•ï¼Œè€Œ<code>await</code>åç»­æ–¹æ³•çš„æ‰§è¡Œé çš„å°±æ˜¯<code>OnComplete()</code>æ–¹æ³•ä¸­ä¸€å±‚å±‚è°ƒç”¨åˆ° <code>DispatcherSynchronizationContext</code>é‡Œçš„<code>Post</code>æ–¹æ³•</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#75715e>/// &lt;summary&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/// Asynchronously invoke the callback in the SynchronizationContext.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/// &lt;/summary&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> Post(SendOrPostCallback d, Object state)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Call BeginInvoke with the cached priority.  Note that BeginInvoke</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// preserves the behavior of passing exceptions to</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Dispatcher.UnhandledException unlike InvokeAsync.  This is</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// desireable because there is no way to await the call to Post, so</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// exceptions are hard to observe.</span>
</span></span><span style=display:flex><span>    _dispatcher.BeginInvoke(_priority, d, state);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>è¿™é‡Œå°±æ˜¯é—®é¢˜çš„å…³é”®ï¼ï¼ï¼</p><p>å¦‚æœ<code>_dispatcher.BeginInvoke(_priority, d, state);</code>è¿™å¥ä»£ç åœ¨åå°çº¿ç¨‹ã€‚é‚£ä¹ˆæ­¤æ—¶<code>UIçº¿ç¨‹</code>å¤„äº<code>Wait()/Result</code>è°ƒç”¨ä¸­çš„é˜»å¡çŠ¶æ€ï¼Œ<code>BeginInvoke</code>ä¸­çš„ä»»åŠ¡æ˜¯æ— è®ºå¦‚ä½•ä¹Ÿæ— æ³•æ‰§è¡Œåˆ°çš„ï¼Œäºæ˜¯æ— è®ºå¦‚ä½•éƒ½æ— æ³•å®Œæˆè¿™ä¸ª<code>Post</code>ä»»åŠ¡ï¼Œå³æ— è®ºå¦‚ä½•ä¹Ÿæ— æ³•é€€å‡ºæ­¤å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œäºæ˜¯<code>Wait()</code>ä¾¿æ— æ³•å®Œæˆç­‰å¾…ï¼Œäº§ç”Ÿæ­»é”</p><p>Example</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span>DoAsync().Wait();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> Task DoAsync()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> Task.Run(() =&gt; { });
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>æ— è®ºæ˜¯<code>WPF</code>è¿˜æ˜¯<code>UWP</code>ï¼Œåªè¦åœ¨<code>UI</code>çº¿ç¨‹ä¸Šè°ƒç”¨ä¸Šè¿°ä»£ç ï¼Œå¿…ç„¶æ­»é”</p><h3 id=there-is-no-thread>There Is No Thread<a class=anchor href=#there-is-no-thread>#</a></h3><p>è¯»å†™æ–‡ä»¶ï¼Œè®¿é—®ç½‘ç»œï¼Œè¿™äº› IO é˜»å¡çš„æ“ä½œæ‰§è¡Œæ—¶ï¼Œé‡Œé¢æ ¹æœ¬å°±æ²¡æœ‰çº¿ç¨‹ã€‚è¯¦æƒ…è¯·é˜…è¯»ï¼š<a href=https://blog.stephencleary.com/2013/11/there-is-no-thread.html>There Is No Thread</a></p><p>è¿˜æœ‰å¦ä¸€äº›æ“ä½œï¼Œä¹Ÿæ²¡æœ‰åå°çº¿ç¨‹çš„å‚ä¸ï¼Œäºæ˜¯ä¹Ÿä¸å­˜åœ¨ä»åå°çº¿ç¨‹å›åˆ°ä¸»çº¿ç¨‹å¯¼è‡´æ­»é”çš„æƒ…å†µã€‚å¦‚<code>Task.Yield</code>ï¼Œè¿˜æœ‰<code>InvokeAsync</code>ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šé€ æˆæ­»é”ã€‚å¦‚æœæ˜¯æ§åˆ¶å°ç¨‹åºï¼Œæˆ–è€…ä¸€ä¸ªæ™®é€šçš„éUIçº¿ç¨‹ï¼Œå…¶<code>SynchronizationContext</code>ä¸º<code>null</code>ï¼Œé‚£ä¹ˆå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œåä¸éœ€è¦å›åˆ°åŸæœ‰çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šé€ æˆæ­»é”</p><h3 id=ä¸ä¼šé€ æˆæ­»é”çš„å……åˆ†æ¡ä»¶>ä¸ä¼šé€ æˆæ­»é”çš„å……åˆ†æ¡ä»¶<a class=anchor href=#%e4%b8%8d%e4%bc%9a%e9%80%a0%e6%88%90%e6%ad%bb%e9%94%81%e7%9a%84%e5%85%85%e5%88%86%e6%9d%a1%e4%bb%b6>#</a></h3><ul><li>å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåä¸éœ€è¦å›åˆ°åŸæœ‰çº¿ç¨‹ï¼ˆä¾‹å¦‚é UI çº¿ç¨‹å’Œæ§åˆ¶å°çº¿ç¨‹ï¼‰</li><li>å¼‚æ­¥æ“ä½œä¸éœ€è¦å•ç‹¬çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li></ul><h2 id=å¦‚ä½•é¿å…æ­»é”>å¦‚ä½•é¿å…æ­»é”<a class=anchor href=#%e5%a6%82%e4%bd%95%e9%81%bf%e5%85%8d%e6%ad%bb%e9%94%81>#</a></h2><ul><li>åœ¨ UI çº¿ç¨‹ï¼Œå¦‚æœä½¿ç”¨äº†<code>async/await</code>ï¼Œå°±å°½é‡ä¸è¦å†ä½¿ç”¨<code>Task.Wait()/Task.Result</code>äº†ï¼Œå°±ä¸€ç›´å¼‚æ­¥ä¸€æ¡è·¯èµ°åˆ°é»‘å¥½äº†ï¼ˆå¾®è½¯ç§°å…¶ä¸º<code>Async All the Way</code>ï¼‰</li><li>å¦‚æœå¯èƒ½ï¼Œå°½é‡åœ¨å¼‚æ­¥ä»»åŠ¡åæ·»åŠ <code>.ConfigureAwait(false);</code>è¿™æ ·ï¼Œå¼‚æ­¥ä»»åŠ¡åé¢ç»§ç»­æ‰§è¡Œçš„ä»£ç å°±ä¸ä¼šå›åˆ°åŸ<code>UI</code>çº¿ç¨‹äº†ï¼Œè€Œæ˜¯ç›´æ¥ä»çº¿ç¨‹æ± ä¸­å†å–å‡ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼›è¿™æ ·ï¼Œå³ä¾¿<code>UI</code>çº¿ç¨‹åç»­å¯èƒ½æœ‰åˆ«çš„åŸå› é€ æˆé˜»å¡ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿæ­»é”äº†ï¼›æŠŠåŸæ¥çš„ä»£ç æ”¹æˆè¿™æ ·ï¼Œå°±ä¸ä¼šæ­»é”äº†</li></ul><p>åªèƒ½æ˜¯ä¸€è·¯ <code>async/await</code>ã€‚å¾®è½¯å°†å…¶æè¿°ä¸ºï¼š<code>async/await ä¼šåƒç—…æ¯’ä¸€æ ·åœ¨ä½ çš„ä»£ç ä¸­ä¼ æ’­</code>ã€‚</p><blockquote class=book-hint><p>Others have also noticed the spreading behavior of asynchronous programming and have called it â€œcontagiousâ€ or compared it to a zombie virus.</p></blockquote><p>è¿™å¥è¯çš„åŸæ–‡å‚è§ï¼š<a href=https://docs.microsoft.com/en-us/archive/msdn-magazine/2013/march/async-await-best-practices-in-asynchronous-programming>Async/Await - Best Practices in Asynchronous Programming</a></p><p>å¦‚æœä½ æ˜¯ç±»åº“æä¾›è€…ï¼Œå› ä¸ºä¸ç¡®å®šè°ƒç”¨è€…ç¨‹åºæ˜¯<code>WPF</code>/<code>Winform</code>..ï¼Œä¸ºäº†é˜²æ­¢ä»£ç è°ƒç”¨è€…åœ¨åŒæ­¥æ–¹æ³•ä¸­ä½¿ç”¨<code>Wait()/Result</code>è°ƒç”¨å¼‚æ­¥æ–¹æ³•ï¼Œè¿˜éœ€è¦è€ƒè™‘æ·»åŠ <code>.ConfigureAwait(false);</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>async</span> Task DoAsync()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> Task.Run(() =&gt; { }).ConfigureAwait(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>è¿™ä¸€å¥çš„ç›®çš„æ˜¯é˜²æ­¢æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢å› UI çº¿ç¨‹ã€‚</p><p>è¿™æ ·ï¼Œå³ä¾¿çœŸçš„ä½¿ç”¨ DoAsync().Wait() ä¹Ÿä¸ä¼šå‘ç”Ÿæ­»é”ã€‚æ³¨æ„ï¼Œæ•´ä¸ªæ–¹æ³•è°ƒç”¨é“¾éƒ½éœ€è¦ä½¿ç”¨ <code>.ConfigureAwait(false)</code> æ‰èƒ½å¤Ÿé˜²æ­¢çº¿ç¨‹åˆ‡æ¢ï¼Œåœ¨è°ƒç”¨æ–¹çš„ Wait() æ–¹æ³•ä¸­å‘ç”Ÿæ­»é”ã€‚</p><h2 id=æ›´å¤šæ­»é”ç›¸å…³>æ›´å¤šæ­»é”ç›¸å…³<a class=anchor href=#%e6%9b%b4%e5%a4%9a%e6%ad%bb%e9%94%81%e7%9b%b8%e5%85%b3>#</a></h2><ul><li><a href=https://blog.walterlv.com/post/deadlock-in-task-wait.html>https://blog.walterlv.com/post/deadlock-in-task-wait.html</a></li><li><a href=https://blog.walterlv.com/post/deadlock-of-invoke-in-lazy.html>https://blog.walterlv.com/post/deadlock-of-invoke-in-lazy.html</a></li><li><a href=https://blog.walterlv.com/post/deadlock-if-await-in-ui-lock-context.html>https://blog.walterlv.com/post/deadlock-if-await-in-ui-lock-context.html</a></li><li><a href=https://blog.walterlv.com/post/task-wait-may-cause-long-time-waiting.html>https://blog.walterlv.com/post/task-wait-may-cause-long-time-waiting.html</a></li></ul><p><strong>è§£å†³æ–¹æ³•</strong></p><ul><li><a href=https://blog.walterlv.com/post/using-configure-await-to-avoid-deadlocks.html>https://blog.walterlv.com/post/using-configure-await-to-avoid-deadlocks.html</a></li><li><a href=https://blog.walterlv.com/post/convert-async-to-sync-by-push-frame.html>https://blog.walterlv.com/post/convert-async-to-sync-by-push-frame.html</a></li></ul><p><strong>å‚è€ƒ</strong></p><ul><li><a href=https://blog.csdn.net/WPwalter/article/details/78370706>https://blog.csdn.net/WPwalter/article/details/78370706</a></li><li><a href=https://docs.microsoft.com/en-us/archive/msdn-magazine/2013/march/async-await-best-practices-in-asynchronous-programming>https://docs.microsoft.com/en-us/archive/msdn-magazine/2013/march/async-await-best-practices-in-asynchronous-programming</a></li><li><a href=https://www.cnblogs.com/qingfenglin/p/12058267.html>https://www.cnblogs.com/qingfenglin/p/12058267.html</a></li><li><a href=https://www.cnblogs.com/liqingwen/p/5844095.html>https://www.cnblogs.com/liqingwen/p/5844095.html</a></li><li><a href=https://www.cnblogs.com/zhaoshujie/p/11082753.html>https://www.cnblogs.com/zhaoshujie/p/11082753.html</a></li><li><a href=https://q.cnblogs.com/q/107005/>https://q.cnblogs.com/q/107005/</a></li><li><a href=https://rubikscode.net/2018/06/11/asynchronous-programming-in-net-benefits-and-tradeoffs-of-using-valuetask/>https://rubikscode.net/2018/06/11/asynchronous-programming-in-net-benefits-and-tradeoffs-of-using-valuetask/</a></li><li><a href=https://blog.scooletz.com/2018/05/14/task-async-await-valuetask-ivaluetasksource-and-how-to-keep-your-sanity-in-modern-net-world/>https://blog.scooletz.com/2018/05/14/task-async-await-valuetask-ivaluetasksource-and-how-to-keep-your-sanity-in-modern-net-world/</a></li><li><a href=https://www.cnblogs.com/ms27946/p/understanding-task-valuetask.html>https://www.cnblogs.com/ms27946/p/understanding-task-valuetask.html</a></li><li><a href=https://www.cnblogs.com/ittranslator/p/13703279.html>https://www.cnblogs.com/ittranslator/p/13703279.html</a></li><li><a href=https://devblogs.microsoft.com/dotnet/understanding-the-whys-whats-and-whens-of-valuetask/>https://devblogs.microsoft.com/dotnet/understanding-the-whys-whats-and-whens-of-valuetask/</a></li><li><a href=https://www.cnblogs.com/wcrBlog/p/11690460.html>https://www.cnblogs.com/wcrBlog/p/11690460.html</a></li><li><a href=https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/concepts/async/async-return-types#generalized-async-return-types-and-valuetasktresult>https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/concepts/async/async-return-types#generalized-async-return-types-and-valuetasktresult</a></li><li><a href=https://q.cnblogs.com/q/124633/>https://q.cnblogs.com/q/124633/</a></li><li><a href=https://www.cnblogs.com/dudu/p/9860959.html#!comments>https://www.cnblogs.com/dudu/p/9860959.html#!comments</a></li><li><a href=http://labs.criteo.com/2018/10/net-threadpool-starvation-and-how-queuing-makes-it-worse/>http://labs.criteo.com/2018/10/net-threadpool-starvation-and-how-queuing-makes-it-worse/</a></li><li><a href=https://www.cnblogs.com/xishuai/p/asp-net-sync-over-async.html>https://www.cnblogs.com/xishuai/p/asp-net-sync-over-async.html</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/docs/dotnet/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/ class="flex align-center"><img src=/icons/backward.svg class=book-icon alt=Backward>
<span>å¹¶è¡Œç¼–ç¨‹</span>
</a></span><span><a href=/docs/dotnet/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class="flex align-center"><span>æ•°æ®ç»“æ„</span>
<img src=/icons/forward.svg class=book-icon alt=Forward></a></span></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#å•çº¿ç¨‹åŒæ­¥æ¨¡å‹>å•çº¿ç¨‹åŒæ­¥æ¨¡å‹</a></li><li><a href=#å¤šçº¿ç¨‹æ¨¡å‹>å¤šçº¿ç¨‹æ¨¡å‹</a></li><li><a href=#å¼‚æ­¥æ¨¡å‹>å¼‚æ­¥æ¨¡å‹</a></li></ul><ul><li><a href=#åˆ›å»ºä»»åŠ¡>åˆ›å»ºä»»åŠ¡</a><ul><li><a href=#new-taskfactory>new TaskFactory()</a></li><li><a href=#taskfactory>Task.Factory</a></li><li><a href=#new-task>new Task()</a></li><li><a href=#taskrun>Task.Run</a></li></ul></li><li><a href=#åŒæ­¥ä»»åŠ¡>åŒæ­¥ä»»åŠ¡</a></li><li><a href=#ä½¿ç”¨å•ç‹¬çº¿ç¨‹çš„ä»»åŠ¡>ä½¿ç”¨å•ç‹¬çº¿ç¨‹çš„ä»»åŠ¡</a></li><li><a href=#taskç”Ÿå‘½å‘¨æœŸ>Taskç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#taskä»»åŠ¡æ§åˆ¶>Taskä»»åŠ¡æ§åˆ¶</a></li><li><a href=#taskè¿”å›ç±»å‹>Taskè¿”å›ç±»å‹</a><ul><li><a href=#void>void</a></li><li><a href=#task>Task</a></li><li><a href=#taskt><code>Task&lt;T></code></a></li></ul></li><li><a href=#è¿ç»­ä»»åŠ¡>è¿ç»­ä»»åŠ¡</a></li><li><a href=#åµŒå¥—task>åµŒå¥—Task</a><ul><li><a href=#å…³è”åµŒå¥—>å…³è”åµŒå¥—</a></li><li><a href=#éå…³è”åµŒå¥—>éå…³è”åµŒå¥—</a></li></ul></li><li><a href=#taskå–æ¶ˆ>Taskå–æ¶ˆ</a><ul><li><a href=#å•ä¸ªä»»åŠ¡>å•ä¸ªä»»åŠ¡</a></li><li><a href=#å¤šä¸ªä»»åŠ¡>å¤šä¸ªä»»åŠ¡</a></li><li><a href=#å®šæ—¶å–æ¶ˆ>å®šæ—¶å–æ¶ˆ</a></li></ul></li><li><a href=#å–æ¶ˆæ—¶å›è°ƒ>å–æ¶ˆæ—¶å›è°ƒ</a></li></ul><ul><li><a href=#asyncawaitå¹¶ä¸èƒ½æå‡æ€§èƒ½>async/awaitå¹¶ä¸èƒ½æå‡æ€§èƒ½?</a></li><li><a href=#asyncawaitæ­»é”é—®é¢˜>async/awaitæ­»é”é—®é¢˜</a><ul><li><a href=#å¯èƒ½å‘ç”Ÿæ­»é”çš„ç¨‹åºç±»å‹>å¯èƒ½å‘ç”Ÿæ­»é”çš„ç¨‹åºç±»å‹</a></li><li><a href=#ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿæ­»é”>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿæ­»é”?</a></li><li><a href=#æ­»é”çš„åŸå› >æ­»é”çš„åŸå› ?</a></li><li><a href=#there-is-no-thread>There Is No Thread</a></li><li><a href=#ä¸ä¼šé€ æˆæ­»é”çš„å……åˆ†æ¡ä»¶>ä¸ä¼šé€ æˆæ­»é”çš„å……åˆ†æ¡ä»¶</a></li></ul></li><li><a href=#å¦‚ä½•é¿å…æ­»é”>å¦‚ä½•é¿å…æ­»é”</a></li><li><a href=#æ›´å¤šæ­»é”ç›¸å…³>æ›´å¤šæ­»é”ç›¸å…³</a></li></ul></nav></div></aside></main></body></html>