<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>⛷️ Prometheus on CODE'NOTE</title><link>https://wangpengliang815.github.io/docs/prometheus/</link><description>Recent content in ⛷️ Prometheus on CODE'NOTE</description><generator>Hugo</generator><language>zh-cn</language><atom:link href="https://wangpengliang815.github.io/docs/prometheus/index.xml" rel="self" type="application/rss+xml"/><item><title/><link>https://wangpengliang815.github.io/docs/prometheus/1.1prometheus%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%AE%89%E8%A3%85/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://wangpengliang815.github.io/docs/prometheus/1.1prometheus%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%AE%89%E8%A3%85/</guid><description>&lt;h1 id="简介"&gt;简介&lt;a class="anchor" href="#%e7%ae%80%e4%bb%8b"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Prometheus 是一个开源的完整监控解决方案，基于中央化的规则计算、统一分析和告警的新模型。 相比于传统监控系统具有以下优点：&lt;/p&gt;
&lt;h1 id="易于管理"&gt;易于管理&lt;a class="anchor" href="#%e6%98%93%e4%ba%8e%e7%ae%a1%e7%90%86"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Prometheus 核心部分只有一个单独的二进制文件，不存在任何的第三方依赖(数据库，缓存等等)。唯一需要的就是本地磁盘，因此不会有潜在级联故障的风险。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Prometheus 基于 &lt;code&gt;Pull&lt;/code&gt; 模型的架构方式，可以在任何地方（本地电脑，开发环境，测试环境）搭建监控系统&lt;/strong&gt;。对于一些复杂的情况，还可以使用服务发现( &lt;code&gt;Service Discovery&lt;/code&gt; )的能力动态管理监控目标。&lt;/p&gt;
&lt;h1 id="监控服务内部状态"&gt;监控服务内部状态&lt;a class="anchor" href="#%e7%9b%91%e6%8e%a7%e6%9c%8d%e5%8a%a1%e5%86%85%e9%83%a8%e7%8a%b6%e6%80%81"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Pometheus 鼓励用户监控服务的内部状态，基于 Prometheus 丰富的 Client 库，可以轻松的在应用程序中添加对 Prometheus 的支持，从而可以获取服务和应用内部真正的运行状态。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://www.prometheus.wang/quickstart/static/monitor-internal.png" alt="监控服务内部运行状态" /&gt;&lt;/p&gt;
&lt;h1 id="强大的数据模型"&gt;强大的数据模型&lt;a class="anchor" href="#%e5%bc%ba%e5%a4%a7%e7%9a%84%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;所有采集的监控数据均以指标 &lt;code&gt;metric&lt;/code&gt; 的形式保存在内置的时间序列数据库当中( &lt;code&gt;TSDB&lt;/code&gt; )。所有样本除了基本的指标名称以外，还包含一组用于描述该样本特征的标签。如下所示：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_status&lt;span style="color:#f92672"&gt;{&lt;/span&gt;code&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;200&amp;#39;&lt;/span&gt;,content_path&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;/api/path&amp;#39;&lt;/span&gt;, environment&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;produment&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;value1@timestamp1,value2@timestamp2...&lt;span style="color:#f92672"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_status&lt;span style="color:#f92672"&gt;{&lt;/span&gt;code&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;200&amp;#39;&lt;/span&gt;,content_path&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;/api/path2&amp;#39;&lt;/span&gt;, environment&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;produment&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#f92672"&gt;[&lt;/span&gt;value1@timestamp1,value2@timestamp2...&lt;span style="color:#f92672"&gt;]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;每一条时间序列由指标名称( &lt;code&gt;Metrics Name&lt;/code&gt; )以及一组标签( &lt;code&gt;Labels&lt;/code&gt; )唯一标识。每条时间序列按照时间的先后顺序存储一系列的样本值。&lt;/p&gt;
&lt;p&gt;表示维度的标签可能来源于监控对象的状态，比如 &lt;code&gt;code=404&lt;/code&gt; 或者 &lt;code&gt;content_path=/api/path&lt;/code&gt; 。也可能来源于的环境定义，比如 &lt;code&gt;environment=produment&lt;/code&gt; 。基于这些 &lt;code&gt;Labels&lt;/code&gt; 可以方便地对监控数据进行聚合，过滤，裁剪。&lt;/p&gt;
&lt;h1 id="promql-查询"&gt;PromQL 查询&lt;a class="anchor" href="#promql-%e6%9f%a5%e8%af%a2"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Prometheus 内置了一个强大的数据查询语言 &lt;code&gt;PromQL&lt;/code&gt; 。 通过 PromQL 可以实现对监控数据的查询、聚合。同时PromQL 也被应用于数据可视化(如Grafana)以及告警当中。&lt;/p&gt;
&lt;p&gt;通过 PromQL 可以轻松回答类似于以下问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;过去一段时间中95%应用延迟时间的分布范围？&lt;/li&gt;
&lt;li&gt;预测在4小时后，磁盘空间占用大致会是什么情况？&lt;/li&gt;
&lt;li&gt;CPU占用率前5位的服务有哪些？(过滤)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="高效"&gt;高效&lt;a class="anchor" href="#%e9%ab%98%e6%95%88"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;对于监控系统而言，大量的监控任务必然导致有大量的数据产生。而 Prometheus 可以高效地处理这些数据，对于单个 Prometheus Server 实例而言它可以处理：&lt;/p&gt;</description></item><item><title/><link>https://wangpengliang815.github.io/docs/prometheus/1.2exporter%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://wangpengliang815.github.io/docs/prometheus/1.2exporter%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/</guid><description>&lt;p&gt;上一节学习了如何部署 Prometheus Server，这节学习如何使用 Exporter 收集主机数据。在 Prometheus 的架构设计中，Prometheus Server 并不直接服务监控特定的目标，其主要任务负责数据的收集，存储并且对外提供数据查询支持。因此为了能够能够监控到某些东西，如主机的CPU使用率，需要使用到 Exporter。Prometheus 周期性的从 Exporter 暴露的 HTTP 服务地址（通常是 &lt;code&gt;/metrics&lt;/code&gt;）拉取监控样本数据。&lt;/p&gt;
&lt;blockquote class='book-hint '&gt;
&lt;p&gt;Exporter 是一个相对开放的概念，可以是一个独立运行的程序独立于监控目标，也可以直接内置在监控目标中。只要能够向 Prometheus 提供标准格式的监控样本数据即可&lt;/p&gt;
&lt;/blockquote&gt;&lt;h1 id="exporter-概念"&gt;Exporter 概念&lt;a class="anchor" href="#exporter-%e6%a6%82%e5%bf%b5"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;广义上所有可以向 Prometheus 提供监控样本数据的程序都可以被称为一个 Exporter 。Exporter 的一个实例称为Target，Prometheus 通过轮询的方式定期从这些 Target 中获取样本数据。&lt;/p&gt;
&lt;p&gt;&lt;img src="https://wangpengliang815.github.io/images/2022-07-05-16-12-19.png" alt="" /&gt;&lt;/p&gt;
&lt;h1 id="exporter-来源"&gt;Exporter 来源&lt;a class="anchor" href="#exporter-%e6%9d%a5%e6%ba%90"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id="社区提供"&gt;社区提供&lt;a class="anchor" href="#%e7%a4%be%e5%8c%ba%e6%8f%90%e4%be%9b"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Prometheus 社区提供了丰富的 Exporter 实现，涵盖了从基础设施，中间件以及网络等各个方面的监控功能。这些Exporter 可以实现大部分通用的监控需求。下面表格列举了社区中常用的 Exporter：&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;范围&lt;/th&gt;
 &lt;th&gt;常用Exporter&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;数据库&lt;/td&gt;
 &lt;td&gt;MySQL Exporter, Redis Exporter, MongoDB Exporter, MSSQL Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;硬件&lt;/td&gt;
 &lt;td&gt;Apcupsd Exporter，IoT Edison Exporter， IPMI Exporter, Node Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;消息队列&lt;/td&gt;
 &lt;td&gt;Beanstalkd Exporter, Kafka Exporter, NSQ Exporter, RabbitMQ Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;存储&lt;/td&gt;
 &lt;td&gt;Ceph Exporter, Gluster Exporter, HDFS Exporter, ScaleIO Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;HTTP服务&lt;/td&gt;
 &lt;td&gt;Apache Exporter, HAProxy Exporter, Nginx Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;API服务&lt;/td&gt;
 &lt;td&gt;AWS ECS Exporter， Docker Cloud Exporter, Docker Hub Exporter, GitHub Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;日志&lt;/td&gt;
 &lt;td&gt;Fluentd Exporter, Grok Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;监控系统&lt;/td&gt;
 &lt;td&gt;Collectd Exporter, Graphite Exporter, InfluxDB Exporter, Nagios Exporter, SNMP Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;其它&lt;/td&gt;
 &lt;td&gt;Blockbox Exporter, JIRA Exporter, Jenkins Exporter， Confluence Exporter等&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="自定义创建"&gt;自定义创建&lt;a class="anchor" href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%88%9b%e5%bb%ba"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;除了直接使用社区提供的 Exporter 程序以外，还可以基于 Prometheus 提供的 Client Library 创建自己的 Exporter 程序。目前 Promthues 社区官方提供了对以下编程语言的支持：Go、Java/Scala、Python、Ruby。同时还有第三方实现的如：Bash、C++、Common Lisp、Erlang,、Haskeel、Lua、Node.js、PHP、Rust 等。&lt;/p&gt;</description></item><item><title/><link>https://wangpengliang815.github.io/docs/prometheus/1.3promql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://wangpengliang815.github.io/docs/prometheus/1.3promql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/</guid><description>&lt;p&gt;&lt;a href="https://prometheus.io/docs/introduction"&gt;Prometheus 官方文档地址&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="监控样本"&gt;监控样本&lt;a class="anchor" href="#%e7%9b%91%e6%8e%a7%e6%a0%b7%e6%9c%ac"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;通过 Node Exporter 暴露的 HTTP 服务，Prometheus 可以采集到当前主机所有监控指标的样本数据。比如：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# HELP node_cpu_guest_seconds_total Seconds the CPUs spent in guests (VMs) for each mode.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# TYPE node_cpu_guest_seconds_total counter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;node_cpu_guest_seconds_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;cpu&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;0&amp;#34;&lt;/span&gt;,mode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;nice&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;node_cpu_guest_seconds_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;cpu&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;0&amp;#34;&lt;/span&gt;,mode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;node_cpu_guest_seconds_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;cpu&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;1&amp;#34;&lt;/span&gt;,mode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;nice&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;node_cpu_guest_seconds_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;cpu&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;1&amp;#34;&lt;/span&gt;,mode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# HELP node_cpu_seconds_total Seconds the CPUs spent in each mode.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# TYPE node_cpu_seconds_total counter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;node_cpu_seconds_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;cpu&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;0&amp;#34;&lt;/span&gt;,mode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;idle&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; 996.7
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;node_cpu_seconds_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;cpu&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;0&amp;#34;&lt;/span&gt;,mode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;iowait&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt; 0.52&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其中非 &lt;code&gt;#&lt;/code&gt; 开头的每一行表示当前 Node Exporter 采集到的一个监控样本：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;node_cpu_seconds_total&lt;/code&gt; ：表示当前指标名称&lt;/li&gt;
&lt;li&gt;大括号中的标签：表示当前样本的一些特征和维度&lt;/li&gt;
&lt;li&gt;浮点数：表示该监控样本的具体值&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="时间序列time-series"&gt;时间序列（time-series）&lt;a class="anchor" href="#%e6%97%b6%e9%97%b4%e5%ba%8f%e5%88%97time-series"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Prometheus 会将所有采集到的样本数据以时间序列（time-series）的方式保存在内存数据库中，定时保存到硬盘上。&lt;/p&gt;
&lt;blockquote class='book-hint '&gt;
&lt;p&gt;time-series 是按照时间戳和值的序列顺序存放的，称之为向量(vector)&lt;/p&gt;
&lt;/blockquote&gt;&lt;p&gt;每条 time-series 通过指标名称(metrics name)和一组标签集(labelset)命名。其中每一个点称为一个样本(sample)。样本由以下三部分组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;指标（metric）：metric name 和描述当前样本特征的 labelsets&lt;/li&gt;
&lt;li&gt;时间戳（timestamp）：一个精确到毫秒的时间戳&lt;/li&gt;
&lt;li&gt;样本值（value）： 一个 float64 的浮点型数据表示当前样本的值&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&amp;lt;--------------- metric ---------------------&amp;gt;&amp;lt;-timestamp -&amp;gt;&amp;lt;-value-&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;status&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;200&amp;#34;&lt;/span&gt;, method&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;@1434417560938 &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#ae81ff"&gt;94355&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;status&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;200&amp;#34;&lt;/span&gt;, method&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;@1434417561287 &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#ae81ff"&gt;94334&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;status&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;404&amp;#34;&lt;/span&gt;, method&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;@1434417560938 &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#ae81ff"&gt;38473&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;status&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;404&amp;#34;&lt;/span&gt;, method&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;GET&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;@1434417561287 &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#ae81ff"&gt;38544&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;status&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;200&amp;#34;&lt;/span&gt;, method&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;@1434417560938 &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#ae81ff"&gt;4748&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;http_request_total&lt;span style="color:#f92672"&gt;{&lt;/span&gt;status&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;200&amp;#34;&lt;/span&gt;, method&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;POST&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;}&lt;/span&gt;@1434417561287 &lt;span style="color:#f92672"&gt;=&lt;/span&gt;&amp;gt; &lt;span style="color:#ae81ff"&gt;4785&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id="指标metric"&gt;指标（metric）&lt;a class="anchor" href="#%e6%8c%87%e6%a0%87metric"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;指标（Metric）通过如下格式表示：&lt;/p&gt;</description></item><item><title/><link>https://wangpengliang815.github.io/docs/prometheus/1.4alertmanager%E5%91%8A%E8%AD%A6%E5%A4%84%E7%90%86/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://wangpengliang815.github.io/docs/prometheus/1.4alertmanager%E5%91%8A%E8%AD%A6%E5%A4%84%E7%90%86/</guid><description>&lt;h1 id="告警简介"&gt;告警简介&lt;a class="anchor" href="#%e5%91%8a%e8%ad%a6%e7%ae%80%e4%bb%8b"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;告警能力在 Prometheus 的架构中被划分为两个部分：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;在 Prometheus Server 中定义告警规则以及产生告警&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Alertmanager 组件用于处理由 Prometheus 产生的告警&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Alertmanager 是 Prometheus 体系中告警的统一处理中心&lt;/strong&gt;。Alertmanager 提供了多种内置第三方告警通知方式，同时还提供对 Webhook 通知的支持，通过 Webhook 可以完成对告警更多个性化的扩展。&lt;/p&gt;
&lt;blockquote class='book-hint '&gt;
&lt;p&gt;Prometheus会周期性的对告警规则进行计算，如果满足告警触发条件就会向 Alertmanager 发送告警信息&lt;/p&gt;
&lt;/blockquote&gt;&lt;p&gt;&lt;img src="https://wangpengliang815.github.io/images/2022-07-04-16-48-03.png" alt="" /&gt;&lt;/p&gt;
&lt;p&gt;告警规则主要由以下几部分组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;告警名称：需要为告警规则命名，对于命名而言，需要能够直接表达出该告警的主要内容&lt;/li&gt;
&lt;li&gt;告警规则：告警规则主要由 &lt;code&gt;PromQL&lt;/code&gt; 进行定义，其实际意义是当表达式（PromQL）查询结果持续多长时间（During）后触发告警&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在 Prometheus 中，还可以通过Group（告警组）对一组相关的告警进行统一定义。这些定义通过 &lt;code&gt;YAML&lt;/code&gt; 文件统一管理。&lt;/p&gt;
&lt;p&gt;Alertmanager 作为一个独立的组件，负责接收并处理来自 Prometheus Server (也可以是其它的客户端程序)的告警信息。Alertmanager 可以对这些告警信息进行进一步的处理，比如当接收到大量重复告警时能够消除重复的告警信息，同时对告警信息进行分组并且路由到正确的通知方，Prometheus 内置了对邮件，Slack 等多种通知方式的支持，同时还支持与 Webhook 的集成，以支持更多定制化的场景。&lt;/p&gt;
&lt;blockquote class='book-hint '&gt;
&lt;p&gt;例如，目前 Alertmanager 还不支持钉钉，可以通过 Webhook 与钉钉机器人进行集成，从而通过钉钉接收告警信息。同时 AlertManager 还提供了静默和告警抑制机制来对告警通知行为进行优化。&lt;/p&gt;
&lt;/blockquote&gt;&lt;h1 id="alertmanager-特性"&gt;Alertmanager 特性&lt;a class="anchor" href="#alertmanager-%e7%89%b9%e6%80%a7"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Alertmanager 除了提供基本的告警通知能力以外，还主要提供了如：分组、抑制以及静默等告警特性：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://wangpengliang815.github.io/images/2022-07-04-16-51-28.png" alt="" /&gt;&lt;/p&gt;
&lt;h2 id="分组"&gt;分组&lt;a class="anchor" href="#%e5%88%86%e7%bb%84"&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;分组机制可以将详细的告警信息合并成一个通知。在某些情况下，比如由于系统宕机导致大量的告警被同时触发，在这种情况下分组机制可以将这些被触发的告警合并为一个告警通知，避免一次性接受大量的告警通知，而无法对问题进行快速定位。&lt;/p&gt;
&lt;blockquote class='book-hint '&gt;
&lt;p&gt;例如，当集群中有数百个正在运行的服务实例，并且为每一个实例设置了告警规则。假如此时发生了网络故障，可能导致大量的服务实例无法连接到数据库，结果就会有数百个告警被发送到 Alertmanager。&lt;/p&gt;
&lt;p&gt;而作为用户，可能只希望能够在一个通知中就能查看哪些服务实例收到影响。这时可以按照服务所在集群或者告警名称对告警进行分组，而将这些告警内聚在一起成为一个通知。&lt;/p&gt;
&lt;/blockquote&gt;&lt;p&gt;告警分组，告警时间，以及告警的接受方式可以通过 Alertmanager 的配置文件进行配置。&lt;/p&gt;</description></item><item><title/><link>https://wangpengliang815.github.io/docs/prometheus/1.5grafana%E7%9B%91%E6%8E%A7%E5%8F%AF%E8%A7%86%E5%8C%96/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://wangpengliang815.github.io/docs/prometheus/1.5grafana%E7%9B%91%E6%8E%A7%E5%8F%AF%E8%A7%86%E5%8C%96/</guid><description>&lt;p&gt;&lt;a href="https://grafana.com/"&gt;关于 Grafana 更多资料参考&lt;/a&gt;&lt;/p&gt;
&lt;h1 id="grafana-安装"&gt;Grafana 安装&lt;a class="anchor" href="#grafana-%e5%ae%89%e8%a3%85"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;这里采用 Dokcer 安装 Grafana，如果防火墙处于开启状态需要开放对应端口。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker run -d -p 3000:3000 --user root --name&lt;span style="color:#f92672"&gt;=&lt;/span&gt;grafana -v /home/grafana:/var/lib/grafana grafana/grafana:7.3.6&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id="grafana-登录"&gt;Grafana 登录&lt;a class="anchor" href="#grafana-%e7%99%bb%e5%bd%95"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;访问：http://ipaddress:3000，默认账号/密码：&lt;code&gt;admin/admin&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://wangpengliang815.github.io/images/2022-07-13-16-54-53.png" alt="" /&gt;&lt;/p&gt;
&lt;h1 id="添加数据源"&gt;添加数据源&lt;a class="anchor" href="#%e6%b7%bb%e5%8a%a0%e6%95%b0%e6%8d%ae%e6%ba%90"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;登陆成功后，点击 &amp;ldquo;datasources&amp;rdquo; 按钮，跳转到添加数据源页面，Type 选择 Prometheus 配置如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Name&lt;/code&gt;: 数据源名称&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;URL&lt;/code&gt;: Prometheus 地址&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;Access&lt;/code&gt;: Server(Default)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其余默认，点击 &amp;ldquo;Save &amp;amp; Test&amp;rdquo;，如下所示：&lt;/p&gt;
&lt;p&gt;&lt;img src="https://wangpengliang815.github.io/images/2022-07-13-16-58-48.png" alt="" /&gt;&lt;/p&gt;
&lt;h1 id="导入-dashboard"&gt;导入 Dashboard&lt;a class="anchor" href="#%e5%af%bc%e5%85%a5-dashboard"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;从 Grafana 官网下载相关 dashboaed 到本地，如：https://grafana.com/dashboards/405&lt;/p&gt;
&lt;p&gt;Grafana首页 =&amp;gt; 左上角图标 =&amp;gt; Dashboard =&amp;gt; Import&lt;/p&gt;
&lt;p&gt;&lt;img src="https://wangpengliang815.github.io/images/2022-07-13-17-02-28.png" alt="" /&gt;&lt;/p&gt;
&lt;p&gt;上传已下载至本地的 &lt;code&gt;json &lt;/code&gt;文件或者直接使用 &lt;code&gt;dashboard id&lt;/code&gt;，&lt;a href="https://grafana.com/grafana/dashboards/"&gt;更多 Dashboard 参考&lt;/a&gt;，数据源选择之前添加的数据源，点击导入按钮。&lt;/p&gt;
&lt;h1 id="查看-dashboard"&gt;查看 Dashboard&lt;a class="anchor" href="#%e6%9f%a5%e7%9c%8b-dashboard"&gt;#&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Grafana首页 =&amp;gt; 左上角图标 =&amp;gt; Dashboard =&amp;gt; Home，双击查看创建的 Dashboard 如下：&lt;/p&gt;</description></item></channel></rss>