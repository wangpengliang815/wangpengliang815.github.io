<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Redis集群# Redis支持三种集群方案
主从复制 Sentinel（哨兵） Cluster 主从复制# 通过持久化功能，Redis保证了即使在服务器重启的情况下也不会丢失（或少量丢失）数据，因为持久化会把内存中数据保存到硬盘上，重启会从硬盘上加载数据。 但是由于数据是存储在一台服务器上的，如果这台服务器出现硬盘故障等问题，也会导致数据丢失。为了避免单点故障，通常的做法是将数据库复制多个副本以部署在不同的服务器上，这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。
为此： Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上。
在复制的概念中，数据库分为两类，一类是主数据库（master），另一类是从数据库(slave）。主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。而从数据库一般是只读的，只接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库。
实现原理# 从库启动成功后连接主库，发送 SYNC 命令 主库接收到 SYNC 命令后，开始执行 BGSAVE 命令生成 rdb 文件并使用缓冲区记录此后执行的所有写命令 主库 BGSAVE 执行完毕后，向所有从库发送快照文件，并在发送期间继续记录被执行的写命令 从库收到快照文件后丢弃所有旧数据，载入收到的快照 主库快照发送完毕后开始向从库发送缓冲区中的写命令 从库完成对快照的载入，开始接收命令请求，并执行来自主库缓冲区的写命令（至此：从库初始化完成） 主库每执行一个写命令就会向从库发送相同的写命令，从库接收并执行收到的写命令（备注：从库初始化完成后的操作） 出现断开重连后，2.8之后的版本会将断线期间的命令传给从库。增量复制 主从刚连接时：进行全量同步。全同步结束后：进行增量同步。当然如果有需要 slave 可以在任何时候都可以发起全量同步。Redis 的策略是：无论如何，首先会尝试进行增量同步，如不成功，要求从机进行全量同步 主从复制优缺点# 优点
主机会自动将数据同步到从机，可以进行读写分离 为了分载 master 的读操作压力，slave 服务器可以为客户端提供只读操作的服务，但写服务仍必须由 master 完成 slave 同样可以接受其它 slaves 的连接和同步请求，这样可以有效的分载 master 的同步压力 master-server 是以非阻塞的方式为 slaves提供服务。所以在 master-slave 同步期间，客户端仍然可以提交查询或修改请求 slave-server 同样是以非阻塞的方式完成数据同步。在同步期间，如果有客户端提交查询请求，则返回同步之前的数据 缺点
不具备自动容错和恢复功能，主机从机的宕机都会导致前端部分读写请求失败，需要等待机器重启或者手动切换 IP 才能恢复（人工介入方式） 主机宕机，宕机前如有部分数据未能及时同步到从机，切换IP后还会引入数据不一致的问题，降低了系统的可用性 如果多个 slave 掉线需要重启时，尽量不要在同一时间段进行重启。因为只要 slave 启动，就会发送sync 请求和主机全量同步，当多个 slave 重启时，可能会导致 master IO 剧增从而宕机 较难支持在线扩容，在集群容量达到上限时在线扩容会变得很复杂 主从复制搭建# 集群至少需要3个节点，因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以低于3个节点无法构成集群 要保证集群的高可用，需要每个节点都有从节点，也就是备份节点。所以Redis集群至少需要6台服务器。这里模拟搭建的是伪分布式集群（单机多实例） 默认情况下不指定主机的话，每台 Redis 都是主节点 1)：虚机运行3个 Redis 实例（一主二从），修改端口号为（79-81）。复制2份 redis.conf 模拟2个从机实例
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://github.com/wangpengliang815/wangpengliang815.github.io/docs/redis/1.9redis%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/">
  <meta property="og:site_name" content="CODE&#39;NOTE">
  <meta property="og:title" content="CODE&#39;NOTE">
  <meta property="og:description" content="Redis集群# Redis支持三种集群方案
主从复制 Sentinel（哨兵） Cluster 主从复制# 通过持久化功能，Redis保证了即使在服务器重启的情况下也不会丢失（或少量丢失）数据，因为持久化会把内存中数据保存到硬盘上，重启会从硬盘上加载数据。 但是由于数据是存储在一台服务器上的，如果这台服务器出现硬盘故障等问题，也会导致数据丢失。为了避免单点故障，通常的做法是将数据库复制多个副本以部署在不同的服务器上，这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。
为此： Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上。
在复制的概念中，数据库分为两类，一类是主数据库（master），另一类是从数据库(slave）。主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。而从数据库一般是只读的，只接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库。
实现原理# 从库启动成功后连接主库，发送 SYNC 命令 主库接收到 SYNC 命令后，开始执行 BGSAVE 命令生成 rdb 文件并使用缓冲区记录此后执行的所有写命令 主库 BGSAVE 执行完毕后，向所有从库发送快照文件，并在发送期间继续记录被执行的写命令 从库收到快照文件后丢弃所有旧数据，载入收到的快照 主库快照发送完毕后开始向从库发送缓冲区中的写命令 从库完成对快照的载入，开始接收命令请求，并执行来自主库缓冲区的写命令（至此：从库初始化完成） 主库每执行一个写命令就会向从库发送相同的写命令，从库接收并执行收到的写命令（备注：从库初始化完成后的操作） 出现断开重连后，2.8之后的版本会将断线期间的命令传给从库。增量复制 主从刚连接时：进行全量同步。全同步结束后：进行增量同步。当然如果有需要 slave 可以在任何时候都可以发起全量同步。Redis 的策略是：无论如何，首先会尝试进行增量同步，如不成功，要求从机进行全量同步 主从复制优缺点# 优点
主机会自动将数据同步到从机，可以进行读写分离 为了分载 master 的读操作压力，slave 服务器可以为客户端提供只读操作的服务，但写服务仍必须由 master 完成 slave 同样可以接受其它 slaves 的连接和同步请求，这样可以有效的分载 master 的同步压力 master-server 是以非阻塞的方式为 slaves提供服务。所以在 master-slave 同步期间，客户端仍然可以提交查询或修改请求 slave-server 同样是以非阻塞的方式完成数据同步。在同步期间，如果有客户端提交查询请求，则返回同步之前的数据 缺点
不具备自动容错和恢复功能，主机从机的宕机都会导致前端部分读写请求失败，需要等待机器重启或者手动切换 IP 才能恢复（人工介入方式） 主机宕机，宕机前如有部分数据未能及时同步到从机，切换IP后还会引入数据不一致的问题，降低了系统的可用性 如果多个 slave 掉线需要重启时，尽量不要在同一时间段进行重启。因为只要 slave 启动，就会发送sync 请求和主机全量同步，当多个 slave 重启时，可能会导致 master IO 剧增从而宕机 较难支持在线扩容，在集群容量达到上限时在线扩容会变得很复杂 主从复制搭建# 集群至少需要3个节点，因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以低于3个节点无法构成集群 要保证集群的高可用，需要每个节点都有从节点，也就是备份节点。所以Redis集群至少需要6台服务器。这里模拟搭建的是伪分布式集群（单机多实例） 默认情况下不指定主机的话，每台 Redis 都是主节点 1)：虚机运行3个 Redis 实例（一主二从），修改端口号为（79-81）。复制2份 redis.conf 模拟2个从机实例">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">


  <meta itemprop="name" content="CODE&#39;NOTE">
  <meta itemprop="description" content="Redis集群# Redis支持三种集群方案
主从复制 Sentinel（哨兵） Cluster 主从复制# 通过持久化功能，Redis保证了即使在服务器重启的情况下也不会丢失（或少量丢失）数据，因为持久化会把内存中数据保存到硬盘上，重启会从硬盘上加载数据。 但是由于数据是存储在一台服务器上的，如果这台服务器出现硬盘故障等问题，也会导致数据丢失。为了避免单点故障，通常的做法是将数据库复制多个副本以部署在不同的服务器上，这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。
为此： Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上。
在复制的概念中，数据库分为两类，一类是主数据库（master），另一类是从数据库(slave）。主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。而从数据库一般是只读的，只接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库。
实现原理# 从库启动成功后连接主库，发送 SYNC 命令 主库接收到 SYNC 命令后，开始执行 BGSAVE 命令生成 rdb 文件并使用缓冲区记录此后执行的所有写命令 主库 BGSAVE 执行完毕后，向所有从库发送快照文件，并在发送期间继续记录被执行的写命令 从库收到快照文件后丢弃所有旧数据，载入收到的快照 主库快照发送完毕后开始向从库发送缓冲区中的写命令 从库完成对快照的载入，开始接收命令请求，并执行来自主库缓冲区的写命令（至此：从库初始化完成） 主库每执行一个写命令就会向从库发送相同的写命令，从库接收并执行收到的写命令（备注：从库初始化完成后的操作） 出现断开重连后，2.8之后的版本会将断线期间的命令传给从库。增量复制 主从刚连接时：进行全量同步。全同步结束后：进行增量同步。当然如果有需要 slave 可以在任何时候都可以发起全量同步。Redis 的策略是：无论如何，首先会尝试进行增量同步，如不成功，要求从机进行全量同步 主从复制优缺点# 优点
主机会自动将数据同步到从机，可以进行读写分离 为了分载 master 的读操作压力，slave 服务器可以为客户端提供只读操作的服务，但写服务仍必须由 master 完成 slave 同样可以接受其它 slaves 的连接和同步请求，这样可以有效的分载 master 的同步压力 master-server 是以非阻塞的方式为 slaves提供服务。所以在 master-slave 同步期间，客户端仍然可以提交查询或修改请求 slave-server 同样是以非阻塞的方式完成数据同步。在同步期间，如果有客户端提交查询请求，则返回同步之前的数据 缺点
不具备自动容错和恢复功能，主机从机的宕机都会导致前端部分读写请求失败，需要等待机器重启或者手动切换 IP 才能恢复（人工介入方式） 主机宕机，宕机前如有部分数据未能及时同步到从机，切换IP后还会引入数据不一致的问题，降低了系统的可用性 如果多个 slave 掉线需要重启时，尽量不要在同一时间段进行重启。因为只要 slave 启动，就会发送sync 请求和主机全量同步，当多个 slave 重启时，可能会导致 master IO 剧增从而宕机 较难支持在线扩容，在集群容量达到上限时在线扩容会变得很复杂 主从复制搭建# 集群至少需要3个节点，因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以低于3个节点无法构成集群 要保证集群的高可用，需要每个节点都有从节点，也就是备份节点。所以Redis集群至少需要6台服务器。这里模拟搭建的是伪分布式集群（单机多实例） 默认情况下不指定主机的话，每台 Redis 都是主节点 1)：虚机运行3个 Redis 实例（一主二从），修改端口号为（79-81）。复制2份 redis.conf 模拟2个从机实例">
  <meta itemprop="wordCount" content="1646">

<title>1.9 Redis集群方案 | CODE&#39;NOTE</title>
<link rel="icon" href="/wangpengliang815/wangpengliang815.github.io/favicon.png" >
<link rel="manifest" href="/wangpengliang815/wangpengliang815.github.io/manifest.json">
<link rel="canonical" href="https://github.com/wangpengliang815/wangpengliang815.github.io/docs/redis/1.9redis%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/">
<link rel="stylesheet" href="/wangpengliang815/wangpengliang815.github.io/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/wangpengliang815/wangpengliang815.github.io/fuse.min.js"></script>
  <script defer src="/wangpengliang815/wangpengliang815.github.io/en.search.min.8fc611428ac3de10742ceb0169ea3df0598714dcd6cbc84ebe57dc6739a7521c.js" integrity="sha256-j8YRQorD3hB0LOsBaeo98FmHFNzWy8hOvlfcZzmnUhw=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/wangpengliang815/wangpengliang815.github.io/"><span>CODE&#39;NOTE</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0a19d3a7daa7f2a902390735b978f141" class="toggle"  />
    <label for="section-0a19d3a7daa7f2a902390735b978f141" class="flex">
      <a role="button" class="">
        📚 .NET</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D/" class="">
      值类型和引用类型的内存分配</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E5%8F%8D%E5%B0%84%E6%8A%80%E6%9C%AF/" class="">
      反射技术</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E5%9F%BA%E7%A1%80%E5%90%88%E9%9B%86/" class="">
      基础合集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="">
      多线程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E5%A7%94%E6%89%98%E5%92%8C%E4%BA%8B%E4%BB%B6/" class="">
      委托和事件</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E5%B9%B6%E8%A1%8C%E7%BC%96%E7%A8%8B/" class="">
      并行编程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" class="">
      异步编程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="">
      数据结构</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E6%B3%9B%E5%9E%8B%E6%8A%80%E6%9C%AF/" class="">
      泛型技术</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/" class="">
      线程同步</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/dotnet/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" class="">
      面向对象</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a711e15e6217a03d3f896c4001f054af" class="toggle"  />
    <label for="section-a711e15e6217a03d3f896c4001f054af" class="flex">
      <a role="button" class="">
        🎭 PMI-ACP</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/acp/pmi-acp%E5%9F%BA%E7%A1%80%E4%BA%86%E8%A7%A3/" class="">
      Pmi Acp基础了解</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/acp/pmi-acpdown/" class="">
      Pmi Acpdown</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B001/" class="">
      Pmi Acp备考笔记01</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B002/" class="">
      Pmi Acp备考笔记02</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/acp/pmi-acp%E5%A4%87%E8%80%83%E7%AC%94%E8%AE%B003/" class="">
      Pmi Acp备考笔记03</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-158c55270b3b873b36b554def2308a8c" class="toggle"  />
    <label for="section-158c55270b3b873b36b554def2308a8c" class="flex">
      <a role="button" class="">
        ⌛ 软件测试</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/test/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="">
      单元测试</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/test/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95k6/" class="">
      压力测试k6</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/test/%E8%87%AA%E5%8A%A8%E5%8C%96ui%E6%B5%8B%E8%AF%95/" class="">
      自动化 Ui测试</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/test/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/" class="">
      集成测试</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9e4cd5c9690a397be164e18996eeec25" class="toggle"  />
    <label for="section-9e4cd5c9690a397be164e18996eeec25" class="flex">
      <a role="button" class="">
        ⛷️ Prometheus</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/prometheus/1.1prometheus%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%AE%89%E8%A3%85/" class="">
      1.1 Prometheus简介及安装</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/prometheus/1.2exporter%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86/" class="">
      1.2 Exporter数据采集</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/prometheus/1.3promql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/" class="">
      1.3 Prom Ql查询语言</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/prometheus/1.4alertmanager%E5%91%8A%E8%AD%A6%E5%A4%84%E7%90%86/" class="">
      1.4 Alertmanager告警处理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/prometheus/1.5grafana%E7%9B%91%E6%8E%A7%E5%8F%AF%E8%A7%86%E5%8C%96/" class="">
      1.5 Grafana监控可视化</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ed189cb26f56d17bb0a62923d94a7183" class="toggle"  />
    <label for="section-ed189cb26f56d17bb0a62923d94a7183" class="flex">
      <a role="button" class="">
        🐇 RabbitMq</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.1rabbitmq%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/" class="">
      1.1 Rabbit Mq概念及安装</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.2%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D/" class="">
      1.2工作模式介绍</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.3%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%8F%8A%E6%8C%81%E4%B9%85%E5%8C%96/" class="">
      1.3消息确认及持久化</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.4%E4%B8%A4%E7%A7%8D%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%BC%8F%E5%92%8Cqos%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="">
      1.4两种消费模式和 Qos的实现</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.5channel%E5%B8%B8%E8%A7%81%E6%96%B9%E6%B3%95/" class="">
      1.5 Channel常见方法</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.6rabbitmq%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="">
      1.6 Rabbit Mq常用命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.7rabbitmq%E5%B8%B8%E8%A7%81%E7%AD%96%E7%95%A5/" class="">
      1.7 Rabbit Mq常见策略</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.8rabbitmq%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="">
      1.8 Rabbit Mq常见问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/1.9rabbitmq%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/" class="">
      1.9 Rabbit Mq集群方案</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/rabbitmq/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5rabbitmq/" class="">
      客户端连接 Rabbit Mq</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-41a08237d2a583bb6567a7bd11f94f3e" class="toggle"  />
    <label for="section-41a08237d2a583bb6567a7bd11f94f3e" class="flex">
      <a role="button" class="">
        🐹 Golang</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/01%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="">
      01开发环境搭建</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/02%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/" class="">
      02变量和常量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/03%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="">
      03基本数据类型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/04%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6/" class="">
      04流程控制和运算符</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/05%E6%95%B0%E7%BB%84/" class="">
      05数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/06%E5%88%87%E7%89%87/" class="">
      06切片</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/07map/" class="">
      07map</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/08%E5%87%BD%E6%95%B0/" class="">
      08函数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/09%E6%8C%87%E9%92%88/" class="">
      09指针</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/10%E5%8F%8D%E5%B0%84/" class="">
      10反射</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/11%E7%BB%93%E6%9E%84%E4%BD%93/" class="">
      11结构体</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/12%E6%8E%A5%E5%8F%A3/" class="">
      12接口</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/channel/" class="">
      Channel</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/csp%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/" class="">
      Csp并发模型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/goroutine/" class="">
      Goroutine</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/gpm%E5%8E%9F%E7%90%86%E4%B8%8E%E8%B0%83%E5%BA%A6/" class="">
      Gpm原理与调度</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C/" class="">
      原子操作</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E5%92%8C%E9%94%81/" class="">
      并发安全和锁</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/flag/" class="">
      Flag</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/fmt/" class="">
      Fmt</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/log/" class="">
      Log</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/go/%E6%A0%87%E5%87%86%E5%BA%93/time/" class="">
      Time</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a212feaafca18e39712c162267ab7930" class="toggle"  />
    <label for="section-a212feaafca18e39712c162267ab7930" class="flex">
      <a role="button" class="">
        💫 Microservice</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/microservice/1.1%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" class="">
      1.1微服务入门之项目搭建</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/microservice/1.2%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/" class="">
      1.2微服务入门之服务注册与发现</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/microservice/1.3%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E7%BD%91%E5%85%B3/" class="">
      1.3微服务入门之网关</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/microservice/1.4%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8B%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/" class="">
      1.4微服务入门之事件总线</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/microservice/1.5%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E4%B9%8Bdockercompose/" class="">
      1.5微服务入门之 Docker Compose</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/microservice/consul%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E5%8F%91%E7%8E%B0/" class="">
      Consul服务注册发现</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-797c59d4c24223beac308482801fe996" class="toggle" checked />
    <label for="section-797c59d4c24223beac308482801fe996" class="flex">
      <a role="button" class="">
        📦 Redis</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.10redis%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="">
      1.10 Redis常见问题</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.1nosql%E6%A6%82%E8%BF%B0/" class="">
      1.1 No Sql概述</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.2redis%E5%AE%89%E8%A3%85/" class="">
      1.2 Redis安装</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.3redis%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="">
      1.3 Redis基本数据类型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.4redis%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="">
      1.4 Redis特殊数据类型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.5redis%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C/" class="">
      1.5 Redis事务操作</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.6redis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/" class="">
      1.6 Redis配置文件详解</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.7redis%E6%8C%81%E4%B9%85%E5%8C%96/" class="">
      1.7 Redis持久化</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.8redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" class="">
      1.8 Redis发布订阅</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.9redis%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/" class="active">
      1.9 Redis集群方案</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/" class="">
      使用 Docker搭建 Redis集群</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5redis/" class="">
      客户端连接 Redis</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-146aedbcf8714fb62838757a1082a467" class="toggle"  />
    <label for="section-146aedbcf8714fb62838757a1082a467" class="flex">
      <a role="button" class="">
        🔎 ELK</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/elk/1.1elastaticsearch%E5%85%A5%E9%97%A8/" class="">
      1.1 Elastatic Search入门</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/elk/1.2elastaticsearch%E9%85%8D%E7%BD%AE/" class="">
      1.2 Elastatic Search配置</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/elk/1.3%E4%BD%BF%E7%94%A8kibana%E6%93%8D%E4%BD%9Ces/" class="">
      1.3使用 Kibana操作 Es</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e876d2a6c86b79fe88fd120640b84773" class="toggle"  />
    <label for="section-e876d2a6c86b79fe88fd120640b84773" class="flex">
      <a role="button" class="">
        🚢 Docker</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.1docker%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%AE%89%E8%A3%85/" class="">
      1.1 Docker概念及安装</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.2docker%E9%95%9C%E5%83%8F/" class="">
      1.2 Docker镜像</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.3docker%E5%AE%B9%E5%99%A8/" class="">
      1.3 Docker容器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.4docker%E4%BB%93%E5%BA%93/" class="">
      1.4 Docker仓库</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.5docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/" class="">
      1.5 Docker数据管理</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.6docker%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F/" class="">
      1.6 Docker容器网络模式</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.7docker%E9%AB%98%E7%BA%A7%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" class="">
      1.7 Docker高级网络配置</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.8dockerfile/" class="">
      1.8 Dockerfile</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/1.9dockercompose/" class="">
      1.9 Docker Compose</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/2.0dockermachine/" class="">
      2.0 Docker Machine</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/2.1dockerswarm/" class="">
      2.1 Docker Swarm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/2.2docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="">
      2.2 Docker常用命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/docker/2.3portainer%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF/" class="">
      2.3 Portainer可视化面板</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-31ced7a6f12c0e1d312f5c9d5aa42f8e" class="toggle"  />
    <label for="section-31ced7a6f12c0e1d312f5c9d5aa42f8e" class="flex">
      <a role="button" class="">
        🕸️ K8s</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/kubernetes/kubernetes%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="">
      Kubernetes基础知识</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/kubernetes/kubernetes%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/" class="">
      Kubernetes集群安装</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b7939089f2d38db5071ac1464e01a040" class="toggle"  />
    <label for="section-b7939089f2d38db5071ac1464e01a040" class="flex">
      <a role="button" class="">
        🖥️ Linux</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/linux/centos7%E5%8D%87%E7%BA%A7gcc%E7%89%88%E6%9C%AC/" class="">
      Centos7升级gcc版本</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/linux/centos%E5%AE%89%E8%A3%85hexo/" class="">
      Centos安装 Hexo</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/linux/centos%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/" class="">
      Centos网络配置</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/linux/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="">
      Linux常用命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/linux/linux%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E/" class="">
      Linux目录说明</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/linux/vmware%E5%AE%89%E8%A3%85centos/" class="">
      Vmware安装 Centos</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3f1b0bb4bbdd3ea5d43f21f5b8664c28" class="toggle"  />
    <label for="section-3f1b0bb4bbdd3ea5d43f21f5b8664c28" class="flex">
      <a role="button" class="">
        🛍️ Devops</a>
      <img src="/wangpengliang815/wangpengliang815.github.io/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/devops/gitlab%E5%AE%89%E8%A3%85/" class="">
      Gitlab安装</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/devops/jenkins%E5%AE%89%E8%A3%85/" class="">
      Jenkins安装</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/devops/jenkins%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/" class="">
      Jenkins常见操作</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/wangpengliang815/wangpengliang815.github.io/docs/devops/nugetserver%E6%90%AD%E5%BB%BA/" class="">
      Nuget Server搭建</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/wangpengliang815/wangpengliang815.github.io/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>1.9 Redis集群方案</h3>

  <label for="toc-control">
    
    <img src="/wangpengliang815/wangpengliang815.github.io/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#主从复制">主从复制</a>
      <ul>
        <li><a href="#实现原理">实现原理</a></li>
        <li><a href="#主从复制优缺点"><strong>主从复制优缺点</strong></a></li>
        <li><a href="#主从复制搭建">主从复制搭建</a></li>
      </ul>
    </li>
    <li><a href="#sentinel哨兵模式">Sentinel（哨兵）模式</a>
      <ul>
        <li><a href="#哨兵作用">哨兵作用</a></li>
        <li><a href="#故障切换failover过程">故障切换（failover）过程</a></li>
        <li><a href="#哨兵工作方式">哨兵工作方式</a></li>
        <li><a href="#哨兵模式优缺点">哨兵模式优缺点</a></li>
        <li><a href="#哨兵模式搭建">哨兵模式搭建</a></li>
      </ul>
    </li>
    <li><a href="#cluster-集群模式">Cluster 集群模式</a>
      <ul>
        <li><a href="#cluster特点">Cluster特点</a></li>
        <li><a href="#cluster集群模式对比">Cluster集群模式对比</a></li>
        <li><a href="#数据存储设计"><strong>数据存储设计</strong></a></li>
        <li><a href="#哈希槽slot">哈希槽Slot</a></li>
        <li><a href="#集群内部通讯机制">集群内部通讯机制</a></li>
        <li><a href="#cluster集群搭建">Cluster集群搭建</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="redis集群">Redis集群<a class="anchor" href="#redis%e9%9b%86%e7%be%a4">#</a></h1>
<p>Redis支持三种集群方案</p>
<ul>
<li>主从复制</li>
<li>Sentinel（哨兵）</li>
<li>Cluster</li>
</ul>
<!-- more -->
<h2 id="主从复制">主从复制<a class="anchor" href="#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6">#</a></h2>
<p>通过持久化功能，Redis保证了即使在服务器重启的情况下也不会丢失（或少量丢失）数据，因为持久化会把内存中数据保存到硬盘上，重启会从硬盘上加载数据。 但是由于数据是存储在一台服务器上的，如果这台服务器出现硬盘故障等问题，也会导致数据丢失。为了避免单点故障，通常的做法是将数据库复制多个副本以部署在不同的服务器上，这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。</p>
<p>为此： <code>Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上</code>。</p>
<p>在复制的概念中，数据库分为两类，一类是主数据库（master），另一类是从数据库(slave）。主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。而从数据库一般是只读的，只接受主数据库同步过来的数据。<code>一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库</code>。</p>
<h3 id="实现原理">实现原理<a class="anchor" href="#%e5%ae%9e%e7%8e%b0%e5%8e%9f%e7%90%86">#</a></h3>
<ol>
<li>从库启动成功后连接主库，发送 <code>SYNC</code> 命令</li>
<li>主库接收到 <code>SYNC</code> 命令后，开始执行 <code>BGSAVE</code> 命令生成 <code>rdb</code> 文件并使用缓冲区记录此后执行的所有写命令</li>
<li>主库 <code>BGSAVE</code> 执行完毕后，向所有从库发送快照文件，并在发送期间继续记录被执行的写命令</li>
<li>从库收到快照文件后丢弃所有旧数据，载入收到的快照</li>
<li>主库快照发送完毕后开始向从库发送缓冲区中的写命令</li>
<li>从库完成对快照的载入，开始接收命令请求，并执行来自主库缓冲区的写命令（至此：从库初始化完成）</li>
<li>主库每执行一个写命令就会向从库发送相同的写命令，从库接收并执行收到的写命令（备注：从库初始化完成后的操作）</li>
<li>出现断开重连后，2.8之后的版本会将断线期间的命令传给从库。增量复制</li>
<li>主从刚连接时：进行全量同步。全同步结束后：进行增量同步。当然如果有需要 slave 可以在任何时候都可以发起全量同步。Redis 的策略是：无论如何，首先会尝试进行增量同步，如不成功，要求从机进行全量同步</li>
</ol>
<h3 id="主从复制优缺点"><strong>主从复制优缺点</strong><a class="anchor" href="#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e4%bc%98%e7%bc%ba%e7%82%b9">#</a></h3>
<p><strong>优点</strong></p>
<ul>
<li>主机会自动将数据同步到从机，可以进行读写分离</li>
<li>为了分载 <code>master</code> 的读操作压力，<code>slave</code> 服务器可以为客户端提供只读操作的服务，但写服务仍必须由 <code>master</code> 完成</li>
<li><code>slave</code> 同样可以接受其它 <code>slaves</code> 的连接和同步请求，这样可以有效的分载 <code>master</code> 的同步压力</li>
<li><code>master-server</code> 是以非阻塞的方式为 <code>slaves</code>提供服务。所以在 <code>master-slave</code> 同步期间，客户端仍然可以提交查询或修改请求</li>
<li><code>slave-server</code> 同样是以非阻塞的方式完成数据同步。在同步期间，如果有客户端提交查询请求，则返回同步之前的数据</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>不具备自动容错和恢复功能，主机从机的宕机都会导致前端部分读写请求失败，需要等待机器重启或者手动切换 <code>IP</code> 才能恢复（人工介入方式）</li>
<li>主机宕机，宕机前如有部分数据未能及时同步到从机，切换IP后还会引入数据不一致的问题，降低了系统的可用性</li>
<li>如果多个 <code>slave</code> 掉线需要重启时，尽量不要在同一时间段进行重启。因为只要 <code>slave</code> 启动，就会发送<code>sync</code> 请求和主机全量同步，当多个 <code>slave</code> 重启时，可能会导致 <code>master</code> <code>IO</code> 剧增从而宕机</li>
<li>较难支持在线扩容，在集群容量达到上限时在线扩容会变得很复杂</li>
</ul>
<h3 id="主从复制搭建">主从复制搭建<a class="anchor" href="#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e6%90%ad%e5%bb%ba">#</a></h3>
<ul>
<li>集群至少需要3个节点，因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以低于3个节点无法构成集群</li>
<li>要保证集群的高可用，需要每个节点都有从节点，也就是备份节点。所以Redis集群至少需要6台服务器。这里模拟搭建的是伪分布式集群（<strong>单机多实例</strong>）</li>
<li>默认情况下不指定主机的话，每台 Redis 都是主节点</li>
</ul>
<p>1)：虚机运行3个 Redis 实例（一主二从），修改端口号为（79-81）。复制2份 <code>redis.conf</code> 模拟2个从机实例</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>conf  dump.rdb  redis-benchmark  redis-check-aof  redis-check-rdb  redis-cli  redis-sentinel  redis-server
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># cd conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>redis.conf
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># cp redis.conf redis80.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># cp redis.conf redis81.conf</span></span></span></code></pre></div><table>
  <thead>
      <tr>
          <th style="text-align: center">类型</th>
          <th style="text-align: center">端口</th>
          <th style="text-align: center">配置文件</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">master</td>
          <td style="text-align: center">6379</td>
          <td style="text-align: center">redis.conf</td>
      </tr>
      <tr>
          <td style="text-align: center">slave1</td>
          <td style="text-align: center">6380</td>
          <td style="text-align: center">redis80.conf</td>
      </tr>
      <tr>
          <td style="text-align: center">slave2</td>
          <td style="text-align: center">6381</td>
          <td style="text-align: center">redis81.conf</td>
      </tr>
  </tbody>
</table>
<p>2)：修改配置</p>
<ol>
<li><code>logfile</code></li>
<li><code>dbfilename</code></li>
<li><code>port</code></li>
<li><code>pidfile</code></li>
</ol>
<p>redis.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>logfile <span style="color:#e6db74">&#34;6379.log&#34;</span>
</span></span><span style="display:flex;"><span>dbfilename dump6379.rdb</span></span></code></pre></div><p>redis80.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>logfile <span style="color:#e6db74">&#34;6380.log&#34;</span>
</span></span><span style="display:flex;"><span>dbfilename dump6380.rdb
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6380</span>
</span></span><span style="display:flex;"><span>pidfile /var/run/redis_6380.pid</span></span></code></pre></div><p>redis81.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>logfile <span style="color:#e6db74">&#34;6381.log&#34;</span>
</span></span><span style="display:flex;"><span>dbfilename dump6381.rdb
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">6381</span>
</span></span><span style="display:flex;"><span>pidfile /var/run/redis_6381.pid</span></span></code></pre></div><p>3)：查看Redis进程信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># ps -ef|grep redis</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2679</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 02:53 ?        00:00:00 ./redis-server 0.0.0.0:6379
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2685</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 02:54 ?        00:00:00 ./redis-server 0.0.0.0:6380
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2691</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 02:54 ?        00:00:00 ./redis-server 0.0.0.0:6381
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2697</span>   <span style="color:#ae81ff">2643</span>  <span style="color:#ae81ff">0</span> 02:54 pts/3    00:00:00 grep --color<span style="color:#f92672">=</span>auto redis</span></span></code></pre></div><p>4)：设置主从：<code>SLAVEOF {host} {port}</code></p>
<p>80</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-cli -p 6380</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; SLAVEOF 0.0.0.0 <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:0.0.0.0
</span></span><span style="display:flex;"><span>master_port:6379
</span></span><span style="display:flex;"><span>master_link_status:up
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:0
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_repl_offset:28
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:fb828085ccb5c0b804cfa2e8112656aef5f561c8
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:28
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:28</span></span></code></pre></div><p>81</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-cli -p 6381</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6381&gt; clear
</span></span><span style="display:flex;"><span>127.0.0.1:6381&gt; SLAVEOF 0.0.0.0 <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6381&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:0.0.0.0
</span></span><span style="display:flex;"><span>master_port:6379
</span></span><span style="display:flex;"><span>master_link_status:up
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:1
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_repl_offset:210
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:fb828085ccb5c0b804cfa2e8112656aef5f561c8
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:210
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:183
</span></span><span style="display:flex;"><span>repl_backlog_histlen:28</span></span></code></pre></div><p>79（master）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:2
</span></span><span style="display:flex;"><span>slave0:ip<span style="color:#f92672">=</span>127.0.0.1,port<span style="color:#f92672">=</span>6380,state<span style="color:#f92672">=</span>online,offset<span style="color:#f92672">=</span>210,lag<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>slave1:ip<span style="color:#f92672">=</span>127.0.0.1,port<span style="color:#f92672">=</span>6381,state<span style="color:#f92672">=</span>online,offset<span style="color:#f92672">=</span>210,lag<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:fb828085ccb5c0b804cfa2e8112656aef5f561c8
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:210
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:210</span></span></code></pre></div><p><strong>注意</strong>：使用命令的方式集群是暂时的；如果需要永久生效需要修改配置文件</p>
<p>5)：修改配置文件设置主从</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span></code></pre></div><p>redis80.conf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>replicaof 0.0.0.0 <span style="color:#ae81ff">6379</span></span></span></code></pre></div><p>redis81.conf</p>
<pre tabindex="0"><code>replicaof 0.0.0.0 6379</code></pre><p>如果主机有密码通过 <code>masterauth &lt;master-password&gt;</code> 设置。</p>
<p><strong>注意</strong></p>
<ul>
<li>主机可写，从机只能读不能写</li>
<li>主机中数据会自动备份到从机</li>
</ul>
<p>6)：主机宕机测试</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>127.0.0.1:6379&gt; SHUTDOWN
</span></span><span style="display:flex;"><span>not connected&gt; exit</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ps -ef|grep redis</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2723</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 03:12 ?        00:00:00 ./redis-server 0.0.0.0:6380
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2728</span>   <span style="color:#ae81ff">2605</span>  <span style="color:#ae81ff">0</span> 03:12 pts/1    00:00:00 ./redis-cli -p <span style="color:#ae81ff">6380</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2730</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 03:12 ?        00:00:00 ./redis-server 0.0.0.0:6381
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2735</span>   <span style="color:#ae81ff">2624</span>  <span style="color:#ae81ff">0</span> 03:12 pts/2    00:00:00 ./redis-cli -p <span style="color:#ae81ff">6381</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">2738</span>   <span style="color:#ae81ff">2643</span>  <span style="color:#ae81ff">0</span> 03:16 pts/3    00:00:00 grep --color<span style="color:#f92672">=</span>auto redis</span></span></code></pre></div><p>80</p>
<p>此时并没有配置哨兵，所以在 <code>Master</code> 79宕机后，80依旧是从机。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>127.0.0.1:6380&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:0.0.0.0
</span></span><span style="display:flex;"><span>master_port:6379
</span></span><span style="display:flex;"><span>master_link_status:down
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:-1
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_repl_offset:1130
</span></span><span style="display:flex;"><span>master_link_down_since_seconds:17
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:fb828085ccb5c0b804cfa2e8112656aef5f561c8
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:1130
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:771
</span></span><span style="display:flex;"><span>repl_backlog_histlen:360</span></span></code></pre></div><ul>
<li>主机断线重连后，从机依旧可以读取到主机的值</li>
<li>从机断线重连后，从机依旧可以读取到主机的值</li>
</ul>
<p>7)：手动切换主节点</p>
<p>此时使用 <code>Slaveof no one</code> 命令可以使80变成主机。</p>
<h2 id="sentinel哨兵模式">Sentinel（哨兵）模式<a class="anchor" href="#sentinel%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f">#</a></h2>
<p>主从切换的方法是：当主服务器宕机后，需要手动把从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式。哨兵模式是一种特殊的模式，首先 Redis 提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是：哨兵通过发送命令等待Redis服务器响应，从而监控运行的多个Redis实例。</p>
<h3 id="哨兵作用">哨兵作用<a class="anchor" href="#%e5%93%a8%e5%85%b5%e4%bd%9c%e7%94%a8">#</a></h3>
<ul>
<li>通过发送命令，让 Redis 服务器返回监控其运行状态，包括主服务器和从服务器</li>
<li>当哨兵监测到 master 宕机，会自动将 slave切换成  master ，然后通过 发布订阅模式通知其他的从机修改配置文件，让它们切换主机</li>
<li>master 切换后，<code>master_redis.conf</code> 、<code>slave_redis.conf</code> 和 <code>sentinel.conf</code> 的内容都会发生改变，<code>master_redis.conf</code>  中会多一行 <code>slaveof </code>的配置，<code>sentinel.conf</code> 的监控目标会随之调换</li>
<li>一个哨兵进程对 <code>Redis</code> 服务器进行监控，可能会出现问题，为此可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这就形成了多哨兵模式</li>
</ul>
<h3 id="故障切换failover过程">故障切换（failover）过程<a class="anchor" href="#%e6%95%85%e9%9a%9c%e5%88%87%e6%8d%a2failover%e8%bf%87%e7%a8%8b">#</a></h3>
<ul>
<li>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行 <code>failover</code>，仅仅是哨兵1主观的认为主服务器不可用，这个现象称为 <strong>主观下线</strong></li>
<li>当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行 <code>failover</code> 。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为 <strong>客观下线</strong></li>
</ul>
<h3 id="哨兵工作方式">哨兵工作方式<a class="anchor" href="#%e5%93%a8%e5%85%b5%e5%b7%a5%e4%bd%9c%e6%96%b9%e5%bc%8f">#</a></h3>
<ul>
<li>每个<code>sentinel</code>以每秒钟一次的频率向它所知的<code>master</code>、<code>slave</code>、 <code>sentinel</code> 实例发送一个 <code>PING</code> 命令</li>
<li>如果一个实例（<code>instance</code>）距离最后一次有效回复 <code>PING</code> 命令的时间超过 <code>down-after-milliseconds</code>选项所指定的值， 则这个实例会被 <code>sentinel</code> 标记为主观下线</li>
<li>如果一个<code>master</code>被标记为主观下线，则正在监视这个<code>master</code>的所有 <code>sentinels</code> 要以每秒一次的频率确认<code>master</code> 的确进入了主观下线状态</li>
<li>当有足够数量的 <code>sentinel</code>（大于等于配置文件指定的值）在指定的时间范围内确认 <code>master</code> 的确进入了主观下线状态，则 <code>master</code> 会被标记为客观下线</li>
<li>一般情况下， 每个 <code>sentinel</code> 会以每 10 秒一次的频率向它已知的所有 <code>master</code>、<code>slave</code>发送  <code>INFO </code>命令</li>
<li>当<code>master</code>被 <code>sentinel</code> 标记为客观下线时，<code>sentinel</code> 向 <code>master</code> 的所有 <code>slave</code> 发送 <code>INFO</code> 命令的频率会从 10 秒一次改为每秒一次</li>
<li>若没有足够数量的 <code>sentinel</code> 同意 <code>master</code> 已经下线， <code>master</code> 的客观下线状态就会被移除。若<code>master</code> 重新向 <code>sentinel</code> 的 <code>PING</code> 命令返回有效回复，<code>master</code> 的主观下线状态就会被移除</li>
</ul>
<h3 id="哨兵模式优缺点">哨兵模式优缺点<a class="anchor" href="#%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f%e4%bc%98%e7%bc%ba%e7%82%b9">#</a></h3>
<p><strong>优点</strong></p>
<ul>
<li>哨兵模式是基于主从模式的，所有主从的优点哨兵模式都具有</li>
<li>主从可以自动切换。系统更健壮、可用性更高（可以看作自动版的主从复制）</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>Redis 较难支持在线扩容，在集群容量达到上限时在线扩容会变得很复杂</li>
</ul>
<h3 id="哨兵模式搭建">哨兵模式搭建<a class="anchor" href="#%e5%93%a8%e5%85%b5%e6%a8%a1%e5%bc%8f%e6%90%ad%e5%bb%ba">#</a></h3>
<p>1)：Redis安装目录下有一个 <code>sentinel.conf</code> 文件，<code>copy  </code>一份进行修改</p>
<p>2)：配置哨兵</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 配置监听的主服务器，这里sentinel monitor代表监控，mymaster代表服务器的名称，可以自定义</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 192.168.11.128代表监控的主服务器，6379代表端口，2代表只有两个或两个以上的哨兵认为主服务器不可用的时候，才会进行failover操作。权值为2，这里的权值，是用来计算我们需要将哪一台服务器升级升主服务器</span>
</span></span><span style="display:flex;"><span>sentinel monitor mymaster 0.0.0.0 <span style="color:#ae81ff">6379</span> <span style="color:#ae81ff">2</span></span></span></code></pre></div><p>3)：启动哨兵</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-sentinel conf/sentinel.conf</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.075 <span style="color:#75715e"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.075 <span style="color:#75715e"># Redis version=6.2.1, bits=64, commit=00000000, modified=0, pid=2821, just sta</span>
</span></span><span style="display:flex;"><span>rted2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.075 <span style="color:#75715e"># Configuration loaded</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.076 * Increased maximum number of open files to <span style="color:#ae81ff">10032</span> <span style="color:#f92672">(</span>it was originally set to <span style="color:#ae81ff">102</span>
</span></span><span style="display:flex;"><span>4<span style="color:#f92672">)</span>.2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.076 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>                _._                                                  
</span></span><span style="display:flex;"><span>           _.-<span style="color:#e6db74">``</span>__ <span style="color:#e6db74">&#39;&#39;</span>-._                                             
</span></span><span style="display:flex;"><span>      _.-<span style="color:#e6db74">``</span>    <span style="color:#e6db74">`</span>.  <span style="color:#e6db74">`</span>_.  <span style="color:#e6db74">&#39;&#39;</span>-._           Redis 6.2.1 <span style="color:#f92672">(</span>00000000/0<span style="color:#f92672">)</span> <span style="color:#ae81ff">64</span> bit
</span></span><span style="display:flex;"><span>  .-<span style="color:#e6db74">``</span> .-<span style="color:#e6db74">```</span>.  <span style="color:#e6db74">```</span><span style="color:#ae81ff">\/</span>    _.,_ <span style="color:#e6db74">&#39;&#39;</span>-._                                   
</span></span><span style="display:flex;"><span> <span style="color:#f92672">(</span>    <span style="color:#e6db74">&#39;      ,       .-`  | `,    )     Running in sentinel mode
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> |`-._`-...-` __...-.``-._|&#39;</span><span style="color:#e6db74">`</span> _.-<span style="color:#e6db74">&#39;|     Port: 26379
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> |    `-._   `._    /     _.-&#39;</span>    |     PID: <span style="color:#ae81ff">2821</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">`</span>-._    <span style="color:#e6db74">`</span>-._  <span style="color:#e6db74">`</span>-./  _.-<span style="color:#e6db74">&#39;    _.-&#39;</span>                                   
</span></span><span style="display:flex;"><span> |<span style="color:#e6db74">`</span>-._<span style="color:#e6db74">`</span>-._    <span style="color:#e6db74">`</span>-.__.-<span style="color:#e6db74">&#39;    _.-&#39;</span>_.-<span style="color:#e6db74">&#39;|                                  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> |    `-._`-._        _.-&#39;</span>_.-<span style="color:#e6db74">&#39;    |           http://redis.io        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  `-._    `-._`-.__.-&#39;</span>_.-<span style="color:#e6db74">&#39;    _.-&#39;</span>                                   
</span></span><span style="display:flex;"><span> |<span style="color:#e6db74">`</span>-._<span style="color:#e6db74">`</span>-._    <span style="color:#e6db74">`</span>-.__.-<span style="color:#e6db74">&#39;    _.-&#39;</span>_.-<span style="color:#e6db74">&#39;|                                  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> |    `-._`-._        _.-&#39;</span>_.-<span style="color:#e6db74">&#39;    |                                  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  `-._    `-._`-.__.-&#39;</span>_.-<span style="color:#e6db74">&#39;    _.-&#39;</span>                                   
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">`</span>-._    <span style="color:#e6db74">`</span>-.__.-<span style="color:#e6db74">&#39;    _.-&#39;</span>                                       
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">`</span>-._        _.-<span style="color:#e6db74">&#39;                                           
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              `-.__.-&#39;</span>                                               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.076 <span style="color:#75715e"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/</span>
</span></span><span style="display:flex;"><span>net/core/somaxconn is set to the lower value of 128.2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.077 <span style="color:#75715e"># Sentinel ID is fdcb482b76a22f67429b1473ddc33d0d3769f7f3</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.077 <span style="color:#75715e"># +monitor master mymaster 0.0.0.0 6379 quorum 1</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.078 * +slave slave 127.0.0.1:6380 127.0.0.1 <span style="color:#ae81ff">6380</span> @ mymaster 0.0.0.0 <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:13:16.080 * +slave slave 127.0.0.1:6381 127.0.0.1 <span style="color:#ae81ff">6381</span> @ mymaster 0.0.0.0 <span style="color:#ae81ff">6379</span></span></span></code></pre></div><p>Sentinel 启动之后，就会监视到现在有一个主服务器，两个从服务器；当把其中一个从服务器器关闭之后，可以看到日志</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.125 <span style="color:#75715e"># +sdown master mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.125 <span style="color:#75715e"># +odown master mymaster 0.0.0.0 6379 #quorum 1/1</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.125 <span style="color:#75715e"># +new-epoch 1</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.125 <span style="color:#75715e"># +try-failover master mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.132 <span style="color:#75715e"># +vote-for-leader fdcb482b76a22f67429b1473ddc33d0d3769f7f3 1</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.132 <span style="color:#75715e"># +elected-leader master mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.132 <span style="color:#75715e"># +failover-state-select-slave master mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.199 <span style="color:#75715e"># +selected-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.199 * +failover-state-send-slaveof-noone slave 127.0.0.1:6380 127.0.0.1 <span style="color:#ae81ff">6380</span> @ myma
</span></span><span style="display:flex;"><span>ster 0.0.0.0 63792821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.282 * +failover-state-wait-promotion slave 127.0.0.1:6380 127.0.0.1 <span style="color:#ae81ff">6380</span> @ mymaster
</span></span><span style="display:flex;"><span> 0.0.0.0 63792821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.288 <span style="color:#75715e"># +promoted-slave slave 127.0.0.1:6380 127.0.0.1 6380 @ mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.288 <span style="color:#75715e"># +failover-state-reconf-slaves master mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:03.340 * +slave-reconf-sent slave 127.0.0.1:6381 127.0.0.1 <span style="color:#ae81ff">6381</span> @ mymaster 0.0.0.0 <span style="color:#ae81ff">637</span>
</span></span><span style="display:flex;"><span>92821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:04.312 * +slave-reconf-inprog slave 127.0.0.1:6381 127.0.0.1 <span style="color:#ae81ff">6381</span> @ mymaster 0.0.0.0 <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>3792821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:04.312 * +slave-reconf-done slave 127.0.0.1:6381 127.0.0.1 <span style="color:#ae81ff">6381</span> @ mymaster 0.0.0.0 <span style="color:#ae81ff">637</span>
</span></span><span style="display:flex;"><span>92821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:04.378 <span style="color:#75715e"># +failover-end master mymaster 0.0.0.0 6379</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:04.378 <span style="color:#75715e"># +switch-master mymaster 0.0.0.0 6379 127.0.0.1 6380</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:04.379 * +slave slave 127.0.0.1:6381 127.0.0.1 <span style="color:#ae81ff">6381</span> @ mymaster 127.0.0.1 <span style="color:#ae81ff">6380</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:04.379 * +slave slave 0.0.0.0:6379 0.0.0.0 <span style="color:#ae81ff">6379</span> @ mymaster 127.0.0.1 <span style="color:#ae81ff">6380</span>
</span></span><span style="display:flex;"><span>2821:X <span style="color:#ae81ff">19</span> Apr <span style="color:#ae81ff">2021</span> 04:14:34.411 <span style="color:#75715e"># +sdown slave 0.0.0.0:6379 0.0.0.0 6379 @ mymaster 127.0.0.1 6380</span></span></span></code></pre></div><p>此时Master从79转移到了80</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>127.0.0.1:6380&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:1
</span></span><span style="display:flex;"><span>slave0:ip<span style="color:#f92672">=</span>127.0.0.1,port<span style="color:#f92672">=</span>6381,state<span style="color:#f92672">=</span>online,offset<span style="color:#f92672">=</span>4615,lag<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:872d3e4c9538abb9f117dcc47de99ac57791433a
</span></span><span style="display:flex;"><span>master_replid2:612af05d7a22d2b35e595f43be74ddd771765798
</span></span><span style="display:flex;"><span>master_repl_offset:4615
</span></span><span style="display:flex;"><span>second_repl_offset:1212
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:4615</span></span></code></pre></div><p>79重新连接</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-server conf/redis.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-cli -p 6379</span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; ping
</span></span><span style="display:flex;"><span>PONG
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:127.0.0.1
</span></span><span style="display:flex;"><span>master_port:6380
</span></span><span style="display:flex;"><span>master_link_status:up
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:1
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_repl_offset:35074
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:872d3e4c9538abb9f117dcc47de99ac57791433a
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:35074
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:32735
</span></span><span style="display:flex;"><span>repl_backlog_histlen:2340</span></span></code></pre></div><p>79重新连接后只能是从机了，master已经被80抢占。</p>
<h2 id="cluster-集群模式">Cluster 集群模式<a class="anchor" href="#cluster-%e9%9b%86%e7%be%a4%e6%a8%a1%e5%bc%8f">#</a></h2>
<p>Redis Cluster是一种服务器 Sharding 技术，3.0版本开始正式提供。Redis 的哨兵模式基本已经可以实现高可用，读写分离 ，但是在这种模式下每台 Redis 服务器都存储相同的数据，很浪费内存，所以在 Redis3.0上加入了 Cluster 集群模式，实现了 Redis 的分布式存储。也就是说每台 Redis 节点上存储不同的内容。</p>
<h3 id="cluster特点">Cluster特点<a class="anchor" href="#cluster%e7%89%b9%e7%82%b9">#</a></h3>
<ul>
<li>多主多从去中心化：从节点作为备用，复制主节点，不做读写操作不提供服务（可通过 <code>readOnly</code> 实现只读）</li>
<li>不支持处理多个key：因为数据分散在多个节点，在数据量大高并发的情况下会影响性能</li>
<li>支持动态扩容节点：Rerdis Cluster 最大的优点之一</li>
<li>节点之间相互通信，相互选举，不再依赖Sentinel：准确来说是主节点之间相互“监督”，保证及时故障转移</li>
</ul>
<h3 id="cluster集群模式对比">Cluster集群模式对比<a class="anchor" href="#cluster%e9%9b%86%e7%be%a4%e6%a8%a1%e5%bc%8f%e5%af%b9%e6%af%94">#</a></h3>
<ul>
<li>相比哨兵模式：多个master节点保证主要业务（比如master节点主要负责写）稳定性，不需要搭建多个sentinel实例监控一个master节点</li>
<li>相比一主多从模式：不需要手动切换，具有自我故障检测，故障转移的特点</li>
<li>相比其哨兵和主从：对数据进行分片（sharding），不同节点存储数据不一样支持动态扩容。从某种程度上来说，Sentinel模式主要针对高可用（HA），而Cluster模式是不仅针对大数据量，高并发，同时也支持HA</li>
</ul>
<h3 id="数据存储设计"><strong>数据存储设计</strong><a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e8%ae%be%e8%ae%a1">#</a></h3>
<ul>
<li>通过算法设计，计算出key应该保存的位置</li>
<li>将所有的存储空间计划切割成<code>16384</code>份，每台主机保存一部分每份代表的是一个存储空间，不是一个<code>key</code>的保存空间</li>
<li>将<code>key</code>按照计算出的结果放到对应的存储空间</li>
</ul>
<p>1)：<code>key</code>通过<code>hash</code>算法计算出一个值，然后拿这个值<code>%16384</code></p>
<p>2)：得到一个数（假如是37）为key的保存位置，然后再存入相应的存储空间位置</p>
<p><img src="/images/2021-09-03-17-12-12.png" alt="" /></p>
<p>3)：假如又增加了一个节点，之前每个节点都会拿出部分槽给新的节点</p>
<p>4)：如果是去除节点，则把被去除节点的槽加入到存在的节点当中</p>
<h3 id="哈希槽slot">哈希槽Slot<a class="anchor" href="#%e5%93%88%e5%b8%8c%e6%a7%bdslot">#</a></h3>
<p>Redis集群使用一种称作一致性哈希的复合分区形式（组合了哈希分区和列表分袂的特征来计算键的归属实例），键的<code>CRC16</code>哈希值被称为哈希槽。比如对于三个Redis节点，哈希槽的分配方式如下：</p>
<ul>
<li>第一节点拥有<code>0-5500</code>哈希槽</li>
<li>第二节点拥有<code>5501-11000</code>哈希槽</li>
<li>第三节点拥有剩余的<code>11001-16384</code>哈希槽</li>
</ul>
<p>通过计算键的 <code>CRC16</code> 哈希值，然后对16384进行取模得到：<code>HASH_SLOT=CRC16(key) modulo 16383</code>，Redis提供了<strong>CLUSTER KEYSLOT</strong>命令来执行哈希槽的计算。</p>
<p><strong>注意</strong>：集群节点保存键值对以及键值对过期时间的处理方式与Redis单机模式是一样的，唯一不同就是节点只能使用0号数据库，而单机Redis服务器则没有限制。</p>
<h3 id="集群内部通讯机制">集群内部通讯机制<a class="anchor" href="#%e9%9b%86%e7%be%a4%e5%86%85%e9%83%a8%e9%80%9a%e8%ae%af%e6%9c%ba%e5%88%b6">#</a></h3>
<p>各个数据库互相通信，保存各个库中槽的编号数据。</p>
<p>1)：客户端发出一个key访问A，通过算法计算出key的存储位置</p>
<p>2)：如果一次命中，直接返回</p>
<p>3)：一次未命中，告知具体位置</p>
<p>4)：一次命中或者两次命中提高数据访问效率</p>
<p><img src="/images/2021-09-03-17-12-36.png" alt="" /></p>
<h3 id="cluster集群搭建">Cluster集群搭建<a class="anchor" href="#cluster%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba">#</a></h3>
<p>1)：单虚机运行6个redis实例（三主三从），端口号为（79-84）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang local<span style="color:#f92672">]</span><span style="color:#75715e"># cd /usr/local/redis/bin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>conf  redis-benchmark  redis-check-aof  redis-check-rdb  redis-cli  redis-sentinel  redis-server
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># cd conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>redis80.conf  redis81.conf  redis.conf  sentinel.conf
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># cp redis.conf redis82.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># cp redis.conf redis83.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e"># cp redis.conf redis84.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang conf<span style="color:#f92672">]</span><span style="color:#75715e">#</span></span></span></code></pre></div><table>
  <thead>
      <tr>
          <th style="text-align: center">端口</th>
          <th style="text-align: center">配置文件</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">6379</td>
          <td style="text-align: center">redis.conf</td>
      </tr>
      <tr>
          <td style="text-align: center">6380</td>
          <td style="text-align: center">redis80.conf</td>
      </tr>
      <tr>
          <td style="text-align: center">6381</td>
          <td style="text-align: center">redis81.conf</td>
      </tr>
      <tr>
          <td style="text-align: center">6382</td>
          <td style="text-align: center">redis82.conf</td>
      </tr>
      <tr>
          <td style="text-align: center">6383</td>
          <td style="text-align: center">redis83.conf</td>
      </tr>
      <tr>
          <td style="text-align: center">6384</td>
          <td style="text-align: center">redis84.conf</td>
      </tr>
  </tbody>
</table>
<p>2)：修改配置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> daemonize yes <span style="color:#75715e"># 后台启动</span>
</span></span><span style="display:flex;"><span> protected-mode no ; <span style="color:#75715e"># 允许外部访问</span>
</span></span><span style="display:flex;"><span> port <span style="color:#ae81ff">6379</span> <span style="color:#75715e"># 修改端口号，从79~84</span>
</span></span><span style="display:flex;"><span> cluster-enabled yes <span style="color:#75715e"># 开启cluster，去掉注释</span>
</span></span><span style="display:flex;"><span> cluster-config-file nodes-6379.conf <span style="color:#75715e"># 自动生成</span>
</span></span><span style="display:flex;"><span> cluster-node-timeout <span style="color:#ae81ff">15000</span> <span style="color:#75715e"># 节点通信时间</span>
</span></span><span style="display:flex;"><span> logfile   /usr/local/redis/bin/6379.log
</span></span><span style="display:flex;"><span> dbfilename 6379dump.rdb  <span style="color:#75715e"># 做伪集群的时候，一定要修改rdb文件的名字，如果aof也开的话也需要修改，否则扩容的时候会出现提示说新增扩容节点存在数据，需要先删除数据的提示。</span></span></span></code></pre></div><p>3)：启动Redis</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-server conf/redis.conf </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-server conf/redis80.conf </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-server conf/redis81.conf </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-server conf/redis82.conf </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-server conf/redis83.conf </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-server conf/redis84.conf</span></span></span></code></pre></div><p>查看Redis进程信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ps -ef|grep redis</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">3538</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 13:37 ?        00:00:01 ./redis-server 0.0.0.0:6382 <span style="color:#f92672">[</span>cluster<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">3545</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 13:38 ?        00:00:01 ./redis-server 0.0.0.0:6383 <span style="color:#f92672">[</span>cluster<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">3551</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 13:38 ?        00:00:01 ./redis-server 0.0.0.0:6384 <span style="color:#f92672">[</span>cluster<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">3797</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 13:48 ?        00:00:00 ./redis-server 0.0.0.0:6380 <span style="color:#f92672">[</span>cluster<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">3803</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 13:48 ?        00:00:00 ./redis-server 0.0.0.0:6381 <span style="color:#f92672">[</span>cluster<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">3816</span>      <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">0</span> 13:49 ?        00:00:00 ./redis-server 0.0.0.0:6379 <span style="color:#f92672">[</span>cluster<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>root       <span style="color:#ae81ff">3826</span>   <span style="color:#ae81ff">3494</span>  <span style="color:#ae81ff">0</span> 13:49 pts/0    00:00:00 grep --color<span style="color:#f92672">=</span>auto redis</span></span></code></pre></div><p><strong>4)</strong>：创建集群</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>--cluster create  192.168.80.251:6379 192.168.80.251:6380 192.168.80.251:6381 192.168.80.251:6382 192.168.80.251:6383 192.168.80.251:6384  --cluster-replicas <span style="color:#ae81ff">1</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@wangpengliang bin<span style="color:#f92672">]</span><span style="color:#75715e"># ./redis-cli --cluster create  192.168.15.251:6379 192.168.15.251:6380 192.168.15.251:6381 192.168.15.251:6382 192.168.15.251:6383 192.168.15.251:6384  --cluster-replicas 1</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing hash slots allocation on <span style="color:#ae81ff">6</span> nodes...
</span></span><span style="display:flex;"><span>Master<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span> -&gt; Slots <span style="color:#ae81ff">0</span> - <span style="color:#ae81ff">5460</span>
</span></span><span style="display:flex;"><span>Master<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> -&gt; Slots <span style="color:#ae81ff">5461</span> - <span style="color:#ae81ff">10922</span>
</span></span><span style="display:flex;"><span>Master<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span> -&gt; Slots <span style="color:#ae81ff">10923</span> - <span style="color:#ae81ff">16383</span>
</span></span><span style="display:flex;"><span>Adding replica 192.168.15.251:6383 to 192.168.15.251:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.15.251:6384 to 192.168.15.251:6380
</span></span><span style="display:flex;"><span>Adding replica 192.168.15.251:6382 to 192.168.15.251:6381
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Trying to optimize slaves allocation <span style="color:#66d9ef">for</span> anti-affinity
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>WARNING<span style="color:#f92672">]</span> Some slaves are in the same host as their master
</span></span><span style="display:flex;"><span>M: 48f3cbacb014f1d0f89fe99bb494e1cabb1f80f4 192.168.15.251:6379
</span></span><span style="display:flex;"><span>   slots:<span style="color:#f92672">[</span>0-5460<span style="color:#f92672">]</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">5461</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: ee511eed5a7d08d39ceef29823b98e299435523e 192.168.15.251:6380
</span></span><span style="display:flex;"><span>   slots:<span style="color:#f92672">[</span>5461-10922<span style="color:#f92672">]</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">5462</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>M: e4c70b085d10d51a3201c6bf4bfa47adfa000f2e 192.168.15.251:6381
</span></span><span style="display:flex;"><span>   slots:<span style="color:#f92672">[</span>10923-16383<span style="color:#f92672">]</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">5461</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>S: 5261a1ccb42ac160a93572beae7344e6b0c7c520 192.168.15.251:6382
</span></span><span style="display:flex;"><span>   replicates 48f3cbacb014f1d0f89fe99bb494e1cabb1f80f4
</span></span><span style="display:flex;"><span>S: d420ca1e3ef8edd538286e1c7698783447312148 192.168.15.251:6383
</span></span><span style="display:flex;"><span>   replicates ee511eed5a7d08d39ceef29823b98e299435523e
</span></span><span style="display:flex;"><span>S: 235fb6093a7f1c92e7144109aee10d1e341d2fb9 192.168.15.251:6384
</span></span><span style="display:flex;"><span>   replicates e4c70b085d10d51a3201c6bf4bfa47adfa000f2e
</span></span><span style="display:flex;"><span>Can I set the above configuration? <span style="color:#f92672">(</span>type <span style="color:#e6db74">&#39;yes&#39;</span> to accept<span style="color:#f92672">)</span>: yes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Nodes configuration updated
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> the cluster to join
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check <span style="color:#f92672">(</span>using node 192.168.15.251:6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: 48f3cbacb014f1d0f89fe99bb494e1cabb1f80f4 192.168.15.251:6379
</span></span><span style="display:flex;"><span>   slots:<span style="color:#f92672">[</span>0-5460<span style="color:#f92672">]</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">5461</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: e4c70b085d10d51a3201c6bf4bfa47adfa000f2e 192.168.15.251:6381
</span></span><span style="display:flex;"><span>   slots:<span style="color:#f92672">[</span>10923-16383<span style="color:#f92672">]</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">5461</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>M: ee511eed5a7d08d39ceef29823b98e299435523e 192.168.15.251:6380
</span></span><span style="display:flex;"><span>   slots:<span style="color:#f92672">[</span>5461-10922<span style="color:#f92672">]</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">5462</span> slots<span style="color:#f92672">)</span> master
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> additional replica<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>S: 5261a1ccb42ac160a93572beae7344e6b0c7c520 192.168.15.251:6382
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates 48f3cbacb014f1d0f89fe99bb494e1cabb1f80f4
</span></span><span style="display:flex;"><span>S: 235fb6093a7f1c92e7144109aee10d1e341d2fb9 192.168.15.251:6384
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates e4c70b085d10d51a3201c6bf4bfa47adfa000f2e
</span></span><span style="display:flex;"><span>S: d420ca1e3ef8edd538286e1c7698783447312148 192.168.15.251:6383
</span></span><span style="display:flex;"><span>   slots: <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> slots<span style="color:#f92672">)</span> slave
</span></span><span style="display:flex;"><span>   replicates ee511eed5a7d08d39ceef29823b98e299435523e
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check <span style="color:#66d9ef">for</span> open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>OK<span style="color:#f92672">]</span> All <span style="color:#ae81ff">16384</span> slots covered.</span></span></code></pre></div><h1 id="redis-cluster集群命令">Redis-Cluster集群命令<a class="anchor" href="#redis-cluster%e9%9b%86%e7%be%a4%e5%91%bd%e4%bb%a4">#</a></h1>
<ul>
<li><code>cluster info</code> ：打印集群的信息</li>
<li><code>cluster nodes</code>：列出集群当前已知的所有节点（ node），以及这些节点的相关信息</li>
<li><code>cluster meet</code>   ：将 ip 和 port 所指定的节点添加到集群当中</li>
<li><code>cluster forget &lt;node_id&gt;</code> ：从集群中移除 node_id 指定的节点</li>
<li><code>cluster replicate &lt;master_node_id&gt;</code> ：将当前从节点设置为 node_id 指定的master节点的slave节点。只能针对slave节点操作</li>
<li><code>cluster saveconfig</code>：将节点的配置文件保存到硬盘里面</li>
<li><code>cluster addslots  [slot ...]</code> ：将一个或多个槽（ slot）指派（ assign）给当前节点</li>
<li><code>cluster delslots  [slot ...] </code>：移除一个或多个槽对当前节点的指派</li>
<li><code>cluster flushslots</code> ：移除指派给当前节点的所有槽，让当前节点变成一个没有指派任何槽的节点</li>
<li><code>cluster setslot  node &lt;node_id&gt;</code> ：将槽 slot 指派给 node_id 指定的节点</li>
<li><code>cluster setslot  migrating &lt;node_id&gt;</code> ：将本节点的槽 slot 迁移到 node_id 指定的节点中</li>
<li><code>cluster setslot  importing &lt;node_id&gt;</code> ：从 node_id 指定的节点中导入槽 slot 到本节点</li>
<li><code>cluster setslot  stable</code> ：取消对槽 slot 的导入（ import）或者迁移（ migrate）</li>
<li><code>cluster keyslot</code>  ：计算键 key 应该被放置在哪个槽上</li>
<li><code>cluster countkeysinslot</code> ：返回槽 slot 目前包含的键值对数量</li>
<li><code>cluster getkeysinslot</code>   ：返回 count 个 slot 槽中的键</li>
</ul>
<h1 id="查看redis数据库信息">查看Redis数据库信息<a class="anchor" href="#%e6%9f%a5%e7%9c%8bredis%e6%95%b0%e6%8d%ae%e5%ba%93%e4%bf%a1%e6%81%af">#</a></h1>
<p><code>info replication</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replication</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 角色</span>
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 连接的从机数量</span>
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:28d568fba5f2ed0f9034a4f63acc4960287099af
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:0
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:0
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:0
</span></span><span style="display:flex;"><span>repl_backlog_histlen:0</span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/1.8redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" class="flex align-center">
        <img src="/wangpengliang815/wangpengliang815.github.io/icons/backward.svg" class="book-icon" alt="Backward" />
        <span>1.8 Redis发布订阅</span>
      </a>
    
    </span>
    <span>
    
      <a href="/wangpengliang815/wangpengliang815.github.io/docs/redis/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/" class="flex align-center">
        <span>使用 Docker搭建 Redis集群</span>
        <img src="/wangpengliang815/wangpengliang815.github.io/icons/forward.svg" class="book-icon" alt="Forward" />
      </a>
    
    </span>
  </div>
  


 
        
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#主从复制">主从复制</a>
      <ul>
        <li><a href="#实现原理">实现原理</a></li>
        <li><a href="#主从复制优缺点"><strong>主从复制优缺点</strong></a></li>
        <li><a href="#主从复制搭建">主从复制搭建</a></li>
      </ul>
    </li>
    <li><a href="#sentinel哨兵模式">Sentinel（哨兵）模式</a>
      <ul>
        <li><a href="#哨兵作用">哨兵作用</a></li>
        <li><a href="#故障切换failover过程">故障切换（failover）过程</a></li>
        <li><a href="#哨兵工作方式">哨兵工作方式</a></li>
        <li><a href="#哨兵模式优缺点">哨兵模式优缺点</a></li>
        <li><a href="#哨兵模式搭建">哨兵模式搭建</a></li>
      </ul>
    </li>
    <li><a href="#cluster-集群模式">Cluster 集群模式</a>
      <ul>
        <li><a href="#cluster特点">Cluster特点</a></li>
        <li><a href="#cluster集群模式对比">Cluster集群模式对比</a></li>
        <li><a href="#数据存储设计"><strong>数据存储设计</strong></a></li>
        <li><a href="#哈希槽slot">哈希槽Slot</a></li>
        <li><a href="#集群内部通讯机制">集群内部通讯机制</a></li>
        <li><a href="#cluster集群搭建">Cluster集群搭建</a></li>
      </ul>
    </li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















