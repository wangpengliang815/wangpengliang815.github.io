<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="通过 ssh 连接目标服务器# 插件安装# Manage Jenkins =&gt; Manage Plugins
下载 Publish over SSH 插件
下载后的本地路径：$JENKINS_HOME/plugins/
全局配置# 系统管理 =&gt; 系统设置 =&gt; 拉到底部找到 Publish over SSH
Passphrase 和 Key 二选一即可
Passphrase 密码方式登录服务器
Key 免密方式登录服务器。具体步骤：（将 Jenkins 所在主机的 public_key 添加到目标服务器的 ~/.ssh/authorized_keys 即可）：
cat id_rsa.pub &gt;&gt; authorized_keys # 生成authorized_keys scp authorized_keys root@10.80.188.130:/root/.ssh # 将authorized_keys拷贝到目标服务器 root/.ssh Remote Directory： 填写当前用户有权限操作并且必须是已经存在的路径
SSH 服务器默认端口号是22，点击高级即可自定义端口号
配置完成后，点击 Test Configuration 返回 Success 证明 Jenkins 所在宿主机可以正常连接到目标服务器。
视图权限管理# 目标：jenkins 配置不同用户显示不同视图。
添加用户# Manage Jenkins =&gt; Manage Users =&gt; 新建用户
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/posts/devops/jenkins%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/">
  <meta property="og:site_name" content="CODE&#39;NOTE">
  <meta property="og:title" content="CODE&#39;NOTE">
  <meta property="og:description" content="通过 ssh 连接目标服务器# 插件安装# Manage Jenkins =&gt; Manage Plugins
下载 Publish over SSH 插件
下载后的本地路径：$JENKINS_HOME/plugins/
全局配置# 系统管理 =&gt; 系统设置 =&gt; 拉到底部找到 Publish over SSH
Passphrase 和 Key 二选一即可
Passphrase 密码方式登录服务器
Key 免密方式登录服务器。具体步骤：（将 Jenkins 所在主机的 public_key 添加到目标服务器的 ~/.ssh/authorized_keys 即可）：
cat id_rsa.pub &gt;&gt; authorized_keys # 生成authorized_keys scp authorized_keys root@10.80.188.130:/root/.ssh # 将authorized_keys拷贝到目标服务器 root/.ssh Remote Directory： 填写当前用户有权限操作并且必须是已经存在的路径
SSH 服务器默认端口号是22，点击高级即可自定义端口号
配置完成后，点击 Test Configuration 返回 Success 证明 Jenkins 所在宿主机可以正常连接到目标服务器。
视图权限管理# 目标：jenkins 配置不同用户显示不同视图。
添加用户# Manage Jenkins =&gt; Manage Users =&gt; 新建用户">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">


  <meta itemprop="name" content="CODE&#39;NOTE">
  <meta itemprop="description" content="通过 ssh 连接目标服务器# 插件安装# Manage Jenkins =&gt; Manage Plugins
下载 Publish over SSH 插件
下载后的本地路径：$JENKINS_HOME/plugins/
全局配置# 系统管理 =&gt; 系统设置 =&gt; 拉到底部找到 Publish over SSH
Passphrase 和 Key 二选一即可
Passphrase 密码方式登录服务器
Key 免密方式登录服务器。具体步骤：（将 Jenkins 所在主机的 public_key 添加到目标服务器的 ~/.ssh/authorized_keys 即可）：
cat id_rsa.pub &gt;&gt; authorized_keys # 生成authorized_keys scp authorized_keys root@10.80.188.130:/root/.ssh # 将authorized_keys拷贝到目标服务器 root/.ssh Remote Directory： 填写当前用户有权限操作并且必须是已经存在的路径
SSH 服务器默认端口号是22，点击高级即可自定义端口号
配置完成后，点击 Test Configuration 返回 Success 证明 Jenkins 所在宿主机可以正常连接到目标服务器。
视图权限管理# 目标：jenkins 配置不同用户显示不同视图。
添加用户# Manage Jenkins =&gt; Manage Users =&gt; 新建用户">
  <meta itemprop="wordCount" content="246">

<title>Jenkins常见操作 | CODE&#39;NOTE</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/posts/devops/jenkins%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/">
<link rel="stylesheet" href="/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.3ed9c79c605914c45e19db90edfda0ca8d87c63064c1d6252862250c4e917346.js" integrity="sha256-PtnHnGBZFMReGduQ7f2gyo2HxjBkwdYlKGIlDE6Rc0Y=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-posts">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>CODE&#39;NOTE</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>
























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Jenkins常见操作</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#插件安装">插件安装</a></li>
    <li><a href="#全局配置">全局配置</a></li>
  </ul>

  <ul>
    <li><a href="#添加用户">添加用户</a></li>
    <li><a href="#插件安装-1">插件安装</a></li>
    <li><a href="#权限配置">权限配置</a>
      <ul>
        <li><a href="#manage-roles">Manage Roles</a></li>
        <li><a href="#assign-roles">Assign Roles</a></li>
      </ul>
    </li>
    <li><a href="#添加视图">添加视图</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    Jenkins常见操作
  </h1>
  


  

  


  <div class="book-post-content markdown-inner"><h1 id="通过-ssh-连接目标服务器">通过 ssh 连接目标服务器<a class="anchor" href="#%e9%80%9a%e8%bf%87-ssh-%e8%bf%9e%e6%8e%a5%e7%9b%ae%e6%a0%87%e6%9c%8d%e5%8a%a1%e5%99%a8">#</a></h1>
<h2 id="插件安装">插件安装<a class="anchor" href="#%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85">#</a></h2>
<ol>
<li>
<p>Manage Jenkins =&gt; Manage Plugins</p>
</li>
<li>
<p>下载  <code>Publish over SSH</code> 插件</p>
</li>
</ol>
<p>下载后的本地路径：<code>$JENKINS_HOME/plugins/</code></p>
<h2 id="全局配置">全局配置<a class="anchor" href="#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae">#</a></h2>
<ol>
<li>
<p>系统管理 =&gt; 系统设置 =&gt; 拉到底部找到 Publish over SSH</p>
</li>
<li>
<p>Passphrase  和 Key 二选一即可</p>
</li>
</ol>
<ul>
<li>
<p><code>Passphrase</code> 密码方式登录服务器</p>
</li>
<li>
<p><code>Key</code> 免密方式登录服务器。具体步骤：（将 Jenkins 所在主机的 <code>public_key</code> 添加到目标服务器的 <code>~/.ssh/authorized_keys</code> 即可）：</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  cat id_rsa.pub &gt;&gt; authorized_keys <span style="color:#75715e"># 生成authorized_keys</span>
</span></span><span style="display:flex;"><span>  scp authorized_keys root@10.80.188.130:/root/.ssh <span style="color:#75715e"># 将authorized_keys拷贝到目标服务器 root/.ssh</span></span></span></code></pre></div><ul>
<li>
<p>Remote Directory： 填写当前用户有权限操作并且必须是已经存在的路径</p>
</li>
<li>
<p>SSH 服务器默认端口号是22，点击高级即可自定义端口号</p>
</li>
</ul>
<p>配置完成后，点击 <code>Test Configuration</code> 返回 <code>Success</code> 证明 Jenkins 所在宿主机可以正常连接到目标服务器。</p>
<h1 id="视图权限管理">视图权限管理<a class="anchor" href="#%e8%a7%86%e5%9b%be%e6%9d%83%e9%99%90%e7%ae%a1%e7%90%86">#</a></h1>
<p>目标：jenkins 配置不同用户显示不同视图。</p>
<h2 id="添加用户">添加用户<a class="anchor" href="#%e6%b7%bb%e5%8a%a0%e7%94%a8%e6%88%b7">#</a></h2>
<p>Manage Jenkins =&gt; Manage Users =&gt; 新建用户</p>
<h2 id="插件安装-1">插件安装<a class="anchor" href="#%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85-1">#</a></h2>
<ol>
<li>
<p>Manage Jenkins =&gt; Manage Plugins</p>
</li>
<li>
<p>下载  <code>Role-based Authorization Strategy</code> 插件</p>
</li>
<li>
<p>Manage Jenkins =&gt; Configure Global Security =&gt; 授权策略 =&gt; 选择启用 Role-Based Strategy</p>
</li>
</ol>
<h2 id="权限配置">权限配置<a class="anchor" href="#%e6%9d%83%e9%99%90%e9%85%8d%e7%bd%ae">#</a></h2>
<p>Manage Jenkins =&gt; Manage And Assign Roles</p>
<ul>
<li>Manage Roles：编辑权限</li>
<li>Assign Roles：  把编辑好的权限分配给不同用户</li>
<li>Role Strategy Macros： 角色策略宏，没有用到</li>
</ul>
<p><img src="/images/2022-07-12-16-40-50.png" alt="" /></p>
<h3 id="manage-roles">Manage Roles<a class="anchor" href="#manage-roles">#</a></h3>
<p>编辑全局用户权限 <code>Global roles</code>：添加角色 <code>normal</code> 并分配相关权限</p>
<p><img src="/images/2022-07-12-16-42-36.png" alt="" /></p>
<p>编辑项目权限 <code>Item roles</code>：添加项目组，根据需要自己调整权限范围</p>
<p><img src="/images/2022-07-12-16-47-04.png" alt="" /></p>
<p>使用通配符配置之后，添加 Job 时按照设定的前缀作为名称，则可以实现按照设定权限显示给不同用户。</p>
<blockquote class='book-hint '>
<p><code>pattern</code> 为正则表达式，语法为 java 正则表达式语法</p>
</blockquote><p>比如：<code>group_dev</code> 组对应的项目以 <code>dev</code> 开头，用户创建 Job 时必须以 <code>dev</code> 开头，否则对应的授权用户无法看到此Job。</p>
<blockquote class='book-hint '>
<p>注意： 这里的模糊匹配时不能写成 <code>*</code> 要写成  <code>.*</code></p>
</blockquote><h3 id="assign-roles">Assign Roles<a class="anchor" href="#assign-roles">#</a></h3>
<p>Global roles：指定用户有哪个用户组权限</p>
<p><img src="/images/2022-07-12-16-54-08.png" alt="" /></p>
<p>Item roles ：指定用户有哪个项目组权限</p>
<p><img src="/images/2022-07-12-16-55-25.png" alt="" /></p>
<h2 id="添加视图">添加视图<a class="anchor" href="#%e6%b7%bb%e5%8a%a0%e8%a7%86%e5%9b%be">#</a></h2>
<p>管理账户中点击标签栏“+”号添加新视图。需要注意：视图名大小写要与通配符一致，根据之前添加项目角色时通配符配置的前缀创建视图。一定要选择列表视图。</p>
<p><img src="/images/2022-07-12-16-57-09.png" alt="" /></p>
<h1 id="视图复制">视图复制<a class="anchor" href="#%e8%a7%86%e5%9b%be%e5%a4%8d%e5%88%b6">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> hudson.model.*
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//源view</span>
</span></span><span style="display:flex;"><span>        def str_view <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CeriOS.Core.DataDir&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//目标view</span>
</span></span><span style="display:flex;"><span>        def str_new_view <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CeriOS.Core.Gateway&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//源job名称(模糊匹配)</span>
</span></span><span style="display:flex;"><span>        def str_search <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CeriOS.Core.Datadir&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//目标job名称(模糊匹配后替换)</span>
</span></span><span style="display:flex;"><span>        def str_replace <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CeriOS.Core.Gateway&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        def view <span style="color:#f92672">=</span> Hudson.<span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">getView</span>(str_view)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//copy all projects of a view</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>(item in view.<span style="color:#a6e22e">getItems</span>())
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//create the new project name</span>
</span></span><span style="display:flex;"><span>          newName <span style="color:#f92672">=</span> item.<span style="color:#a6e22e">getName</span>().<span style="color:#a6e22e">replace</span>(str_search, str_replace)
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// copy the job, disable and save it</span>
</span></span><span style="display:flex;"><span>          def job
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//因为第一次导入后报错，所以添加了try-catch 跳过已存在的job</span>
</span></span><span style="display:flex;"><span>                job <span style="color:#f92672">=</span> Hudson.<span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">copy</span>(item, newName)
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">catch</span>(IllegalArgumentException e) {
</span></span><span style="display:flex;"><span>             println(e.<span style="color:#a6e22e">toString</span>())
</span></span><span style="display:flex;"><span>             println(<span style="color:#e6db74">&#34;$newName job is exists&#34;</span>)
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">catch</span>(Exception e) {
</span></span><span style="display:flex;"><span>            println(e.<span style="color:#a6e22e">toString</span>())
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//是否禁用任务，false不禁用，true禁用</span>
</span></span><span style="display:flex;"><span>          job.<span style="color:#a6e22e">disabled</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>          job.<span style="color:#a6e22e">save</span>() 
</span></span><span style="display:flex;"><span>          Hudson.<span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">getView</span>(str_new_view).<span style="color:#a6e22e">add</span>(job)
</span></span><span style="display:flex;"><span>          println(<span style="color:#e6db74">&#34; $item.name copied as $newName&#34;</span>)
</span></span><span style="display:flex;"><span>        }</span></span></code></pre></div></div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">
  <div>
  
    <a href="/posts/devops/jenkins%E5%AE%89%E8%A3%85/" class="flex align-center">
      <img src="/icons/backward.svg" class="book-icon" alt="Backward" />
      <span>Jenkins安装</span>
    </a>
  
  </div>
  <div>
  
    <a href="/posts/devops/nugetserver%E6%90%AD%E5%BB%BA/" class="flex align-center">
      <span>Nuget Server搭建</span>
      <img src="/icons/forward.svg" class="book-icon" alt="Forward" />
    </a>
  
  </div>
</div>
 
        
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#插件安装">插件安装</a></li>
    <li><a href="#全局配置">全局配置</a></li>
  </ul>

  <ul>
    <li><a href="#添加用户">添加用户</a></li>
    <li><a href="#插件安装-1">插件安装</a></li>
    <li><a href="#权限配置">权限配置</a>
      <ul>
        <li><a href="#manage-roles">Manage Roles</a></li>
        <li><a href="#assign-roles">Assign Roles</a></li>
      </ul>
    </li>
    <li><a href="#添加视图">添加视图</a></li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















