<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="自定义类型# Go语言中有一些基本的数据类型，如string、整型、浮点型、布尔等数据类型， 使用type关键字来定义自定义类型。
自定义类型是定义了一个全新的类型。可以基于内置的基本类型定义，也可以通过 struct 定义。例如：
// 将MyInt定义为int类型 type MyInt int通过 type 关键字的定义，MyInt 就是一种新的类型，具有 int 的特性。
类型别名# 类型别名是Go1.9版本添加的新功能。类型别名规定：TypeAlias 只是Type的别名，本质上TypeAlias与Type是同一个类型。
type TypeAlias = Type之前见过的rune和byte就是类型别名，定义如下：
type byte = uint8 type rune = int32自定义类型/类型别名区别# 类型别名与类型定义表面上看只有一个等号的差异，通过下面的这段代码来理解它们之间的区别：
// 类型定义 type NewInt int // 类型别名 type MyInt = int func main() { var a NewInt var b MyInt fmt.Printf(&#34;type of a:%T\n&#34;, a) // type of a:main.NewInt fmt.Printf(&#34;type of b:%T\n&#34;, b) // type of b:int }结果显示a的类型是 main.NewInt，表示main包下定义的NewInt类型。b的类型是int。MyInt类型只会在代码中存在，编译完成时并不会有MyInt类型。
结构定义# Go语言的结构体（struct）和其他语言的类（class）有同等的地位，但Go语言放弃了大量面向对象特性，只保留了组合（composition）这个最基础的特性。Go语言中可以通过 struct 来实现面向对象。
使用 type 和 struct 关键字来定义结构体，具体代码格式如下：
type 类型名 struct { 字段名 字段类型 字段名 字段类型 … }其中：
类型名：标识自定义结构体的名称。在同一个包内不能重复 字段名：表示结构体字段名。结构体中的字段名必须唯一 字段类型：表示结构体字段的具体类型 比如：定义一个表示矩形的结构
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/posts/go/11%E7%BB%93%E6%9E%84%E4%BD%93/">
  <meta property="og:site_name" content="CODE&#39;NOTE">
  <meta property="og:title" content="CODE&#39;NOTE">
  <meta property="og:description" content="自定义类型# Go语言中有一些基本的数据类型，如string、整型、浮点型、布尔等数据类型， 使用type关键字来定义自定义类型。
自定义类型是定义了一个全新的类型。可以基于内置的基本类型定义，也可以通过 struct 定义。例如：
// 将MyInt定义为int类型 type MyInt int通过 type 关键字的定义，MyInt 就是一种新的类型，具有 int 的特性。
类型别名# 类型别名是Go1.9版本添加的新功能。类型别名规定：TypeAlias 只是Type的别名，本质上TypeAlias与Type是同一个类型。
type TypeAlias = Type之前见过的rune和byte就是类型别名，定义如下：
type byte = uint8 type rune = int32自定义类型/类型别名区别# 类型别名与类型定义表面上看只有一个等号的差异，通过下面的这段代码来理解它们之间的区别：
// 类型定义 type NewInt int // 类型别名 type MyInt = int func main() { var a NewInt var b MyInt fmt.Printf(&#34;type of a:%T\n&#34;, a) // type of a:main.NewInt fmt.Printf(&#34;type of b:%T\n&#34;, b) // type of b:int }结果显示a的类型是 main.NewInt，表示main包下定义的NewInt类型。b的类型是int。MyInt类型只会在代码中存在，编译完成时并不会有MyInt类型。
结构定义# Go语言的结构体（struct）和其他语言的类（class）有同等的地位，但Go语言放弃了大量面向对象特性，只保留了组合（composition）这个最基础的特性。Go语言中可以通过 struct 来实现面向对象。
使用 type 和 struct 关键字来定义结构体，具体代码格式如下：
type 类型名 struct { 字段名 字段类型 字段名 字段类型 … }其中：
类型名：标识自定义结构体的名称。在同一个包内不能重复 字段名：表示结构体字段名。结构体中的字段名必须唯一 字段类型：表示结构体字段的具体类型 比如：定义一个表示矩形的结构">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">


  <meta itemprop="name" content="CODE&#39;NOTE">
  <meta itemprop="description" content="自定义类型# Go语言中有一些基本的数据类型，如string、整型、浮点型、布尔等数据类型， 使用type关键字来定义自定义类型。
自定义类型是定义了一个全新的类型。可以基于内置的基本类型定义，也可以通过 struct 定义。例如：
// 将MyInt定义为int类型 type MyInt int通过 type 关键字的定义，MyInt 就是一种新的类型，具有 int 的特性。
类型别名# 类型别名是Go1.9版本添加的新功能。类型别名规定：TypeAlias 只是Type的别名，本质上TypeAlias与Type是同一个类型。
type TypeAlias = Type之前见过的rune和byte就是类型别名，定义如下：
type byte = uint8 type rune = int32自定义类型/类型别名区别# 类型别名与类型定义表面上看只有一个等号的差异，通过下面的这段代码来理解它们之间的区别：
// 类型定义 type NewInt int // 类型别名 type MyInt = int func main() { var a NewInt var b MyInt fmt.Printf(&#34;type of a:%T\n&#34;, a) // type of a:main.NewInt fmt.Printf(&#34;type of b:%T\n&#34;, b) // type of b:int }结果显示a的类型是 main.NewInt，表示main包下定义的NewInt类型。b的类型是int。MyInt类型只会在代码中存在，编译完成时并不会有MyInt类型。
结构定义# Go语言的结构体（struct）和其他语言的类（class）有同等的地位，但Go语言放弃了大量面向对象特性，只保留了组合（composition）这个最基础的特性。Go语言中可以通过 struct 来实现面向对象。
使用 type 和 struct 关键字来定义结构体，具体代码格式如下：
type 类型名 struct { 字段名 字段类型 字段名 字段类型 … }其中：
类型名：标识自定义结构体的名称。在同一个包内不能重复 字段名：表示结构体字段名。结构体中的字段名必须唯一 字段类型：表示结构体字段的具体类型 比如：定义一个表示矩形的结构">
  <meta itemprop="wordCount" content="1259">

<title>11结构体 | CODE&#39;NOTE</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/posts/go/11%E7%BB%93%E6%9E%84%E4%BD%93/">
<link rel="stylesheet" href="/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.3ed9c79c605914c45e19db90edfda0ca8d87c63064c1d6252862250c4e917346.js" integrity="sha256-PtnHnGBZFMReGduQ7f2gyo2HxjBkwdYlKGIlDE6Rc0Y=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-posts">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>CODE&#39;NOTE</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>
























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>11结构体</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#值类型的接收者">值类型的接收者</a></li>
    <li><a href="#指针类型的接收者">指针类型的接收者</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    11结构体
  </h1>
  


  

  


  <div class="book-post-content markdown-inner"><h1 id="自定义类型">自定义类型<a class="anchor" href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e7%b1%bb%e5%9e%8b">#</a></h1>
<p>Go语言中有一些基本的数据类型，如<code>string</code>、<code>整型</code>、<code>浮点型</code>、<code>布尔</code>等数据类型， 使用<code>type</code>关键字来定义自定义类型。</p>
<p>自定义类型是定义了一个全新的类型。可以基于内置的基本类型定义，也可以通过 <code>struct</code> 定义。例如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 将MyInt定义为int类型</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MyInt</span> <span style="color:#66d9ef">int</span></span></span></code></pre></div><p>通过 <code>type</code> 关键字的定义，<code>MyInt</code> 就是一种新的类型，具有 <code>int</code> 的特性。</p>
<h1 id="类型别名">类型别名<a class="anchor" href="#%e7%b1%bb%e5%9e%8b%e5%88%ab%e5%90%8d">#</a></h1>
<p>类型别名是<code>Go1.9</code>版本添加的新功能。类型别名规定：<code>TypeAlias</code> 只是Type的别名，本质上TypeAlias与Type是同一个类型。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TypeAlias</span> = <span style="color:#a6e22e">Type</span></span></span></code></pre></div><p>之前见过的<code>rune</code>和<code>byte</code>就是类型别名，定义如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">byte</span> = <span style="color:#66d9ef">uint8</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">rune</span> = <span style="color:#66d9ef">int32</span></span></span></code></pre></div><h1 id="自定义类型类型别名区别">自定义类型/类型别名区别<a class="anchor" href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e7%b1%bb%e5%9e%8b%e7%b1%bb%e5%9e%8b%e5%88%ab%e5%90%8d%e5%8c%ba%e5%88%ab">#</a></h1>
<p>类型别名与类型定义表面上看只有一个等号的差异，通过下面的这段代码来理解它们之间的区别：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 类型定义</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NewInt</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 类型别名</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MyInt</span> = <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">NewInt</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#a6e22e">MyInt</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type of a:%T\n&#34;</span>, <span style="color:#a6e22e">a</span>) <span style="color:#75715e">// type of a:main.NewInt</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type of b:%T\n&#34;</span>, <span style="color:#a6e22e">b</span>) <span style="color:#75715e">// type of b:int</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>结果显示a的类型是 <code>main.NewInt</code>，表示main包下定义的<code>NewInt</code>类型。b的类型是<code>int</code>。<code>MyInt</code>类型只会在代码中存在，编译完成时并不会有<code>MyInt</code>类型。</p>
<h1 id="结构定义">结构定义<a class="anchor" href="#%e7%bb%93%e6%9e%84%e5%ae%9a%e4%b9%89">#</a></h1>
<p>Go语言的结构体（struct）和其他语言的类（class）有同等的地位，但Go语言放弃了大量面向对象特性，只保留了组合（composition）这个最基础的特性。Go语言中可以通过 <code>struct</code> 来实现面向对象。</p>
<p>使用 <code>type</code> 和 <code>struct</code> 关键字来定义结构体，具体代码格式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">类型名</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">字段名</span> <span style="color:#a6e22e">字段类型</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">字段名</span> <span style="color:#a6e22e">字段类型</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">…</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>其中：</p>
<ul>
<li>类型名：标识自定义结构体的名称。在同一个包内不能重复</li>
<li>字段名：表示结构体字段名。结构体中的字段名必须唯一</li>
<li>字段类型：表示结构体字段的具体类型</li>
</ul>
<p>比如：定义一个表示矩形的结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Rect</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">width</span>  <span style="color:#66d9ef">float64</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">height</span> <span style="color:#66d9ef">float64</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>同样类型的字段也可以写在一行，看起来更简洁</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Rect</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">height</span> <span style="color:#66d9ef">float64</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>语言内置的基础数据类型是用来描述一个值的，而结构体是用来描述一组值的。本质上是一种聚合型的数据类型。</p>
<h1 id="结构实例化">结构实例化<a class="anchor" href="#%e7%bb%93%e6%9e%84%e5%ae%9e%e4%be%8b%e5%8c%96">#</a></h1>
<p><strong>最简单的实例化方式</strong>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rect</span> <span style="color:#a6e22e">Rect</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p %T \n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rect</span>, <span style="color:#a6e22e">rect</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">height</span> = <span style="color:#ae81ff">13.4</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">width</span> = <span style="color:#ae81ff">21.</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p %T \n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rect</span>, <span style="color:#a6e22e">rect</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">height</span>, <span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">width</span>)</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>0xc0000120a0 main.Rect 
</span></span><span style="display:flex;"><span>0xc0000120a0 main.Rect 
</span></span><span style="display:flex;"><span>13.4 <span style="color:#ae81ff">21</span></span></span></code></pre></div><p>因为结构是值类型，所以定义结构体类型变量就会分配内存，如果不给结构体中的字段赋值，默认就会是该类型的零值。而后可以通过<code>.</code>来访问结构体的字段</p>
<p><strong>创建指针类型结构</strong>：</p>
<p>通过使用 <code>new</code> 关键字对结构体进行实例化，得到的是结构体的内存地址。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rect</span> = new(<span style="color:#a6e22e">Rect</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Go语言中支持对结构体指针直接使用.来访问结构体的成员</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">height</span> = <span style="color:#ae81ff">13.4</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">width</span> = <span style="color:#ae81ff">21.4</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这里因为使用new()返回的已经是指针类型,所以打印输出时不需要加&amp;取址</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%T %p\n&#34;</span>, <span style="color:#a6e22e">rect</span>, <span style="color:#a6e22e">rect</span>)</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>*main.Rect 0xc0000aa070</span></span></code></pre></div><p><strong>使用结构体的地址实例化</strong>：</p>
<p>使用<code>&amp;</code>对结构体进行取地址操作相当于对该结构体类型进行了一次<code>new</code>实例化操作。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rect</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Rect</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">height</span> = <span style="color:#ae81ff">13.4</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">width</span> = <span style="color:#ae81ff">21.4</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%T %p\n&#34;</span>, <span style="color:#a6e22e">rect</span>, <span style="color:#a6e22e">rect</span>)</span></span></code></pre></div><h1 id="结构初始化">结构初始化<a class="anchor" href="#%e7%bb%93%e6%9e%84%e5%88%9d%e5%a7%8b%e5%8c%96">#</a></h1>
<p><strong>默认</strong>：没有初始化的结构体，其成员变量都是对应其类型的零值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rect</span> <span style="color:#a6e22e">Rect</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v \n&#34;</span>, <span style="color:#a6e22e">rect</span>)</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>main.Rect<span style="color:#f92672">{</span>width:0, height:0<span style="color:#f92672">}</span></span></span></code></pre></div><p><strong>使用键值对初始化</strong>：</p>
<p>使用键值对初始化时，键对应结构体的字段，值对应该字段的初始值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Rect</span>{<span style="color:#a6e22e">width</span>: <span style="color:#ae81ff">10.5</span>, <span style="color:#a6e22e">height</span>: <span style="color:#ae81ff">3.5</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v \n&#34;</span>, <span style="color:#a6e22e">rect</span>)</span></span></code></pre></div><p>也可以对结构体指针进行键值对初始化，比如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-django" data-lang="django"><span style="display:flex;"><span>	// 对结构体指针进行键值初始化
</span></span><span style="display:flex;"><span>	rect2 := &amp;Rect{width: 10.5, height: 3.5}
</span></span><span style="display:flex;"><span>	fmt.Printf(&#34;%#v \n&#34;, rect2)</span></span></code></pre></div><p>如果字段没有初始值,可以省略，那么被省略的值就是该字段的零值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#75715e">// 如果字段没有初始值,可以省略,那么被省略的值就是该字段的零值</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect3</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Rect</span>{<span style="color:#a6e22e">width</span>: <span style="color:#ae81ff">100.0</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v \n&#34;</span>, <span style="color:#a6e22e">rect3</span>)	</span></span></code></pre></div><p><strong>使用值的列表初始化</strong>：</p>
<p>初始化结构体的时候可以简写，也就是初始化的时候不写键，直接写值：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#a6e22e">rect</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Rect</span>{<span style="color:#ae81ff">10.5</span>, <span style="color:#ae81ff">3.5</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v \n&#34;</span>, <span style="color:#a6e22e">rect</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rect2</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Rect</span>{<span style="color:#ae81ff">10.5</span>, <span style="color:#ae81ff">3.5</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v \n&#34;</span>, <span style="color:#a6e22e">rect2</span>)</span></span></code></pre></div><p>使用这种格式初始化时，需要注意：</p>
<ol>
<li>必须初始化结构体的所有字段</li>
<li>初始值的填充顺序必须与字段在结构体中的声明顺序一致</li>
<li>该方式不能和键值初始化方式混用</li>
</ol>
<h1 id="匿名结构体">匿名结构体<a class="anchor" href="#%e5%8c%bf%e5%90%8d%e7%bb%93%e6%9e%84%e4%bd%93">#</a></h1>
<p>在定义一些临时数据结构等场景下可以使用匿名结构体。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#75715e">// 匿名结构体</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">user</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">age</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;wangpengliang&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">age</span> = <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v \n&#34;</span>, <span style="color:#a6e22e">user</span>)</span></span></code></pre></div><h1 id="空结构体">空结构体<a class="anchor" href="#%e7%a9%ba%e7%bb%93%e6%9e%84%e4%bd%93">#</a></h1>
<p>空结构体不占用内存空间。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">struct</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">a</span>)) <span style="color:#75715e">// 0</span></span></span></code></pre></div><h1 id="结构体内存布局">结构体内存布局<a class="anchor" href="#%e7%bb%93%e6%9e%84%e4%bd%93%e5%86%85%e5%ad%98%e5%b8%83%e5%b1%80">#</a></h1>
<p>结构体占用一块连续的内存。</p>
<p>TODO：<a href="https://segmentfault.com/a/1190000017527311?utm_campaign=studygolang.com&amp;utm_medium=studygolang.com&amp;utm_source=studygolang.com">在 Go 中恰到好处的内存对齐</a></p>
<h1 id="构造函数">构造函数<a class="anchor" href="#%e6%9e%84%e9%80%a0%e5%87%bd%e6%95%b0">#</a></h1>
<p>Go语言的结构体没有构造函数，可以自己实现。 因为<code>struct</code>是值类型，如果结构体比较复杂的话，值拷贝性能开销会比较大，所以构造函数返回的是结构体指针类型。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 如果不初始化,字段值为类型零值</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">age</span>     <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">address</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">hobby</span>   []<span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 第一种方式,使用指定值初始化结构体,返回指针类型</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewPerson</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">address</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">hobby</span> []<span style="color:#66d9ef">string</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">instance</span> <span style="color:#f92672">:=</span> new(<span style="color:#a6e22e">Person</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">name</span> = <span style="color:#a6e22e">name</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">address</span> = <span style="color:#a6e22e">address</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">age</span> = <span style="color:#a6e22e">age</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">instance</span>.<span style="color:#a6e22e">hobby</span> = <span style="color:#a6e22e">hobby</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">instance</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 第二种方式,使用&amp;初始化结构体,返回指针类型</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewPerson2</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">address</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">name</span>:    <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">address</span>: <span style="color:#a6e22e">address</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">age</span>:     <span style="color:#a6e22e">age</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>Go中不支持函数重载，但是可以通过两个名称不同的构造函数来模拟实现构造函数重载。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewPerson</span>(<span style="color:#e6db74">&#34;wangpengliang&#34;</span>, <span style="color:#e6db74">&#34;beijing&#34;</span>, <span style="color:#ae81ff">18</span>, []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;java&#34;</span>, <span style="color:#e6db74">&#34;go&#34;</span>})
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">a</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewPerson2</span>(<span style="color:#e6db74">&#34;wangpengliang&#34;</span>, <span style="color:#e6db74">&#34;beijing&#34;</span>, <span style="color:#ae81ff">18</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">b</span>)	</span></span></code></pre></div><h1 id="方法和接收者">方法和接收者<a class="anchor" href="#%e6%96%b9%e6%b3%95%e5%92%8c%e6%8e%a5%e6%94%b6%e8%80%85">#</a></h1>
<p>Go语言中的<code>方法（Method）</code>是一种作用于特定类型变量的函数。这种特定类型变量叫做<code>接收者（Receiver）</code>方法的定义格式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">接收者变量</span> <span style="color:#a6e22e">接收者类型</span>) <span style="color:#a6e22e">方法名</span>(<span style="color:#a6e22e">参数列表</span>) (<span style="color:#a6e22e">返回参数</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">函数体</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>其中：</p>
<ul>
<li>接收者变量：接收者中的参数变量名在命名时，官方建议使用接收者类型名称首字母的小写，而不是<code>self</code>、<code>this</code>之类的命名。例如，<code>Person</code>类型的接收者变量应该命名为 <code>p</code>，<code>Connector</code>类型的接收者变量应该命名为<code>c</code>等</li>
<li>接收者类型：接收者类型和参数类似，可以是指针类型和非指针类型</li>
<li>方法名、参数列表、返回参数：具体格式与函数定义相同</li>
</ul>
<p>简单理解：因为Go语言中没有Class的概念，所以不存在实例化一个类调用其中某个方法这种做法，Go语言中的方法其实就是给指定结构添加方法。比如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 给结构体Person定义方法,所谓方法在go中就是定义了接受者的函数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">say1</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;name: %s,age：%d  \n&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">addAge1</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span> = <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>方法与函数的区别在于：<strong>函数不属于任何类型，方法属于特定的类型</strong>。</p>
<h2 id="值类型的接收者">值类型的接收者<a class="anchor" href="#%e5%80%bc%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%8e%a5%e6%94%b6%e8%80%85">#</a></h2>
<p>当方法作用于值类型接收者时，Go语言会在代码运行时将接收者的值复制一份。在值类型接收者的方法中可以获取接收者的成员值，但修改操作只是针对副本，无法修改接收者变量本身。比如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 给结构体Person定义方法,所谓方法在go中就是定义了接受者的函数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">say1</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;name: %s,age：%d  \n&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">addAge1</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span> = <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p1</span> <span style="color:#a6e22e">Person</span> = <span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;zhansan&#34;</span>, <span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#34;beijing&#34;</span>, []<span style="color:#66d9ef">string</span>{}}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p1</span>.<span style="color:#a6e22e">addAge1</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p1</span>.<span style="color:#a6e22e">say1</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p2</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;lisi&#34;</span>, <span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#34;shanghai&#34;</span>, []<span style="color:#66d9ef">string</span>{}}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p2</span>.<span style="color:#a6e22e">addAge1</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p2</span>.<span style="color:#a6e22e">say1</span>()</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name: zhansan,age：16  
</span></span><span style="display:flex;"><span>name: lisi,age：16   </span></span></code></pre></div><h2 id="指针类型的接收者">指针类型的接收者<a class="anchor" href="#%e6%8c%87%e9%92%88%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%8e%a5%e6%94%b6%e8%80%85">#</a></h2>
<p>指针类型的接收者由一个结构体的指针组成，由于指针的特性，调用方法时修改接收者指针的任意成员变量，在方法结束后，修改都是有效的。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">say2</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;name: %s,age：%d  \n&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span>) <span style="color:#a6e22e">addAge2</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span> = <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p3</span> <span style="color:#a6e22e">Person</span> = <span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;zhansan&#34;</span>, <span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#34;beijing&#34;</span>, []<span style="color:#66d9ef">string</span>{}}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p3</span>.<span style="color:#a6e22e">addAge2</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p3</span>.<span style="color:#a6e22e">say2</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p4</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Person</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Person</span>{<span style="color:#e6db74">&#34;lisi&#34;</span>, <span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#34;beijing&#34;</span>, []<span style="color:#66d9ef">string</span>{}}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p4</span>.<span style="color:#a6e22e">addAge2</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">p4</span>.<span style="color:#a6e22e">say2</span>()</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name: zhansan,age：17  
</span></span><span style="display:flex;"><span>name: lisi,age：17  </span></span></code></pre></div><p><strong>什么时候使用指针类型接收?</strong></p>
<ol>
<li>需要修改接收者中的值</li>
<li>接收者是拷贝代价比较大的大对象</li>
<li>保证一致性，如果有某个方法使用了指针接收者，那么其他的方法也应该使用指针接收者。</li>
</ol>
<h1 id="任意类型添加方法">任意类型添加方法<a class="anchor" href="#%e4%bb%bb%e6%84%8f%e7%b1%bb%e5%9e%8b%e6%b7%bb%e5%8a%a0%e6%96%b9%e6%b3%95">#</a></h1>
<p>Go语言中，接收者的类型可以是任何类型，不仅仅是结构体，任何类型都可以拥有方法。比如：基于内置的<code>int</code>类型使用 type 关键字可以定义新的自定义类型，然后为自定义类型添加方法。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// MyInt 将int定义为自定义MyInt类型</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MyInt</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// SayHello 为MyInt添加一个SayHello的方法</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#a6e22e">MyInt</span>) <span style="color:#a6e22e">SayHello</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Hello, 我是一个int。&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">m1</span> <span style="color:#a6e22e">MyInt</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m1</span>.<span style="color:#a6e22e">SayHello</span>() <span style="color:#75715e">//Hello, 我是一个int。</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">m1</span> = <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v  %T\n&#34;</span>, <span style="color:#a6e22e">m1</span>, <span style="color:#a6e22e">m1</span>) <span style="color:#75715e">//100  main.MyInt</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><strong>注意事项：</strong> 非本地类型不能定义方法，不能给别的包的类型定义方法。</p>
<h1 id="结构体的匿名字段">结构体的匿名字段<a class="anchor" href="#%e7%bb%93%e6%9e%84%e4%bd%93%e7%9a%84%e5%8c%bf%e5%90%8d%e5%ad%97%e6%ae%b5">#</a></h1>
<p>结构体允许其成员字段在声明时没有字段名而只有类型，这种没有名字的字段就称为匿名字段。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 匿名字段的说法并不代表没有字段名，而是默认会采用类型名作为字段名，结构体要求字段名称必须唯一，因此一个结构体中同种类型的匿名字段只能有一个</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Book</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">float64</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">book</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Book</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;go语言编程&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#ae81ff">100.00</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v\n&#34;</span>, <span style="color:#a6e22e">book</span>)              <span style="color:#75715e">// main.Book{string:&#34;go语言编程&#34;, float64:100}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">book</span>.<span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">book</span>.<span style="color:#66d9ef">float64</span>) <span style="color:#75715e">//北京 go语言编程 100</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><strong>注意</strong>：这里匿名字段的说法并不代表没有字段名，而是默认会采用类型名作为字段名，结构体要求字段名称必须唯一，因此一个结构体中同种类型的匿名字段只能有一个。</p>
<h1 id="嵌套结构体">嵌套结构体<a class="anchor" href="#%e5%b5%8c%e5%a5%97%e7%bb%93%e6%9e%84%e4%bd%93">#</a></h1>
<p>一个结构体中可以嵌套包含另一个结构体或结构体指针，比如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 地址结构体</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Address</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Province</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">City</span>     <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 用户结构体</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Gender</span>  <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Address</span> <span style="color:#a6e22e">Address</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Name</span>:   <span style="color:#e6db74">&#34;wangpengliang&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Gender</span>: <span style="color:#e6db74">&#34;男&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Address</span>: <span style="color:#a6e22e">Address</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Province</span>: <span style="color:#e6db74">&#34;山西&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">City</span>:     <span style="color:#e6db74">&#34;长治&#34;</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;user=%#v\n&#34;</span>, <span style="color:#a6e22e">user</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>user<span style="color:#f92672">=</span>main.User<span style="color:#f92672">{</span>Name:<span style="color:#e6db74">&#34;wangpengliang&#34;</span>, Gender:<span style="color:#e6db74">&#34;男&#34;</span>, Address:main.Address<span style="color:#f92672">{</span>Province:<span style="color:#e6db74">&#34;山西&#34;</span>, City:<span style="color:#e6db74">&#34;长治&#34;</span><span style="color:#f92672">}}</span></span></span></code></pre></div><h1 id="嵌套匿名字段">嵌套匿名字段<a class="anchor" href="#%e5%b5%8c%e5%a5%97%e5%8c%bf%e5%90%8d%e5%ad%97%e6%ae%b5">#</a></h1>
<p>上面user结构体中嵌套的<code>Address</code>结构体也可以采用匿名字段的方式，匿名字段默认使用类型名作为字段名。比如：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 地址结构体</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Address</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">province</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">city</span>     <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 用户结构体</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">gender</span>  <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">address</span> <span style="color:#a6e22e">Address</span> <span style="color:#75715e">// 该字段为具名字段</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Address</span>         <span style="color:#75715e">// 嵌套的Address结构体也可以采用匿名字段的方式</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">name</span>:   <span style="color:#e6db74">&#34;wangpengliang&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">gender</span>: <span style="color:#e6db74">&#34;男&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">address</span>: <span style="color:#a6e22e">Address</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">province</span>: <span style="color:#e6db74">&#34;山西&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">city</span>:     <span style="color:#e6db74">&#34;长治&#34;</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Address</span>: <span style="color:#a6e22e">Address</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">province</span>: <span style="color:#e6db74">&#34;北京&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">city</span>:     <span style="color:#e6db74">&#34;北京&#34;</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;user=%#v\n&#34;</span>, <span style="color:#a6e22e">user</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>user<span style="color:#f92672">=</span>main.User<span style="color:#f92672">{</span>name:<span style="color:#e6db74">&#34;wangpengliang&#34;</span>, gender:<span style="color:#e6db74">&#34;男&#34;</span>, address:main.Address<span style="color:#f92672">{</span>province:<span style="color:#e6db74">&#34;山西&#34;</span>, city:<span style="color:#e6db74">&#34;长治&#34;</span><span style="color:#f92672">}</span>, Address:main.Address<span style="color:#f92672">{</span>province:<span style="color:#e6db74">&#34;北京&#34;</span>, city:<span style="color:#e6db74">&#34;北京&#34;</span><span style="color:#f92672">}}</span></span></span></code></pre></div><p>当访问结构体成员时会先在结构体中查找该字段，找不到再去嵌套的匿名字段中查找。</p>
<h1 id="嵌套结构体字段名冲突">嵌套结构体字段名冲突<a class="anchor" href="#%e5%b5%8c%e5%a5%97%e7%bb%93%e6%9e%84%e4%bd%93%e5%ad%97%e6%ae%b5%e5%90%8d%e5%86%b2%e7%aa%81">#</a></h1>
<p>嵌套结构体内部可能存在相同的字段名。这种情况下为了避免歧义需要通过指定具体的内嵌结构体字段名。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 地址结构体</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Address</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">province</span>   <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">city</span>       <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">createTime</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 邮箱结构体</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Email</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">account</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">createTime</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 用户结构体</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">gender</span>  <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">address</span> <span style="color:#a6e22e">Address</span> <span style="color:#75715e">// 该字段为具名字段</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Address</span>         <span style="color:#75715e">// 嵌套的Address结构体也可以采用匿名字段的方式</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Email</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 具名字段赋值</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">name</span>:   <span style="color:#e6db74">&#34;wangpengliang&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">gender</span>: <span style="color:#e6db74">&#34;男&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">address</span>: <span style="color:#a6e22e">Address</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">province</span>: <span style="color:#e6db74">&#34;山西&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">city</span>:     <span style="color:#e6db74">&#34;长治&#34;</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;user=%#v\n&#34;</span>, <span style="color:#a6e22e">user</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 匿名字段</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">name</span>:   <span style="color:#e6db74">&#34;wangpengliang&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">gender</span>: <span style="color:#e6db74">&#34;男&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Address</span>: <span style="color:#a6e22e">Address</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">province</span>: <span style="color:#e6db74">&#34;山西&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">city</span>:     <span style="color:#e6db74">&#34;长治&#34;</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;user1=%#v\n&#34;</span>, <span style="color:#a6e22e">user1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">user2</span> <span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user2</span>.<span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;wangpengliang&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user2</span>.<span style="color:#a6e22e">gender</span> = <span style="color:#e6db74">&#34;男&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// user2.createTime = &#34;2019&#34; //ambiguous selector user2.createTime</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user2</span>.<span style="color:#a6e22e">Address</span>.<span style="color:#a6e22e">createTime</span> = <span style="color:#e6db74">&#34;2000&#34;</span> <span style="color:#75715e">//指定Address结构体中的createTime</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">user2</span>.<span style="color:#a6e22e">Email</span>.<span style="color:#a6e22e">createTime</span> = <span style="color:#e6db74">&#34;2000&#34;</span>   <span style="color:#75715e">//指定Email结构体中的createTime</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>user<span style="color:#f92672">=</span>main.User<span style="color:#f92672">{</span>name:<span style="color:#e6db74">&#34;wangpengliang&#34;</span>, gender:<span style="color:#e6db74">&#34;男&#34;</span>, address:main.Address<span style="color:#f92672">{</span>province:<span style="color:#e6db74">&#34;山西&#34;</span>, city:<span style="color:#e6db74">&#34;长治&#34;</span>, createTime:<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">}</span>, Address:main.Address<span style="color:#f92672">{</span>province:<span style="color:#e6db74">&#34;&#34;</span>, city:<span style="color:#e6db74">&#34;&#34;</span>, createTime:<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">}</span>, Email:main.Email<span style="color:#f92672">{</span>account:<span style="color:#e6db74">&#34;&#34;</span>, createTime:<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>user<span style="color:#f92672">=</span>main.User<span style="color:#f92672">{</span>name:<span style="color:#e6db74">&#34;wangpengliang&#34;</span>, gender:<span style="color:#e6db74">&#34;男&#34;</span>, address:main.Address<span style="color:#f92672">{</span>province:<span style="color:#e6db74">&#34;&#34;</span>, city:<span style="color:#e6db74">&#34;&#34;</span>, createTime:<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">}</span>, Address:main.Address<span style="color:#f92672">{</span>province:<span style="color:#e6db74">&#34;山西&#34;</span>, city:<span style="color:#e6db74">&#34;长治&#34;</span>, createTime:<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">}</span>, Email:main.Email<span style="color:#f92672">{</span>account:<span style="color:#e6db74">&#34;&#34;</span>, createTime:<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">}}</span></span></span></code></pre></div><h1 id="结构体字段可见性">结构体字段可见性<a class="anchor" href="#%e7%bb%93%e6%9e%84%e4%bd%93%e5%ad%97%e6%ae%b5%e5%8f%af%e8%a7%81%e6%80%a7">#</a></h1>
<p>结构体中字段大写开头表示可公开访问，小写表示私有（仅在定义当前结构体的包中可访问）。</p>
<h1 id="结构体与json序列化">结构体与JSON序列化<a class="anchor" href="#%e7%bb%93%e6%9e%84%e4%bd%93%e4%b8%8ejson%e5%ba%8f%e5%88%97%e5%8c%96">#</a></h1>
<p><code>JSON(JavaScript Object Notation)</code>  是一种轻量级的数据交换格式。易于阅读和编写。同时也易于机器解析和生成。JSON键值对是用来保存JS对象的一种方式，键/值对组合中的键名写在前面并用双引号<code>&quot;&quot;</code>包裹，使用冒号<code>:</code>分隔，然后紧接着值；多个键值之间使用英文<code>,</code>分隔。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Student</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Student</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ID</span>     <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Gender</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>   <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Class</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Class</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Title</span>    <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Students</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">Student</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">jsonSerializeTest</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Class</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Title</span>:    <span style="color:#e6db74">&#34;101&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Students</span>: make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Student</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">200</span>),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">stu</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Student</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Name</span>:   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;stu%02d&#34;</span>, <span style="color:#a6e22e">i</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Gender</span>: <span style="color:#e6db74">&#34;男&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ID</span>:     <span style="color:#a6e22e">i</span>,
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Students</span> = append(<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Students</span>, <span style="color:#a6e22e">stu</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// JSON序列化：结构体--&gt;JSON格式的字符串</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;json marshal failed&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;json:%s\n&#34;</span>, <span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//JSON反序列化：JSON格式的字符串--&gt;结构体</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">str</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">`{&#34;Title&#34;:&#34;101&#34;,&#34;Students&#34;:[{&#34;ID&#34;:0,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu00&#34;},{&#34;ID&#34;:1,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu01&#34;},{&#34;ID&#34;:2,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu02&#34;},{&#34;ID&#34;:3,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu03&#34;},{&#34;ID&#34;:4,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu04&#34;},{&#34;ID&#34;:5,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu05&#34;},{&#34;ID&#34;:6,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu06&#34;},{&#34;ID&#34;:7,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu07&#34;},{&#34;ID&#34;:8,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu08&#34;},{&#34;ID&#34;:9,&#34;Gender&#34;:&#34;男&#34;,&#34;Name&#34;:&#34;stu09&#34;}]}`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c1</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Class</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>([]byte(<span style="color:#a6e22e">str</span>), <span style="color:#a6e22e">c1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;json unmarshal failed!&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%#v\n&#34;</span>, <span style="color:#a6e22e">c1</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h1 id="结构体标签tag">结构体标签（Tag）<a class="anchor" href="#%e7%bb%93%e6%9e%84%e4%bd%93%e6%a0%87%e7%ad%betag">#</a></h1>
<p><code>Tag</code>是结构体的元信息，可以在运行时通过反射读取出来。 <code>Tag</code>在结构体字段的后方定义，由一对<strong>反引号</strong>包裹起来，格式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#e6db74">`</span>key1:<span style="color:#e6db74">&#34;value1&#34;</span> key2:<span style="color:#e6db74">&#34;value2&#34;</span><span style="color:#e6db74">`</span></span></span></code></pre></div><p>结构体tag由一个或多个键值对组成。键与值使用冒号分隔，值用双引号括起来。同一个结构体字段可以设置多个键值对tag，不同的键值对之间使用空格分隔。</p>
<p><strong>注意事项：</strong> 为结构体编写<code>Tag</code>时，必须严格遵守键值对的规则。结构体标签的解析代码的容错能力很差，一旦格式写错，编译和运行时都不会提示任何错误，通过反射也无法正确取值。例如不要在key和value之间添加空格。</p>
<p>Go 中标签最常见的用途比如 <strong><a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Marshalling_%28computer_science%29">marshalling</a></strong>。看一下来自 JSON 包的函数 <strong><a href="https://link.zhihu.com/?target=https%3A//golang.org/pkg/encoding/json/%23Marshal">Marshal</a></strong> 如何使用它（<strong><a href="https://link.zhihu.com/?target=https%3A//play.golang.org/p/C1hAMXTKPM_S">源代码</a></strong>）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>import (
</span></span><span style="display:flex;"><span>    &#34;encoding/json&#34;
</span></span><span style="display:flex;"><span>    &#34;fmt&#34;
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>func main() {
</span></span><span style="display:flex;"><span>    type T struct {
</span></span><span style="display:flex;"><span>       F1 int `json:&#34;f_1&#34;`
</span></span><span style="display:flex;"><span>       F2 int `json:&#34;f_2,omitempty&#34;`
</span></span><span style="display:flex;"><span>       F3 int `json:&#34;f_3,omitempty&#34;`
</span></span><span style="display:flex;"><span>       F4 int `json:&#34;-&#34;`
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    t := T{1, 0, 2, 3}
</span></span><span style="display:flex;"><span>    b, err := JSON.Marshal(t)
</span></span><span style="display:flex;"><span>    if err != nil {
</span></span><span style="display:flex;"><span>        panic(err)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    fmt.Printf(&#34;%s\n&#34;, b) // {&#34;f_1&#34;:1,&#34;f_3&#34;:2}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>xml 包也利用了标签 - <a href="https://link.zhihu.com/?target=https%3A//golang.org/pkg/encoding/xml/%23MarshalIndent">https://golang.org/pkg/encoding/xml/#MarshalIndent</a>.</p>
<p><strong>ORM</strong></p>
<p>像 GORM 这样的对象关系映射工具，也广泛使用标签 - <strong><a href="https://link.zhihu.com/?target=https%3A//github.com/jinzhu/gorm/blob/58e34726dfc069b558038efbaa25555f182d1f7a/multi_primary_keys_test.go%23L10">例子</a></strong>.</p>
<p><strong>摘要数据（Digesting forms data）</strong></p>
<p><a href="https://link.zhihu.com/?target=https%3A//godoc.org/github.com/gorilla/schema">https://godoc.org/github.com/gorilla/schema</a></p>
<p><strong>其他（Other）</strong></p>
<p>标签的更多潜在用例，如配置管理，结构的默认值，验证，命令行参数描述等（<strong><a href="https://link.zhihu.com/?target=https%3A//github.com/golang/go/wiki/Well-known-struct-tags">众所周知的结构标记列表</a></strong>）。</p>
<h1 id="练习题一">练习题一<a class="anchor" href="#%e7%bb%83%e4%b9%a0%e9%a2%98%e4%b8%80">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">exercises01Test</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">make</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#f92672">*</span><span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">slice</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">make</span>[<span style="color:#a6e22e">index</span>] = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">make</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">k</span>, <span style="color:#e6db74">&#34;=&gt;&#34;</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>0 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>1 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>2 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>3 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">3</span></span></span></code></pre></div><p>思考：这里输出map的value为什么都是3?</p>
<p>调整代码：输出指针地址</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">slice</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p \n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">make</span>[<span style="color:#a6e22e">index</span>] = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>0xc000012088 
</span></span><span style="display:flex;"><span>0xc000012088 
</span></span><span style="display:flex;"><span>0xc000012088 
</span></span><span style="display:flex;"><span>0xc000012088 </span></span></code></pre></div><p>这里其实就可以看出来了，<code>&amp;stu</code> 指向了同一个内存地址，当遍历到最后一个元素时，将3写入了该地址。导致映射所有值都相同。<code>for range</code> 创建了每个元素的副本，而不是直接返回每个元素的引用，如果使用该值变量的地址作为指向每个元素的指针，就会导致错误，迭代时返回的变量是一个迭代过程中根据切片依次赋值的新变量，所以值的地址总是相同的，导致结果不如预期。</p>
<p>修改代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">exercises02Test</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">make</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#f92672">*</span><span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">slice</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// 循环中使用新的变量接收</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p \n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">item</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">make</span>[<span style="color:#a6e22e">index</span>] = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">item</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">make</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">k</span>, <span style="color:#e6db74">&#34;=&gt;&#34;</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><pre tabindex="0"><code>0xc000012088 
0xc0000120c0 
0xc0000120c8
0xc0000120d0
3 =&gt; 3
0 =&gt; 0
1 =&gt; 1
2 =&gt; 2</code></pre><p>这个问题很像C#学习委托时遇到的闭包问题。上面问题还可以使用传统的 <code>for</code> 循环处理：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">exercises03Test</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">make</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#f92672">*</span><span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; len(<span style="color:#a6e22e">slice</span>); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">make</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">slice</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">make</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">k</span>, <span style="color:#e6db74">&#34;=&gt;&#34;</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>0xc0000101e0 
</span></span><span style="display:flex;"><span>0xc0000101e8 
</span></span><span style="display:flex;"><span>0xc0000101f0 
</span></span><span style="display:flex;"><span>0xc0000101f8 
</span></span><span style="display:flex;"><span>0 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">0</span>       
</span></span><span style="display:flex;"><span>1 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">1</span>       
</span></span><span style="display:flex;"><span>2 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">2</span>       
</span></span><span style="display:flex;"><span>3 <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">3</span>  </span></span></code></pre></div><h1 id="练习题二">练习题二<a class="anchor" href="#%e7%bb%83%e4%b9%a0%e9%a2%98%e4%ba%8c">#</a></h1>
<p>因为 <code>slice</code> 和 <code>map</code> 这两种数据类型都包含了指向底层数据的指针，因此在需要复制它们时要特别注意。来看下面的例子：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Test</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span>   <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">age</span>    <span style="color:#66d9ef">int8</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">dreams</span> []<span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Test</span>) <span style="color:#a6e22e">setDreams</span>(<span style="color:#a6e22e">dreams</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">dreams</span> = <span style="color:#a6e22e">dreams</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">exercises02Test</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Test</span>{<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;wangpengliang&#34;</span>, <span style="color:#a6e22e">age</span>: <span style="color:#ae81ff">18</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;吃饭&#34;</span>, <span style="color:#e6db74">&#34;睡觉&#34;</span>, <span style="color:#e6db74">&#34;搞钱&#34;</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">setDreams</span>(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 真的想修改t.dreams吗？</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">1</span>] = <span style="color:#e6db74">&#34;不睡觉&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">dreams</span>) <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>吃饭 不睡觉 搞钱<span style="color:#f92672">]</span></span></span></code></pre></div><p>这里因为 <code>slice</code> 和 <code>map</code> 这两种数据类型都包含了指向底层数据的指针所以修改了 <code>slice</code> 导致结构体内容也被修改，正确做法应该是：方法中使用传入的slice的拷贝进行结构体赋值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Test</span>) <span style="color:#a6e22e">setDreams</span>(<span style="color:#a6e22e">dreams</span> []<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">dreams</span> = make([]<span style="color:#66d9ef">string</span>, len(<span style="color:#a6e22e">dreams</span>))
</span></span><span style="display:flex;"><span>	copy(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">dreams</span>, <span style="color:#a6e22e">dreams</span>)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Test</span>{<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;wangpengliang&#34;</span>, <span style="color:#a6e22e">age</span>: <span style="color:#ae81ff">18</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;吃饭&#34;</span>, <span style="color:#e6db74">&#34;睡觉&#34;</span>, <span style="color:#e6db74">&#34;搞钱&#34;</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">setDreams</span>(<span style="color:#a6e22e">data</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">data</span>[<span style="color:#ae81ff">1</span>] = <span style="color:#e6db74">&#34;不睡觉&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">dreams</span>) </span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>吃饭 睡觉 搞钱<span style="color:#f92672">]</span></span></span></code></pre></div></div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">
  <div>
  
    <a href="/posts/go/10%E5%8F%8D%E5%B0%84/" class="flex align-center">
      <img src="/icons/backward.svg" class="book-icon" alt="Backward" />
      <span>10反射</span>
    </a>
  
  </div>
  <div>
  
    <a href="/posts/go/12%E6%8E%A5%E5%8F%A3/" class="flex align-center">
      <span>12接口</span>
      <img src="/icons/forward.svg" class="book-icon" alt="Forward" />
    </a>
  
  </div>
</div>
 
        
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#值类型的接收者">值类型的接收者</a></li>
    <li><a href="#指针类型的接收者">指针类型的接收者</a></li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















