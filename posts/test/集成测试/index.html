<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="学习一下C#中集成测试
集成测试# 集成测试可在包含应用支持基础结构（如数据库、文件系统和网络）的级别上确保应用组件功能正常。
单元测试关注是的软件最小可执行单元是否能够正常执行，但软件是由一个个最小执行单元组成的集合体，单元与单元之间存在着种种依赖或联系，所以在开发时仅仅确保最小单元的正确往往不够，为了保证软件能够正确运行，单元与单元之间的集成测试是非常必要。
与单元测试相比，集成测试可在更广泛的级别上评估应用的组件。 单元测试用于测试独立软件组件，如单独的类方法。 集成测试确认两个或更多应用组件一起工作以生成预期结果，可能包括完整处理请求所需的每个组件。
TestServer# 使用 TestServer 测试API接口
protected TestServer CreateSingleTestServer() { if (testServer == null) { lock (singleton_Lock) { if (testServer == null) { string path = Assembly.GetAssembly(typeof(TestBase)).Location; IWebHostBuilder hostBuilder = new WebHostBuilder() .UseContentRoot(Path.GetDirectoryName(path)) .ConfigureAppConfiguration(cb =&gt; { cb.AddJsonFile(&#34;appsettings.test.json&#34;, true, true); }) .UseEnvironment(&#34;Development&#34;) .UseStartup&lt;TestStartup&gt;(); testServer = new TestServer(hostBuilder); } } } return testServer; } public class TestStartup : Startup { public TestStartup( IConfiguration configuration, IHostingEnvironment env) : base(configuration, env) { if debug string connectionString = Configuration.GetSection(&#34;Database:ConnectString&#34;).Value; testDbContext = new ApplicationDbContext(new DbContextOptionsBuilder&lt;ApplicationDbContext&gt;() .UseSqlServer(connectionString) .Options); endif } } } [TestClass] [TestCategory(&#34;integration&#34;)] public class ApiTest : TestBase { private HttpClient client; [TestInitialize] public void Init() { client = testServer.CreateClient(); } [TestCleanup] public void Cleanup() { client.Dispose(); } [TestMethod] public async Task GetAsync() { var response = await client.GetAsync($&#34;/api/values&#34;); Assert.AreEqual(HttpStatusCode.OK, response.StatusCode); } }参考：
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/posts/test/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/">
  <meta property="og:site_name" content="CODE&#39;NOTE">
  <meta property="og:title" content="CODE&#39;NOTE">
  <meta property="og:description" content="学习一下C#中集成测试
集成测试# 集成测试可在包含应用支持基础结构（如数据库、文件系统和网络）的级别上确保应用组件功能正常。
单元测试关注是的软件最小可执行单元是否能够正常执行，但软件是由一个个最小执行单元组成的集合体，单元与单元之间存在着种种依赖或联系，所以在开发时仅仅确保最小单元的正确往往不够，为了保证软件能够正确运行，单元与单元之间的集成测试是非常必要。
与单元测试相比，集成测试可在更广泛的级别上评估应用的组件。 单元测试用于测试独立软件组件，如单独的类方法。 集成测试确认两个或更多应用组件一起工作以生成预期结果，可能包括完整处理请求所需的每个组件。
TestServer# 使用 TestServer 测试API接口
protected TestServer CreateSingleTestServer() { if (testServer == null) { lock (singleton_Lock) { if (testServer == null) { string path = Assembly.GetAssembly(typeof(TestBase)).Location; IWebHostBuilder hostBuilder = new WebHostBuilder() .UseContentRoot(Path.GetDirectoryName(path)) .ConfigureAppConfiguration(cb =&gt; { cb.AddJsonFile(&#34;appsettings.test.json&#34;, true, true); }) .UseEnvironment(&#34;Development&#34;) .UseStartup&lt;TestStartup&gt;(); testServer = new TestServer(hostBuilder); } } } return testServer; } public class TestStartup : Startup { public TestStartup( IConfiguration configuration, IHostingEnvironment env) : base(configuration, env) { if debug string connectionString = Configuration.GetSection(&#34;Database:ConnectString&#34;).Value; testDbContext = new ApplicationDbContext(new DbContextOptionsBuilder&lt;ApplicationDbContext&gt;() .UseSqlServer(connectionString) .Options); endif } } } [TestClass] [TestCategory(&#34;integration&#34;)] public class ApiTest : TestBase { private HttpClient client; [TestInitialize] public void Init() { client = testServer.CreateClient(); } [TestCleanup] public void Cleanup() { client.Dispose(); } [TestMethod] public async Task GetAsync() { var response = await client.GetAsync($&#34;/api/values&#34;); Assert.AreEqual(HttpStatusCode.OK, response.StatusCode); } }参考：">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">


  <meta itemprop="name" content="CODE&#39;NOTE">
  <meta itemprop="description" content="学习一下C#中集成测试
集成测试# 集成测试可在包含应用支持基础结构（如数据库、文件系统和网络）的级别上确保应用组件功能正常。
单元测试关注是的软件最小可执行单元是否能够正常执行，但软件是由一个个最小执行单元组成的集合体，单元与单元之间存在着种种依赖或联系，所以在开发时仅仅确保最小单元的正确往往不够，为了保证软件能够正确运行，单元与单元之间的集成测试是非常必要。
与单元测试相比，集成测试可在更广泛的级别上评估应用的组件。 单元测试用于测试独立软件组件，如单独的类方法。 集成测试确认两个或更多应用组件一起工作以生成预期结果，可能包括完整处理请求所需的每个组件。
TestServer# 使用 TestServer 测试API接口
protected TestServer CreateSingleTestServer() { if (testServer == null) { lock (singleton_Lock) { if (testServer == null) { string path = Assembly.GetAssembly(typeof(TestBase)).Location; IWebHostBuilder hostBuilder = new WebHostBuilder() .UseContentRoot(Path.GetDirectoryName(path)) .ConfigureAppConfiguration(cb =&gt; { cb.AddJsonFile(&#34;appsettings.test.json&#34;, true, true); }) .UseEnvironment(&#34;Development&#34;) .UseStartup&lt;TestStartup&gt;(); testServer = new TestServer(hostBuilder); } } } return testServer; } public class TestStartup : Startup { public TestStartup( IConfiguration configuration, IHostingEnvironment env) : base(configuration, env) { if debug string connectionString = Configuration.GetSection(&#34;Database:ConnectString&#34;).Value; testDbContext = new ApplicationDbContext(new DbContextOptionsBuilder&lt;ApplicationDbContext&gt;() .UseSqlServer(connectionString) .Options); endif } } } [TestClass] [TestCategory(&#34;integration&#34;)] public class ApiTest : TestBase { private HttpClient client; [TestInitialize] public void Init() { client = testServer.CreateClient(); } [TestCleanup] public void Cleanup() { client.Dispose(); } [TestMethod] public async Task GetAsync() { var response = await client.GetAsync($&#34;/api/values&#34;); Assert.AreEqual(HttpStatusCode.OK, response.StatusCode); } }参考：">
  <meta itemprop="wordCount" content="136">

<title>集成测试 | CODE&#39;NOTE</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/posts/test/%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95/">
<link rel="stylesheet" href="/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.3ed9c79c605914c45e19db90edfda0ca8d87c63064c1d6252862250c4e917346.js" integrity="sha256-PtnHnGBZFMReGduQ7f2gyo2HxjBkwdYlKGIlDE6Rc0Y=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-posts">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>CODE&#39;NOTE</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>
























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>集成测试</h3>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    集成测试
  </h1>
  


  

  


  <div class="book-post-content markdown-inner"><p>学习一下C#中集成测试</p>
<!-- more -->
<h1 id="集成测试">集成测试<a class="anchor" href="#%e9%9b%86%e6%88%90%e6%b5%8b%e8%af%95">#</a></h1>
<p>集成测试可在包含应用支持基础结构（如数据库、文件系统和网络）的级别上确保应用组件功能正常。</p>
<p>单元测试关注是的软件最小可执行单元是否能够正常执行，但软件是由一个个最小执行单元组成的集合体，单元与单元之间存在着种种依赖或联系，所以在开发时仅仅确保最小单元的正确往往不够，为了保证软件能够正确运行，单元与单元之间的集成测试是非常必要。</p>
<p>与单元测试相比，集成测试可在更广泛的级别上评估应用的组件。 单元测试用于测试独立软件组件，如单独的类方法。 集成测试确认两个或更多应用组件一起工作以生成预期结果，可能包括完整处理请求所需的每个组件。</p>
<h1 id="testserver">TestServer<a class="anchor" href="#testserver">#</a></h1>
<p>使用 <code>TestServer</code> 测试API接口</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>       <span style="color:#66d9ef">protected</span> TestServer CreateSingleTestServer()
</span></span><span style="display:flex;"><span>       {
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">if</span> (testServer == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>           {
</span></span><span style="display:flex;"><span>               <span style="color:#66d9ef">lock</span> (singleton_Lock)
</span></span><span style="display:flex;"><span>               {
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">if</span> (testServer == <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                   {
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">string</span> path = Assembly.GetAssembly(<span style="color:#66d9ef">typeof</span>(TestBase)).Location;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                       IWebHostBuilder hostBuilder =
</span></span><span style="display:flex;"><span>                           <span style="color:#66d9ef">new</span> WebHostBuilder()
</span></span><span style="display:flex;"><span>                               .UseContentRoot(Path.GetDirectoryName(path))
</span></span><span style="display:flex;"><span>                               .ConfigureAppConfiguration(cb =&gt;
</span></span><span style="display:flex;"><span>                               {
</span></span><span style="display:flex;"><span>                                   cb.AddJsonFile(<span style="color:#e6db74">&#34;appsettings.test.json&#34;</span>, <span style="color:#66d9ef">true</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>                               })
</span></span><span style="display:flex;"><span>                               .UseEnvironment(<span style="color:#e6db74">&#34;Development&#34;</span>)
</span></span><span style="display:flex;"><span>                               .UseStartup&lt;TestStartup&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                       testServer = <span style="color:#66d9ef">new</span> TestServer(hostBuilder);
</span></span><span style="display:flex;"><span>                   }
</span></span><span style="display:flex;"><span>               }
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">return</span> testServer;
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestStartup</span> : Startup
</span></span><span style="display:flex;"><span>       {
</span></span><span style="display:flex;"><span>           <span style="color:#66d9ef">public</span> TestStartup(
</span></span><span style="display:flex;"><span>               IConfiguration configuration,
</span></span><span style="display:flex;"><span>               IHostingEnvironment env) : <span style="color:#66d9ef">base</span>(configuration, env)
</span></span><span style="display:flex;"><span>           {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> debug
</span></span><span style="display:flex;"><span>               <span style="color:#66d9ef">string</span> connectionString =
</span></span><span style="display:flex;"><span>                   Configuration.GetSection(<span style="color:#e6db74">&#34;Database:ConnectString&#34;</span>).Value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>               testDbContext =
</span></span><span style="display:flex;"><span>                   <span style="color:#66d9ef">new</span> ApplicationDbContext(<span style="color:#66d9ef">new</span> DbContextOptionsBuilder&lt;ApplicationDbContext&gt;()
</span></span><span style="display:flex;"><span>                       .UseSqlServer(connectionString)
</span></span><span style="display:flex;"><span>                       .Options);
</span></span><span style="display:flex;"><span>endif
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>   }</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#a6e22e">    [TestClass]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [TestCategory(&#34;integration&#34;)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiTest</span> : TestBase
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> HttpClient client;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [TestInitialize]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Init()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            client = testServer.CreateClient();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [TestCleanup]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Cleanup()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            client.Dispose();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">        [TestMethod]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task GetAsync()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> response =
</span></span><span style="display:flex;"><span>               <span style="color:#66d9ef">await</span> client.GetAsync(<span style="color:#e6db74">$&#34;/api/values&#34;</span>);
</span></span><span style="display:flex;"><span>            Assert.AreEqual(HttpStatusCode.OK, response.StatusCode);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div><p>参考：</p>
<ul>
<li><a href="https://www.cnblogs.com/selimsong/p/9263957.html">https://www.cnblogs.com/selimsong/p/9263957.html</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/testing/?pivots=mstest">https://docs.microsoft.com/zh-cn/dotnet/core/testing/?pivots=mstest</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/aspnet/core/test/integration-tests?view=aspnetcore-3.1#test-app-prerequisites">https://docs.microsoft.com/zh-cn/aspnet/core/test/integration-tests?view=aspnetcore-3.1#test-app-prerequisites</a></li>
<li><a href="https://www.cnblogs.com/selimsong/p/9306221.html">https://www.cnblogs.com/selimsong/p/9306221.html</a></li>
</ul>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">
  <div>
  
    <a href="/posts/test/%E8%87%AA%E5%8A%A8%E5%8C%96ui%E6%B5%8B%E8%AF%95/" class="flex align-center">
      <img src="/icons/backward.svg" class="book-icon" alt="Backward" />
      <span>自动化 Ui测试</span>
    </a>
  
  </div>
  <div>
  
  </div>
</div>
 
        
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
 
  </main>

  
</body>
</html>




















