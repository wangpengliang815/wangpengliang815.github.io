<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="环境准备# IP 操作系统 192.168.252.191 CentOS Linux release 7.9.2009 (Core) 192.168.252.192 CentOS Linux release 7.9.2009 (Core) 192.168.252.193 CentOS Linux release 7.9.2009 (Core) 192.168.252.194 CentOS Linux release 7.9.2009 (Core) 192.168.252.195 CentOS Linux release 7.9.2009 (Core) 192.168.252.196 CentOS Linux release 7.9.2009 (Core) 整体搭建步骤# 整体搭建步骤主要分为以下几步：
下载 Redis 镜像（可以省略，创建容器时如果本地镜像不存在就会去远程拉取） 更改 Redis 配置文件 创建并运行 Redis 容器 使用集群命令创建 Redis Cluster 集群 Step1：下载镜像# 省略
Step2：更改配置文件# 获取 redis.conf 修改默认配置
bind 127.0.0.1 ： 修改为 0.0.0.0 或指定IP（127.0.0.1 限制了 Redis 只能本地访问） protected-mode no： 改为yes ：开启保护模式限制为本地访问 daemonize no ：改为 yes：是否以守护进程方式启动可后台运行 dir ./ ：Redis 数据存放文件夹（可选） appendonly yes ：Redis 持久化（可选） cluster-enabled ：设置为集群节点 Step3：创建并启动容器# docker run -d --net host --name redis -v /usr/confs/redis.conf:/etc/redis/redis.conf -v /usr/redisdata:/data redis redis-server /etc/redis/redis.conf --appendonly yes命令解释：
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/posts/redis/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/">
  <meta property="og:site_name" content="CODE&#39;NOTE">
  <meta property="og:title" content="CODE&#39;NOTE">
  <meta property="og:description" content="环境准备# IP 操作系统 192.168.252.191 CentOS Linux release 7.9.2009 (Core) 192.168.252.192 CentOS Linux release 7.9.2009 (Core) 192.168.252.193 CentOS Linux release 7.9.2009 (Core) 192.168.252.194 CentOS Linux release 7.9.2009 (Core) 192.168.252.195 CentOS Linux release 7.9.2009 (Core) 192.168.252.196 CentOS Linux release 7.9.2009 (Core) 整体搭建步骤# 整体搭建步骤主要分为以下几步：
下载 Redis 镜像（可以省略，创建容器时如果本地镜像不存在就会去远程拉取） 更改 Redis 配置文件 创建并运行 Redis 容器 使用集群命令创建 Redis Cluster 集群 Step1：下载镜像# 省略
Step2：更改配置文件# 获取 redis.conf 修改默认配置
bind 127.0.0.1 ： 修改为 0.0.0.0 或指定IP（127.0.0.1 限制了 Redis 只能本地访问） protected-mode no： 改为yes ：开启保护模式限制为本地访问 daemonize no ：改为 yes：是否以守护进程方式启动可后台运行 dir ./ ：Redis 数据存放文件夹（可选） appendonly yes ：Redis 持久化（可选） cluster-enabled ：设置为集群节点 Step3：创建并启动容器# docker run -d --net host --name redis -v /usr/confs/redis.conf:/etc/redis/redis.conf -v /usr/redisdata:/data redis redis-server /etc/redis/redis.conf --appendonly yes命令解释：">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">


  <meta itemprop="name" content="CODE&#39;NOTE">
  <meta itemprop="description" content="环境准备# IP 操作系统 192.168.252.191 CentOS Linux release 7.9.2009 (Core) 192.168.252.192 CentOS Linux release 7.9.2009 (Core) 192.168.252.193 CentOS Linux release 7.9.2009 (Core) 192.168.252.194 CentOS Linux release 7.9.2009 (Core) 192.168.252.195 CentOS Linux release 7.9.2009 (Core) 192.168.252.196 CentOS Linux release 7.9.2009 (Core) 整体搭建步骤# 整体搭建步骤主要分为以下几步：
下载 Redis 镜像（可以省略，创建容器时如果本地镜像不存在就会去远程拉取） 更改 Redis 配置文件 创建并运行 Redis 容器 使用集群命令创建 Redis Cluster 集群 Step1：下载镜像# 省略
Step2：更改配置文件# 获取 redis.conf 修改默认配置
bind 127.0.0.1 ： 修改为 0.0.0.0 或指定IP（127.0.0.1 限制了 Redis 只能本地访问） protected-mode no： 改为yes ：开启保护模式限制为本地访问 daemonize no ：改为 yes：是否以守护进程方式启动可后台运行 dir ./ ：Redis 数据存放文件夹（可选） appendonly yes ：Redis 持久化（可选） cluster-enabled ：设置为集群节点 Step3：创建并启动容器# docker run -d --net host --name redis -v /usr/confs/redis.conf:/etc/redis/redis.conf -v /usr/redisdata:/data redis redis-server /etc/redis/redis.conf --appendonly yes命令解释：">
  <meta itemprop="wordCount" content="242">

<title>使用 Docker搭建 Redis集群 | CODE&#39;NOTE</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/posts/redis/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAredis%E9%9B%86%E7%BE%A4/">
<link rel="stylesheet" href="/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.3ed9c79c605914c45e19db90edfda0ca8d87c63064c1d6252862250c4e917346.js" integrity="sha256-PtnHnGBZFMReGduQ7f2gyo2HxjBkwdYlKGIlDE6Rc0Y=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-posts">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>CODE&#39;NOTE</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>
























</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>使用 Docker搭建 Redis集群</h3>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    使用 Docker搭建 Redis集群
  </h1>
  


  

  


  <div class="book-post-content markdown-inner"><h1 id="环境准备">环境准备<a class="anchor" href="#%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87">#</a></h1>
<table>
  <thead>
      <tr>
          <th style="text-align: center">IP</th>
          <th style="text-align: center">操作系统</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">192.168.252.191</td>
          <td style="text-align: center">CentOS Linux release 7.9.2009 (Core)</td>
      </tr>
      <tr>
          <td style="text-align: center">192.168.252.192</td>
          <td style="text-align: center">CentOS Linux release 7.9.2009 (Core)</td>
      </tr>
      <tr>
          <td style="text-align: center">192.168.252.193</td>
          <td style="text-align: center">CentOS Linux release 7.9.2009 (Core)</td>
      </tr>
      <tr>
          <td style="text-align: center">192.168.252.194</td>
          <td style="text-align: center">CentOS Linux release 7.9.2009 (Core)</td>
      </tr>
      <tr>
          <td style="text-align: center">192.168.252.195</td>
          <td style="text-align: center">CentOS Linux release 7.9.2009 (Core)</td>
      </tr>
      <tr>
          <td style="text-align: center">192.168.252.196</td>
          <td style="text-align: center">CentOS Linux release 7.9.2009 (Core)</td>
      </tr>
  </tbody>
</table>
<!-- more -->
<h1 id="整体搭建步骤">整体搭建步骤<a class="anchor" href="#%e6%95%b4%e4%bd%93%e6%90%ad%e5%bb%ba%e6%ad%a5%e9%aa%a4">#</a></h1>
<p>整体搭建步骤主要分为以下几步：</p>
<ol>
<li>下载 Redis 镜像（可以省略，创建容器时如果本地镜像不存在就会去远程拉取）</li>
<li>更改 Redis 配置文件</li>
<li>创建并运行 Redis 容器</li>
<li>使用集群命令创建 Redis Cluster 集群</li>
</ol>
<h1 id="step1下载镜像">Step1：下载镜像<a class="anchor" href="#step1%e4%b8%8b%e8%bd%bd%e9%95%9c%e5%83%8f">#</a></h1>
<blockquote class='book-hint '>
<p>省略</p>
</blockquote><h1 id="step2更改配置文件">Step2：更改配置文件<a class="anchor" href="#step2%e6%9b%b4%e6%94%b9%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6">#</a></h1>
<p>获取 <code>redis.conf</code>  修改默认配置</p>
<ul>
<li><code>bind 127.0.0.1</code> ：  修改为 <code>0.0.0.0</code> 或指定<code>IP</code>（<code>127.0.0.1</code> 限制了 Redis 只能本地访问）</li>
<li><code>protected-mode no</code>： 改为<code>yes</code> ：开启保护模式限制为本地访问</li>
<li><code>daemonize no</code>  ：改为 <code>yes</code>：是否以守护进程方式启动可后台运行</li>
<li><code>dir  ./</code> ：Redis 数据存放文件夹（可选）</li>
<li><code>appendonly yes</code> ：Redis 持久化（可选）</li>
<li><code>cluster-enabled </code>：设置为集群节点</li>
</ul>
<h1 id="step3创建并启动容器">Step3：创建并启动容器<a class="anchor" href="#step3%e5%88%9b%e5%bb%ba%e5%b9%b6%e5%90%af%e5%8a%a8%e5%ae%b9%e5%99%a8">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run -d --net host --name redis  -v /usr/confs/redis.conf:/etc/redis/redis.conf -v /usr/redisdata:/data redis redis-server /etc/redis/redis.conf --appendonly yes</span></span></code></pre></div><p>命令解释：</p>
<ul>
<li><code>--name redis</code> ：指定容器名称</li>
<li><code>-v</code> ：挂载目录，前表示主机部分/后表示容器部分</li>
<li><code>-d</code> ：表示后台启动</li>
<li><code>redis-server /etc/redis/redis.conf</code> ：以配置文件启动 <code>Redis</code> ，加载容器内的 <code>conf</code> 文件，最终找到的是 <code>/usr/confs/redis.conf</code> </li>
<li><code>appendonly yes</code>：开启 <code>Redis</code>  持久化</li>
<li><code>--requirepass</code>：&ldquo;如果有密码&rdquo;</li>
</ul>
<p>在每台虚机上重复执行 <code>Step2</code> 和 <code>Step3</code> 启动6个redis节点。</p>
<blockquote class='book-hint '>
<p>注意：如果在执行创建集群命令时卡在&quot; Waiting for the cluster to join &hellip;&hellip;&quot;，启动容器时添加 <code>--net host</code></p>
</blockquote><h1 id="step4创建redis集群">Step4：创建Redis集群<a class="anchor" href="#step4%e5%88%9b%e5%bb%baredis%e9%9b%86%e7%be%a4">#</a></h1>
<p>格式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker exec -it redis redis-cli --cluster create 192.168.252.191:6379 192.168.252.192:6379 192.168.252.193:6379 192.168.252.194:6379 192.168.252.195:6379 192.168.252.196:6379 --cluster-replicas <span style="color:#ae81ff">1</span></span></span></code></pre></div><p>查看结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos-01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec -it redis /bin/bash</span>
</span></span><span style="display:flex;"><span>root@centos-01:/data# redis-cli 
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CLUSTER NODES
</span></span><span style="display:flex;"><span>ea3bd63f54103bf7873bfa1b8bea4b7c1190d489 192.168.252.191:6379@16379 myself,master - <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1631258399000</span> <span style="color:#ae81ff">1</span> connected 0-5460
</span></span><span style="display:flex;"><span>9d512a4a1bb7b2a92f09005298065c974d3cd545 192.168.252.194:6379@16379 master - <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1631258399500</span> <span style="color:#ae81ff">9</span> connected 10923-16383
</span></span><span style="display:flex;"><span>752d6f9633db932d8347f69d3a4eb52f640d2bdb 192.168.252.192:6379@16379 slave 05debcade3fbaae47c561fefd6c982641a74185c <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1631258398000</span> <span style="color:#ae81ff">10</span> connected
</span></span><span style="display:flex;"><span>7020b7697b4c0c3f5237f8d56a8ee24b41e1faa2 192.168.252.193:6379@16379 slave 9d512a4a1bb7b2a92f09005298065c974d3cd545 <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1631258400520</span> <span style="color:#ae81ff">9</span> connected
</span></span><span style="display:flex;"><span>05debcade3fbaae47c561fefd6c982641a74185c 192.168.252.196:6379@16379 master - <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1631258398478</span> <span style="color:#ae81ff">10</span> connected 5461-10922
</span></span><span style="display:flex;"><span>60f3a530a42c1f984d82f93fbb9a4017f40fb498 192.168.252.195:6379@16379 slave ea3bd63f54103bf7873bfa1b8bea4b7c1190d489 <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1631258397457</span> <span style="color:#ae81ff">1</span> connected
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CLUSTER INFO
</span></span><span style="display:flex;"><span>cluster_state:ok
</span></span><span style="display:flex;"><span>cluster_slots_assigned:16384
</span></span><span style="display:flex;"><span>cluster_slots_ok:16384
</span></span><span style="display:flex;"><span>cluster_slots_pfail:0
</span></span><span style="display:flex;"><span>cluster_slots_fail:0
</span></span><span style="display:flex;"><span>cluster_known_nodes:6
</span></span><span style="display:flex;"><span>cluster_size:3
</span></span><span style="display:flex;"><span>cluster_current_epoch:10
</span></span><span style="display:flex;"><span>cluster_my_epoch:1
</span></span><span style="display:flex;"><span>cluster_stats_messages_ping_sent:6497
</span></span><span style="display:flex;"><span>cluster_stats_messages_pong_sent:6333
</span></span><span style="display:flex;"><span>cluster_stats_messages_fail_sent:32
</span></span><span style="display:flex;"><span>cluster_stats_messages_auth-ack_sent:4
</span></span><span style="display:flex;"><span>cluster_stats_messages_sent:12866
</span></span><span style="display:flex;"><span>cluster_stats_messages_ping_received:6328
</span></span><span style="display:flex;"><span>cluster_stats_messages_pong_received:6488
</span></span><span style="display:flex;"><span>cluster_stats_messages_meet_received:5
</span></span><span style="display:flex;"><span>cluster_stats_messages_fail_received:6
</span></span><span style="display:flex;"><span>cluster_stats_messages_auth-req_received:4
</span></span><span style="display:flex;"><span>cluster_stats_mes</span></span></code></pre></div></div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">
  <div>
  
    <a href="/posts/redis/1.9redis%E9%9B%86%E7%BE%A4%E6%96%B9%E6%A1%88/" class="flex align-center">
      <img src="/icons/backward.svg" class="book-icon" alt="Backward" />
      <span>1.9 Redis集群方案</span>
    </a>
  
  </div>
  <div>
  
    <a href="/posts/redis/%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5redis/" class="flex align-center">
      <span>客户端连接 Redis</span>
      <img src="/icons/forward.svg" class="book-icon" alt="Forward" />
    </a>
  
  </div>
</div>
 
        
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
 
  </main>

  
</body>
</html>




















