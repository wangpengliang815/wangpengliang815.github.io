容器是依赖于镜像生成，独立运行的一个或一组应用以及它们的运行环境。

# 启动容器
启动容器有两种方式

- 基于镜像新建容器并启动
- 将在终止状态（`stopped`）的容器重新启动
## 新建并启动容器
比如下面的命令输出“hello world!”，之后终止容器：
```shell
[root@wangpengliang ~]# docker run ubuntu /bin/echo 'hello world!'
hello world!
```
下面的命令则启动一个 bash 终端，允许用户进行交互：
```shell
[root@wangpengliang ~]# docker run -it ubuntu /bin/bash
root@ef8fa7a1ffd6:/# 
```
- `-t` 选项让Docker分配一个伪终端（pseudo-tty）并绑定到容器的标准输入上
- `-i` 让容器的标准输入保持打开

`-it` 是简写，在交互模式下可以通过所创建的终端来输入命令，比如：

```shell
[root@wangpengliang ~]# docker run -it ubuntu /bin/bash
root@ef8fa7a1ffd6:/# pwd
/
root@ef8fa7a1ffd6:/# ls
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@ef8fa7a1ffd6:/# 
```
使用 `docker run` 创建容器时，Docker 在后台运行的标准操作包括：

1. 检查本地是否存在指定的镜像，不存在就从公有仓库下载
1. 利用镜像创建并启动一个容器
1. 分配一个文件系统，并在只读的镜像层外面挂载一层可读写层
1. 从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中去
1. 从地址池配置一个 ip 地址给容器
1. 执行用户指定的应用程序
1. 执行完毕后容器被终止
## 启动已终止容器
可以利用 `docker container start` 命令，直接将一个已经终止的容器启动运行。可以在伪终端中利用 `ps` 或 `top` 来查看进程信息：
```shell
root@ef8fa7a1ffd6:/# ps
   PID TTY          TIME CMD
     1 pts/0    00:00:00 bash
    12 pts/0    00:00:00 ps
```
# 后台运行
更多的时候，需要让 Docker 在后台运行而不是直接把执行命令的结果输出在当前宿主机下。可以通过添加 `-d` 参数来实现。

不使用 `-d` 参数：

```shell
[root@wangpengliang ~]# docker run ubuntu /bin/sh -c 'while true;do echo hello docker; sleep 1;done'
hello docker
hello docker
hello docker
hello docker
```
容器会把输出的结果 (STDOUT) 打印到宿主机上1s打印一次"hello docker"。

<hr>

使用 `-d` 参数：

```shell
[root@wangpengliang ~]# docker run -d ubuntu /bin/sh -c 'while true;do echo hello docker; sleep 1;done'
3c443074634c5edd6272c62fd08d8439ac2b5f3b9677233aae06deb2724c917c
```
此时容器会在后台运行并不会把输出结果 (STDOUT) 打印到宿主机上。

<hr>

可以使用 `docker logs` 查看输出结果

```shell
[root@wangpengliang ~]# docker logs 3c443074634c
hello docker
hello docker
hello docker
```


使用 `-d`  参数启动后会返回一个唯一的 id，也可以通过 `docker container ls`  命令来查看容器信息：
```shell
[root@wangpengliang ~]# docker container ls
CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                               NAMES
3c443074634c   ubuntu      "/bin/sh -c 'while t…"   2 minutes ago   Up 2 minutes                                       affectionate_agnesi
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   17 hours ago    Up 17 hours    0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
```
要获取容器的输出信息，可以按上面说的使用 `docker container logs`  命令，格式 `docker container logs [container ID or NAMES]` 
```shell
[root@wangpengliang ~]# docker container logs  3c443074634c
hello docker
hello docker
hello docker
```
# 终止容器
使用 `docker container stop`  来终止一个运行中的容器，此外当 Docker 容器中指定的应用终结时，容器也自动终止。比如对于上面只启动了一个终端的容器，通过 `exit`  命令或 `ctrl+d`   退出终端时，创建的容器立刻终止。

终止状态的容器可以用 `docker container ls -a`  命令看到：

```shell
[root@wangpengliang ~]# docker container ls -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS                      PORTS                               NAMES
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   18 hours ago   Up 18 hours                 0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
bab7ffb6e2e9   nginx:2.0   "/docker-entrypoint.…"   3 days ago     Exited (255) 18 hours ago   0.0.0.0:81->80/tcp, :::81->80/tcp   webserver2
470e01aed950   nginx   
```
处于终止状态的容器，可以通过 `docker container start`  命令来重新启动：
```shell
[root@wangpengliang ~]# docker container start webserver
webserver
[root@wangpengliang ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS                      PORTS                               NAMES
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   18 hours ago   Up 18 hours                 0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
bab7ffb6e2e9   nginx:2.0   "/docker-entrypoint.…"   3 days ago     Exited (255) 18 hours ago   0.0.0.0:81->80/tcp, :::81->80/tcp   webserver2
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 5 seconds                0.0.0.0:80->80/tcp, :::80->80/tcp   webserver
```
`docker container restart ` 命令会将一个运行状态的容器终止，然后再重新启动：

```shell
[root@wangpengliang ~]# docker container restart webserver
webserver
```



# 进入容器
使用 `-d`  参数时，容器启动后会进入后台，某些时候需要进入容器进行操作，包括使用 `docker attach` 或 `docker exec`  命令，推荐使用 `docker exec` 。
## attach
```shell
[root@wangpengliang ~]# docker run -dit ubuntu
21498e13f12425718093684e74f342e30e7b9665e57b9b919f0a718d888f7b50
[root@wangpengliang ~]# docker container ls
CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                               NAMES
21498e13f124   ubuntu      "/bin/bash"              9 seconds ago   Up 8 seconds                                       elated_chatelet
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   18 hours ago    Up 18 hours    0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago      Up 2 minutes   0.0.0.0:80->80/tcp, :::80->80/tcp   webserver
[root@wangpengliang ~]# docker attach 21498e13f124
root@21498e13f124:/# ls
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@21498e13f124:/# exit 
exit
[root@wangpengliang ~]# docker container ls
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS         PORTS                               NAMES
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   18 hours ago   Up 18 hours    0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 2 minutes   0.0.0.0:80->80/tcp, :::80->80/tcp   webserver

```
> 注意：如果从这个 stdin 中 exit，会导致容器的停止

## exec
`docker exec`  后边可以跟多个参数，这里主要说明 `-i -t`  参数

- 只用 `-i`  参数时由于没有分配伪终端，界面没有熟悉的 Linux 命令提示符，但命令执行结果仍然可以返回
- 当 `-i -t`  参数一起使用时，则可以看到熟悉的 Linux 命令提示符
```shell
[root@wangpengliang ~]# docker exec -it 2687f43c0e42 bash
root@2687f43c0e42:/# ls
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
```
如果从这个 stdin 中 exit，不会导致容器的停止。这就是为什么推荐使用 `docker exec` 的原因，更多参数说明使用 `docker exec --help`  查看。
# 导出容器
如果要导出本地某个容器，可以使用 `docker export`  命令，这将导出容器快照到本地文件：
```shell
[root@wangpengliang ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS                      PORTS                               NAMES
2687f43c0e42   ubuntu      "/bin/bash"              2 hours ago    Up 2 minutes                                                    romantic_greider
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   20 hours ago   Up 20 hours                 0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
bab7ffb6e2e9   nginx:2.0   "/docker-entrypoint.…"   3 days ago     Exited (255) 20 hours ago   0.0.0.0:81->80/tcp, :::81->80/tcp   webserver2
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 2 hours                  0.0.0.0:80->80/tcp, :::80->80/tcp   webserver
[root@wangpengliang ~]# docker export 2687f43c0e42 > ubuntu.tar
```
# 导入容器

可以使用 `docker import`  从容器快照文件中再导入为镜像。比如：
```shell
[root@wangpengliang ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS                      PORTS                               NAMES
2687f43c0e42   ubuntu      "/bin/bash"              2 hours ago    Up 2 minutes                                                    romantic_greider
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   20 hours ago   Up 20 hours                 0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
bab7ffb6e2e9   nginx:2.0   "/docker-entrypoint.…"   3 days ago     Exited (255) 20 hours ago   0.0.0.0:81->80/tcp, :::81->80/tcp   webserver2
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 2 hours                  0.0.0.0:80->80/tcp, :::80->80/tcp   webserver
[root@wangpengliang ~]# docker export 2687f43c0e42 >ubuntu.tar
[root@wangpengliang ~]# cat ubuntu.tar|docker import - test/ubuntu:v1.0
sha256:557b6b4bfca63802c6b89bb4c8f1800a2af7954fdff345bd94adba2c770ad4d4
[root@wangpengliang ~]# docker image ls
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
test/ubuntu   v1.0      557b6b4bfca6   9 seconds ago   72.7MB
nginx         3.0       f89693105193   20 hours ago    133MB
nginx         2.0       546ad28bcf61   3 days ago      133MB
redis         6.2.4     fad0ee7e917a   5 days ago      105MB
redis         latest    fad0ee7e917a   5 days ago      105MB
nginx         latest    d1a364dc548d   13 days ago     133MB
ubuntu        latest    7e0aa2d69a15   6 weeks ago     72.7MB
hello-world   latest    d1165f221234   3 months ago    13.3kB

```
此外，也可以通过指定 URL 或者某个目录来导入，比如：
```shell
docker import http://example.com/exampleimage.tgz example/imagerepo
```
> 注意：用户既可以使用 `docker load`  来导入镜像存储文件到本地镜像库，也可以使用 `docker import` 来导入一个容器快照到本地镜像库。这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也要大。此外，从容器快照文件导入时可以重新指定标签等元数据信息

# 删除容器
可以使用 `docker container rm`  来删除一个处于终止状态的容器
```shell
[root@wangpengliang ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS                      PORTS                               NAMES
2687f43c0e42   ubuntu      "/bin/bash"              2 hours ago    Up 6 minutes                                                    romantic_greider
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   20 hours ago   Up 20 hours                 0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
bab7ffb6e2e9   nginx:2.0   "/docker-entrypoint.…"   3 days ago     Exited (255) 20 hours ago   0.0.0.0:81->80/tcp, :::81->80/tcp   webserver2
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 2 hours                  0.0.0.0:80->80/tcp, :::80->80/tcp   webserver

[root@wangpengliang ~]# docker container rm bab7ffb6e2e9
bab7ffb6e2e9

[root@wangpengliang ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS         PORTS                               NAMES
2687f43c0e42   ubuntu      "/bin/bash"              2 hours ago    Up 7 minutes                                       romantic_greider
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   20 hours ago   Up 20 hours    0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 2 hours     0.0.0.0:80->80/tcp, :::80->80/tcp   webserver

```
如果要删除一个运行中的容器，可以添加 `-f`  参数。Docker 会发送 `SIGKILL`  信号给容器
```shell
[root@wangpengliang ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS         PORTS                               NAMES
2687f43c0e42   ubuntu      "/bin/bash"              2 hours ago    Up 8 minutes                                       romantic_greider
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   20 hours ago   Up 20 hours    0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 2 hours     0.0.0.0:80->80/tcp, :::80->80/tcp   webserver

[root@wangpengliang ~]# docker container rm -f 2687f43c0e42
2687f43c0e42

[root@wangpengliang ~]# docker ps -a
CONTAINER ID   IMAGE       COMMAND                  CREATED        STATUS        PORTS                               NAMES
a1ea64a6c039   nginx:3.0   "/docker-entrypoint.…"   20 hours ago   Up 20 hours   0.0.0.0:82->80/tcp, :::82->80/tcp   webserver3
470e01aed950   nginx       "/docker-entrypoint.…"   3 days ago     Up 2 hours    0.0.0.0:80->80/tcp, :::80->80/tcp   webserver
```
用 `docker container ls -a`  命令可以查看所有已经创建的包括终止状态的容器，如果数量太多一个个删除可能会很麻烦，用下面的命令可以清理掉所有处于终止状态的容器：
```shell
docker container prune
```


